var es=Object.defineProperty;var ss=(n,e,t)=>e in n?es(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var S=(n,e,t)=>(ss(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();function ve(n,e,t,s=o=>o){return n*s(.5-e*(.5-t))}function ns(n){return[-n[0],-n[1]]}function K(n,e){return[n[0]+e[0],n[1]+e[1]]}function H(n,e){return[n[0]-e[0],n[1]-e[1]]}function Z(n,e){return[n[0]*e,n[1]*e]}function os(n,e){return[n[0]/e,n[1]/e]}function gt(n){return[n[1],-n[0]]}function Pe(n,e){return n[0]*e[0]+n[1]*e[1]}function is(n,e){return n[0]===e[0]&&n[1]===e[1]}function rs(n){return Math.hypot(n[0],n[1])}function as(n){return n[0]*n[0]+n[1]*n[1]}function xe(n,e){return as(H(n,e))}function Be(n){return os(n,rs(n))}function ls(n,e){return Math.hypot(n[1]-e[1],n[0]-e[0])}function yt(n,e,t){let s=Math.sin(t),o=Math.cos(t),a=n[0]-e[0],i=n[1]-e[1],r=a*o-i*s,l=a*s+i*o;return[r+e[0],l+e[1]]}function ne(n,e,t){return K(n,Z(H(e,n),t))}function Le(n,e,t){return K(n,Z(e,t))}var{min:ut,PI:cs}=Math,Se=.275,kt=cs+1e-4;function hs(n,e={}){let{size:t=16,smoothing:s=.5,thinning:o=.5,simulatePressure:a=!0,easing:i=P=>P,start:r={},end:l={},last:h=!1}=e,{cap:c=!0,easing:p=P=>P*(2-P)}=r,{cap:f=!0,easing:u=P=>--P*P*P+1}=l;if(n.length===0||t<=0)return[];let d=n[n.length-1].runningLength,g=r.taper===!1?0:r.taper===!0?Math.max(t,d):r.taper,m=l.taper===!1?0:l.taper===!0?Math.max(t,d):l.taper,k=Math.pow(t*s,2),M=[],C=[],W=n.slice(0,10).reduce((P,$)=>{let O=$.pressure;if(a){let T=ut(1,$.distance/t),Zt=ut(1,1-T);O=ut(1,P+(Zt-P)*(T*Se))}return(P+O)/2},n[0].pressure),v=ve(t,o,n[n.length-1].pressure,i),I,j=n[0].vector,B=n[0].point,V=B,N=B,D=V,ht=!1;for(let P=0;P<n.length;P++){let{pressure:$}=n[P],{point:O,vector:T,distance:Zt,runningLength:mt}=n[P];if(P<n.length-1&&d-mt<3)continue;if(o){if(a){let tt=ut(1,Zt/t),Qt=ut(1,1-tt);$=ut(1,W+(Qt-W)*(tt*Se))}v=ve(t,o,$,i)}else v=t/2;I===void 0&&(I=v);let Je=mt<g?p(mt/g):1,Ue=d-mt<m?u((d-mt)/m):1;v=Math.max(.01,v*Math.min(Je,Ue));let be=(P<n.length-1?n[P+1]:n[P]).vector,Kt=P<n.length-1?Pe(T,be):1,ts=Pe(T,j)<0&&!ht,we=Kt!==null&&Kt<0;if(ts||we){let tt=Z(gt(j),v);for(let Qt=1/13,Et=0;Et<=1;Et+=Qt)N=yt(H(O,tt),O,kt*Et),M.push(N),D=yt(K(O,tt),O,kt*-Et),C.push(D);B=N,V=D,we&&(ht=!0);continue}if(ht=!1,P===n.length-1){let tt=Z(gt(T),v);M.push(H(O,tt)),C.push(K(O,tt));continue}let Me=Z(gt(ne(be,T,Kt)),v);N=H(O,Me),(P<=1||xe(B,N)>k)&&(M.push(N),B=N),D=K(O,Me),(P<=1||xe(V,D)>k)&&(C.push(D),V=D),W=$,j=T}let A=n[0].point.slice(0,2),E=n.length>1?n[n.length-1].point.slice(0,2):K(n[0].point,[1,1]),X=[],G=[];if(n.length===1){if(!(g||m)||h){let P=Le(A,Be(gt(H(A,E))),-(I||v)),$=[];for(let O=1/13,T=O;T<=1;T+=O)$.push(yt(P,A,kt*2*T));return $}}else{if(!(g||m&&n.length===1))if(c)for(let $=1/13,O=$;O<=1;O+=$){let T=yt(C[0],A,kt*O);X.push(T)}else{let $=H(M[0],C[0]),O=Z($,.5),T=Z($,.51);X.push(H(A,O),H(A,T),K(A,T),K(A,O))}let P=gt(ns(n[n.length-1].vector));if(m||g&&n.length===1)G.push(E);else if(f){let $=Le(E,P,v);for(let O=1/29,T=O;T<1;T+=O)G.push(yt($,E,kt*3*T))}else G.push(K(E,Z(P,v)),K(E,Z(P,v*.99)),H(E,Z(P,v*.99)),H(E,Z(P,v)))}return M.concat(G,C.reverse(),X)}function us(n,e={}){var t;let{streamline:s=.5,size:o=16,last:a=!1}=e;if(n.length===0)return[];let i=.15+(1-s)*.85,r=Array.isArray(n[0])?n:n.map(({x:u,y:d,pressure:g=.5})=>[u,d,g]);if(r.length===2){let u=r[1];r=r.slice(0,-1);for(let d=1;d<5;d++)r.push(ne(r[0],u,d/4))}r.length===1&&(r=[...r,[...K(r[0],[1,1]),...r[0].slice(2)]]);let l=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],h=!1,c=0,p=l[0],f=r.length-1;for(let u=1;u<r.length;u++){let d=a&&u===f?r[u].slice(0,2):ne(p.point,r[u],i);if(is(p.point,d))continue;let g=ls(d,p.point);if(c+=g,u<f&&!h){if(c<o)continue;h=!0}p={point:d,pressure:r[u][2]>=0?r[u][2]:.5,vector:Be(H(p.point,d)),distance:g,runningLength:c},l.push(p)}return l[0].vector=((t=l[1])==null?void 0:t.vector)||[0,0],l}function ds(n,e={}){return hs(us(n,e),e)}var fs=ds;function ps(n,e,t){let s=JSON.parse(n);switch(s.typeName){case"rectangle":let{color:a,width:i,startPoint:r,endPoint:l,fillStyle:h,stroke:c,strokeWidth:p,userId:f,zoom:u,objId:d}=s,g=new de(a,i,r,l,h,e,c,p,f);return g.objId=d,g.zoom=u,g;case"ellipse":{let{color:m,width:k,startPoint:M,endPoint:C,fillStyle:W,stroke:v,strokeWidth:I,isCircle:j,userId:B,zoom:V,objId:N}=s,D=new fe(m,k,M,C,W,e,v,I,j,B);return D.objId=N,D.zoom=V,D}case"line":{let{color:m,width:k,startPoint:M,endPoint:C,userId:W,zoom:v,objId:I}=s,j=new ue(m,k,M,C,e,W);return j.zoom=v,j.objId=I,j}case"curve":{let{pointsList:m,color:k,width:M,userId:C,zoom:W,objId:v}=s,I=new he(m,k,M,t,C);return I.objId=v,I.zoom=W,I}default:return null}}function ms(n,e,t){const s={transform:`translate(${n}px, ${e}px)`};t.animate(s,{fill:"forwards"})}function Ye(n,e,t,s){e.fillStyle=Fe(n,s),t.style.backgroundColor=n;const o=document.getElementsByClassName("trailer");for(let a=0;a<o.length;a++){const i=o[a];i.style.backgroundColor=n}}function Ot(n,e){return(n+e)/2}function gs(n,e=!0){const t=n.length;if(t<4)return"";let s=n[0],o=n[1];const a=n[2];let i=`M${s[0].toFixed(2)},${s[1].toFixed(2)} Q${o[0].toFixed(2)},${o[1].toFixed(2)} ${Ot(o[0],a[0]).toFixed(2)},${Ot(o[1],a[1]).toFixed(2)} T`;for(let r=2,l=t-1;r<l;r++)s=n[r],o=n[r+1],i+=`${Ot(s[0],o[0]).toFixed(2)},${Ot(s[1],o[1]).toFixed(2)} `;return e&&(i+="Z"),i}function Xe(n,e="1"){let t,s;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(n))return t=n.substring(1).split(""),t.length==3&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),s=+("0x"+t.join("")),"rgba("+[s>>16&255,s>>8&255,s&255].join(",")+","+e+")";throw new Error("Bad Hex")}function Fe(n,e){let t=n.slice(n.indexOf("(")+1,n.indexOf(")")).split(", ");return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function qe(n){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s=t.length;for(let o=0;o<n;o++)e+=t.charAt(Math.floor(Math.random()*s));return e}function ys(n){n.clearRect(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight)}function ks(n,e,t,s,o){let a=0;for(let i=0;i<n.length;i++){const r=n[i];r.isOverlay(e,t,s,o)&&(r.draw(e,t),a++)}console.log(n.length+"  "+a)}class Ht{constructor(e,t,s){S(this,"color");S(this,"width");S(this,"userId");S(this,"typeName","");S(this,"tempObj",!1);S(this,"zoom",1);S(this,"objId",qe(5));this.color=e,this.width=t,this.userId=s}draw(e,t){console.log("offset:",e,t)}isOverlay(e,t,s,o){return!0}}class he extends Ht{constructor(t,s,o,a,i){super(s,o,i);S(this,"pointsList");S(this,"ctx");S(this,"typeName","curve");this.pointsList=t,this.ctx=a,this.userId=i}draw(t,s){let o=[];for(let h=0;h<this.pointsList.length;h++){let c=this.pointsList[h];o.push([c[0]*this.zoom+t,c[1]*this.zoom+s])}const a=fs(o,{size:this.width*this.zoom,thinning:.7}),i=gs(a),r=new Path2D(i);let l=this.ctx.fillStyle;this.ctx.fillStyle=this.color.startsWith("#")?Xe(this.color):this.color,this.ctx.fill(r),this.ctx.fillStyle=l}isCloseToPoints(t,s,o){if(this.pointsList.length===0)return!1;for(let a=0;a<this.pointsList.length;a++){const i=this.pointsList[a];if(Math.sqrt(Math.pow(t-i[0],2)+Math.pow(s-i[1],2))<o)return!0}return!1}isOverlay(t,s,o,a){if(t*=-1,s*=-1,this.pointsList.length===0)return!1;let i=this.pointsList[0][0],r=this.pointsList[0][0],l=this.pointsList[0][1],h=this.pointsList[0][1];for(let d=0;d<this.pointsList.length;d++){const g=this.pointsList[d];i=i>g[0]?g[0]:i,r=r<g[0]?g[0]:r,l=l>g[1]?g[1]:l,h=h<g[1]?g[1]:h}i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,p=s,f=t+o,u=s+a;return(i>=c&&i<=f||r>=c&&r<=f)&&(l>=p&&l<=u||h>=p&&h<=u)||(c>=i&&c<=r||f>=i&&f<=r)&&(p>=l&&p<=h||u>=l&&u<=h)||(i>=c&&i<=f||r>=c&&r<=f)&&(p>=l&&p<=h||u>=l&&u<=h)||(c>=i&&c<=r||f>=i&&f<=r)&&(l>=p&&l<=u||h>=p&&h<=u)}}class ue extends Ht{constructor(t,s,o,a,i,r){super(t,s,r);S(this,"startPoint");S(this,"endPoint");S(this,"roughCanvas");S(this,"typeName","line");this.startPoint=o,this.endPoint=a,this.roughCanvas=i,this.userId=r}draw(t,s){this.roughCanvas.line(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+s,this.endPoint[0]*this.zoom+t,this.endPoint[1]*this.zoom+s,{strokeWidth:this.width*this.zoom,stroke:this.color,seed:1})}isOverlay(t,s,o,a){t*=-1,s*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),l=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,p=s,f=t+o,u=s+a;return(i>=c&&i<=f||r>=c&&r<=f)&&(l>=p&&l<=u||h>=p&&h<=u)||(c>=i&&c<=r||f>=i&&f<=r)&&(p>=l&&p<=h||u>=l&&u<=h)||(i>=c&&i<=f||r>=c&&r<=f)&&(p>=l&&p<=h||u>=l&&u<=h)||(c>=i&&c<=r||f>=i&&f<=r)&&(l>=p&&l<=u||h>=p&&h<=u)}isCloseToPoints(t,s,o){return Math.sqrt(Math.pow(t-this.startPoint[0],2)+Math.pow(s-this.startPoint[1],2))<o||Math.sqrt(Math.pow(t-this.endPoint[0],2)+Math.pow(s-this.endPoint[1],2))<o}}class de extends Ht{constructor(t,s,o,a,i,r,l,h,c){super(t,s,c);S(this,"startPoint");S(this,"endPoint");S(this,"roughCanvas");S(this,"fillStyle");S(this,"typeName","rectangle");S(this,"stroke");S(this,"strokeWidth");S(this,"drawableObj",null);this.startPoint=o,this.endPoint=a,this.roughCanvas=r,this.fillStyle=i,this.stroke=l,this.strokeWidth=h,this.userId=c}draw(t,s){let o=(this.endPoint[0]-this.startPoint[0])*this.zoom,a=(this.endPoint[1]-this.startPoint[1])*this.zoom;this.roughCanvas.rectangle(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+s,o,a,{strokeWidth:this.width*this.zoom,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}isOverlay(t,s,o,a){t*=-1,s*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),l=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,p=s,f=t+o,u=s+a;return(i>=c&&i<=f||r>=c&&r<=f)&&(l>=p&&l<=u||h>=p&&h<=u)||(c>=i&&c<=r||f>=i&&f<=r)&&(p>=l&&p<=h||u>=l&&u<=h)||(i>=c&&i<=f||r>=c&&r<=f)&&(p>=l&&p<=h||u>=l&&u<=h)||(c>=i&&c<=r||f>=i&&f<=r)&&(l>=p&&l<=u||h>=p&&h<=u)}}class fe extends Ht{constructor(t,s,o,a,i,r,l,h,c,p){super(t,s,p);S(this,"startPoint");S(this,"endPoint");S(this,"roughCanvas");S(this,"fillStyle");S(this,"typeName","ellipse");S(this,"stroke");S(this,"strokeWidth");S(this,"drawableObj",null);S(this,"isCircle");this.startPoint=o,this.endPoint=a,this.roughCanvas=r,this.fillStyle=i,this.stroke=l,this.strokeWidth=h,this.isCircle=c,this.userId=this.userId}draw(t,s){let o=(this.endPoint[0]-this.startPoint[0])*this.zoom,a=(this.endPoint[1]-this.startPoint[1])*this.zoom;this.roughCanvas.ellipse(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+s,o*2,a*2,{strokeWidth:this.width*this.zoom,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}isOverlay(t,s,o,a){t*=-1,s*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),l=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,p=s,f=t+o,u=s+a;return(i>=c&&i<=f||r>=c&&r<=f)&&(l>=p&&l<=u||h>=p&&h<=u)||(c>=i&&c<=r||f>=i&&f<=r)&&(p>=l&&p<=h||u>=l&&u<=h)||(i>=c&&i<=f||r>=c&&r<=f)&&(p>=l&&p<=h||u>=l&&u<=h)||(c>=i&&c<=r||f>=i&&f<=r)&&(l>=p&&l<=u||h>=p&&h<=u)}closeToCentre(t,s){return Math.sqrt(Math.pow(t-this.startPoint[0],2)+Math.pow(s-this.startPoint[1],2))<Math.max(Math.min(Math.abs(Math.abs(this.startPoint[0])-Math.abs(this.endPoint[0])),Math.abs(Math.abs(this.startPoint[1])-Math.abs(this.endPoint[1]))),10)}}function Jt(n,e,t){if(n&&n.length){const[s,o]=e,a=Math.PI/180*t,i=Math.cos(a),r=Math.sin(a);n.forEach(l=>{const[h,c]=l;l[0]=(h-s)*i-(c-o)*r+s,l[1]=(h-s)*r+(c-o)*i+o})}}function Vt(n){const e=n[0],t=n[1];return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Lt(n,e){const t=e.hachureAngle+90;let s=e.hachureGap;s<0&&(s=4*e.strokeWidth),s=Math.max(s,.1);const o=[0,0];if(t)for(const i of n)Jt(i,o,t);const a=function(i,r){const l=[];for(const u of i){const d=[...u];d[0].join(",")!==d[d.length-1].join(",")&&d.push([d[0][0],d[0][1]]),d.length>2&&l.push(d)}const h=[];r=Math.max(r,.1);const c=[];for(const u of l)for(let d=0;d<u.length-1;d++){const g=u[d],m=u[d+1];if(g[1]!==m[1]){const k=Math.min(g[1],m[1]);c.push({ymin:k,ymax:Math.max(g[1],m[1]),x:k===g[1]?g[0]:m[0],islope:(m[0]-g[0])/(m[1]-g[1])})}}if(c.sort((u,d)=>u.ymin<d.ymin?-1:u.ymin>d.ymin?1:u.x<d.x?-1:u.x>d.x?1:u.ymax===d.ymax?0:(u.ymax-d.ymax)/Math.abs(u.ymax-d.ymax)),!c.length)return h;let p=[],f=c[0].ymin;for(;p.length||c.length;){if(c.length){let u=-1;for(let d=0;d<c.length&&!(c[d].ymin>f);d++)u=d;c.splice(0,u+1).forEach(d=>{p.push({s:f,edge:d})})}if(p=p.filter(u=>!(u.edge.ymax<=f)),p.sort((u,d)=>u.edge.x===d.edge.x?0:(u.edge.x-d.edge.x)/Math.abs(u.edge.x-d.edge.x)),p.length>1)for(let u=0;u<p.length;u+=2){const d=u+1;if(d>=p.length)break;const g=p[u].edge,m=p[d].edge;h.push([[Math.round(g.x),f],[Math.round(m.x),f]])}f+=r,p.forEach(u=>{u.edge.x=u.edge.x+r*u.edge.islope})}return h}(n,s);if(t){for(const i of n)Jt(i,o,-t);(function(i,r,l){const h=[];i.forEach(c=>h.push(...c)),Jt(h,r,l)})(a,o,-t)}return a}class pe{constructor(e){this.helper=e}fillPolygons(e,t){return this._fillPolygons(e,t)}_fillPolygons(e,t){const s=Lt(e,t);return{type:"fillSketch",ops:this.renderLines(s,t)}}renderLines(e,t){const s=[];for(const o of e)s.push(...this.helper.doubleLineOps(o[0][0],o[0][1],o[1][0],o[1][1],t));return s}}class bs extends pe{fillPolygons(e,t){let s=t.hachureGap;s<0&&(s=4*t.strokeWidth),s=Math.max(s,.1);const o=Lt(e,Object.assign({},t,{hachureGap:s})),a=Math.PI/180*t.hachureAngle,i=[],r=.5*s*Math.cos(a),l=.5*s*Math.sin(a);for(const[h,c]of o)Vt([h,c])&&i.push([[h[0]-r,h[1]+l],[...c]],[[h[0]+r,h[1]-l],[...c]]);return{type:"fillSketch",ops:this.renderLines(i,t)}}}class ws extends pe{fillPolygons(e,t){const s=this._fillPolygons(e,t),o=Object.assign({},t,{hachureAngle:t.hachureAngle+90}),a=this._fillPolygons(e,o);return s.ops=s.ops.concat(a.ops),s}}class Ms{constructor(e){this.helper=e}fillPolygons(e,t){const s=Lt(e,t=Object.assign({},t,{hachureAngle:0}));return this.dotsOnLines(s,t)}dotsOnLines(e,t){const s=[];let o=t.hachureGap;o<0&&(o=4*t.strokeWidth),o=Math.max(o,.1);let a=t.fillWeight;a<0&&(a=t.strokeWidth/2);const i=o/4;for(const r of e){const l=Vt(r),h=l/o,c=Math.ceil(h)-1,p=l-c*o,f=(r[0][0]+r[1][0])/2-o/4,u=Math.min(r[0][1],r[1][1]);for(let d=0;d<c;d++){const g=u+p+d*o,m=f-i+2*Math.random()*i,k=g-i+2*Math.random()*i,M=this.helper.ellipse(m,k,a,a,t);s.push(...M.ops)}}return{type:"fillSketch",ops:s}}}class vs{constructor(e){this.helper=e}fillPolygons(e,t){const s=Lt(e,t);return{type:"fillSketch",ops:this.dashedLine(s,t)}}dashedLine(e,t){const s=t.dashOffset<0?t.hachureGap<0?4*t.strokeWidth:t.hachureGap:t.dashOffset,o=t.dashGap<0?t.hachureGap<0?4*t.strokeWidth:t.hachureGap:t.dashGap,a=[];return e.forEach(i=>{const r=Vt(i),l=Math.floor(r/(s+o)),h=(r+o-l*(s+o))/2;let c=i[0],p=i[1];c[0]>p[0]&&(c=i[1],p=i[0]);const f=Math.atan((p[1]-c[1])/(p[0]-c[0]));for(let u=0;u<l;u++){const d=u*(s+o),g=d+s,m=[c[0]+d*Math.cos(f)+h*Math.cos(f),c[1]+d*Math.sin(f)+h*Math.sin(f)],k=[c[0]+g*Math.cos(f)+h*Math.cos(f),c[1]+g*Math.sin(f)+h*Math.sin(f)];a.push(...this.helper.doubleLineOps(m[0],m[1],k[0],k[1],t))}}),a}}class Ps{constructor(e){this.helper=e}fillPolygons(e,t){const s=t.hachureGap<0?4*t.strokeWidth:t.hachureGap,o=t.zigzagOffset<0?s:t.zigzagOffset,a=Lt(e,t=Object.assign({},t,{hachureGap:s+o}));return{type:"fillSketch",ops:this.zigzagLines(a,o,t)}}zigzagLines(e,t,s){const o=[];return e.forEach(a=>{const i=Vt(a),r=Math.round(i/(2*t));let l=a[0],h=a[1];l[0]>h[0]&&(l=a[1],h=a[0]);const c=Math.atan((h[1]-l[1])/(h[0]-l[0]));for(let p=0;p<r;p++){const f=2*p*t,u=2*(p+1)*t,d=Math.sqrt(2*Math.pow(t,2)),g=[l[0]+f*Math.cos(c),l[1]+f*Math.sin(c)],m=[l[0]+u*Math.cos(c),l[1]+u*Math.sin(c)],k=[g[0]+d*Math.cos(c+Math.PI/4),g[1]+d*Math.sin(c+Math.PI/4)];o.push(...this.helper.doubleLineOps(g[0],g[1],k[0],k[1],s),...this.helper.doubleLineOps(k[0],k[1],m[0],m[1],s))}}),o}}const F={};class xs{constructor(e){this.seed=e}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const Ct={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Ut(n,e){return n.type===e}function oe(n){const e=[],t=function(i){const r=new Array;for(;i!=="";)if(i.match(/^([ \t\r\n,]+)/))i=i.substr(RegExp.$1.length);else if(i.match(/^([aAcChHlLmMqQsStTvVzZ])/))r[r.length]={type:0,text:RegExp.$1},i=i.substr(RegExp.$1.length);else{if(!i.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];r[r.length]={type:1,text:`${parseFloat(RegExp.$1)}`},i=i.substr(RegExp.$1.length)}return r[r.length]={type:2,text:""},r}(n);let s="BOD",o=0,a=t[o];for(;!Ut(a,2);){let i=0;const r=[];if(s==="BOD"){if(a.text!=="M"&&a.text!=="m")return oe("M0,0"+n);o++,i=Ct[a.text],s=a.text}else Ut(a,1)?i=Ct[s]:(o++,i=Ct[a.text],s=a.text);if(!(o+i<t.length))throw new Error("Path data ended short");for(let l=o;l<o+i;l++){const h=t[l];if(!Ut(h,1))throw new Error("Param not a number: "+s+","+h.text);r[r.length]=+h.text}if(typeof Ct[s]!="number")throw new Error("Bad segment: "+s);{const l={key:s,data:r};e.push(l),o+=i,a=t[o],s==="M"&&(s="L"),s==="m"&&(s="l")}}return e}function Ee(n){let e=0,t=0,s=0,o=0;const a=[];for(const{key:i,data:r}of n)switch(i){case"M":a.push({key:"M",data:[...r]}),[e,t]=r,[s,o]=r;break;case"m":e+=r[0],t+=r[1],a.push({key:"M",data:[e,t]}),s=e,o=t;break;case"L":a.push({key:"L",data:[...r]}),[e,t]=r;break;case"l":e+=r[0],t+=r[1],a.push({key:"L",data:[e,t]});break;case"C":a.push({key:"C",data:[...r]}),e=r[4],t=r[5];break;case"c":{const l=r.map((h,c)=>c%2?h+t:h+e);a.push({key:"C",data:l}),e=l[4],t=l[5];break}case"Q":a.push({key:"Q",data:[...r]}),e=r[2],t=r[3];break;case"q":{const l=r.map((h,c)=>c%2?h+t:h+e);a.push({key:"Q",data:l}),e=l[2],t=l[3];break}case"A":a.push({key:"A",data:[...r]}),e=r[5],t=r[6];break;case"a":e+=r[5],t+=r[6],a.push({key:"A",data:[r[0],r[1],r[2],r[3],r[4],e,t]});break;case"H":a.push({key:"H",data:[...r]}),e=r[0];break;case"h":e+=r[0],a.push({key:"H",data:[e]});break;case"V":a.push({key:"V",data:[...r]}),t=r[0];break;case"v":t+=r[0],a.push({key:"V",data:[t]});break;case"S":a.push({key:"S",data:[...r]}),e=r[2],t=r[3];break;case"s":{const l=r.map((h,c)=>c%2?h+t:h+e);a.push({key:"S",data:l}),e=l[2],t=l[3];break}case"T":a.push({key:"T",data:[...r]}),e=r[0],t=r[1];break;case"t":e+=r[0],t+=r[1],a.push({key:"T",data:[e,t]});break;case"Z":case"z":a.push({key:"Z",data:[]}),e=s,t=o}return a}function Oe(n){const e=[];let t="",s=0,o=0,a=0,i=0,r=0,l=0;for(const{key:h,data:c}of n){switch(h){case"M":e.push({key:"M",data:[...c]}),[s,o]=c,[a,i]=c;break;case"C":e.push({key:"C",data:[...c]}),s=c[4],o=c[5],r=c[2],l=c[3];break;case"L":e.push({key:"L",data:[...c]}),[s,o]=c;break;case"H":s=c[0],e.push({key:"L",data:[s,o]});break;case"V":o=c[0],e.push({key:"L",data:[s,o]});break;case"S":{let p=0,f=0;t==="C"||t==="S"?(p=s+(s-r),f=o+(o-l)):(p=s,f=o),e.push({key:"C",data:[p,f,...c]}),r=c[0],l=c[1],s=c[2],o=c[3];break}case"T":{const[p,f]=c;let u=0,d=0;t==="Q"||t==="T"?(u=s+(s-r),d=o+(o-l)):(u=s,d=o);const g=s+2*(u-s)/3,m=o+2*(d-o)/3,k=p+2*(u-p)/3,M=f+2*(d-f)/3;e.push({key:"C",data:[g,m,k,M,p,f]}),r=u,l=d,s=p,o=f;break}case"Q":{const[p,f,u,d]=c,g=s+2*(p-s)/3,m=o+2*(f-o)/3,k=u+2*(p-u)/3,M=d+2*(f-d)/3;e.push({key:"C",data:[g,m,k,M,u,d]}),r=p,l=f,s=u,o=d;break}case"A":{const p=Math.abs(c[0]),f=Math.abs(c[1]),u=c[2],d=c[3],g=c[4],m=c[5],k=c[6];p===0||f===0?(e.push({key:"C",data:[s,o,m,k,m,k]}),s=m,o=k):(s!==m||o!==k)&&(_e(s,o,m,k,p,f,u,d,g).forEach(function(M){e.push({key:"C",data:M})}),s=m,o=k);break}case"Z":e.push({key:"Z",data:[]}),s=a,o=i}t=h}return e}function bt(n,e,t){return[n*Math.cos(t)-e*Math.sin(t),n*Math.sin(t)+e*Math.cos(t)]}function _e(n,e,t,s,o,a,i,r,l,h){const c=(p=i,Math.PI*p/180);var p;let f=[],u=0,d=0,g=0,m=0;if(h)[u,d,g,m]=h;else{[n,e]=bt(n,e,-c),[t,s]=bt(t,s,-c);const A=(n-t)/2,E=(e-s)/2;let X=A*A/(o*o)+E*E/(a*a);X>1&&(X=Math.sqrt(X),o*=X,a*=X);const G=o*o,P=a*a,$=G*P-G*E*E-P*A*A,O=G*E*E+P*A*A,T=(r===l?-1:1)*Math.sqrt(Math.abs($/O));g=T*o*E/a+(n+t)/2,m=T*-a*A/o+(e+s)/2,u=Math.asin(parseFloat(((e-m)/a).toFixed(9))),d=Math.asin(parseFloat(((s-m)/a).toFixed(9))),n<g&&(u=Math.PI-u),t<g&&(d=Math.PI-d),u<0&&(u=2*Math.PI+u),d<0&&(d=2*Math.PI+d),l&&u>d&&(u-=2*Math.PI),!l&&d>u&&(d-=2*Math.PI)}let k=d-u;if(Math.abs(k)>120*Math.PI/180){const A=d,E=t,X=s;d=l&&d>u?u+120*Math.PI/180*1:u+120*Math.PI/180*-1,f=_e(t=g+o*Math.cos(d),s=m+a*Math.sin(d),E,X,o,a,i,0,l,[d,A,g,m])}k=d-u;const M=Math.cos(u),C=Math.sin(u),W=Math.cos(d),v=Math.sin(d),I=Math.tan(k/4),j=4/3*o*I,B=4/3*a*I,V=[n,e],N=[n+j*C,e-B*M],D=[t+j*v,s-B*W],ht=[t,s];if(N[0]=2*V[0]-N[0],N[1]=2*V[1]-N[1],h)return[N,D,ht].concat(f);{f=[N,D,ht].concat(f);const A=[];for(let E=0;E<f.length;E+=3){const X=bt(f[E][0],f[E][1],c),G=bt(f[E+1][0],f[E+1][1],c),P=bt(f[E+2][0],f[E+2][1],c);A.push([X[0],X[1],G[0],G[1],P[0],P[1]])}return A}}const Ls={randOffset:function(n,e){return b(n,e)},randOffsetWithRange:function(n,e,t){return $t(n,e,t)},ellipse:function(n,e,t,s,o){const a=He(t,s,o);return ie(n,e,o,a).opset},doubleLineOps:function(n,e,t,s,o){return U(n,e,t,s,o,!0)}};function Re(n,e,t,s,o){return{type:"path",ops:U(n,e,t,s,o)}}function At(n,e,t){const s=(n||[]).length;if(s>2){const o=[];for(let a=0;a<s-1;a++)o.push(...U(n[a][0],n[a][1],n[a+1][0],n[a+1][1],t));return e&&o.push(...U(n[s-1][0],n[s-1][1],n[0][0],n[0][1],t)),{type:"path",ops:o}}return s===2?Re(n[0][0],n[0][1],n[1][0],n[1][1],t):{type:"path",ops:[]}}function Ss(n,e,t,s,o){return function(a,i){return At(a,!0,i)}([[n,e],[n+t,e],[n+t,e+s],[n,e+s]],o)}function Es(n,e){let t=Te(n,1*(1+.2*e.roughness),e);if(!e.disableMultiStroke){const s=Te(n,1.5*(1+.22*e.roughness),function(o){const a=Object.assign({},o);return a.randomizer=void 0,o.seed&&(a.seed=o.seed+1),a}(e));t=t.concat(s)}return{type:"path",ops:t}}function He(n,e,t){const s=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(n/2,2)+Math.pow(e/2,2))/2)),o=Math.ceil(Math.max(t.curveStepCount,t.curveStepCount/Math.sqrt(200)*s)),a=2*Math.PI/o;let i=Math.abs(n/2),r=Math.abs(e/2);const l=1-t.curveFitting;return i+=b(i*l,t),r+=b(r*l,t),{increment:a,rx:i,ry:r}}function ie(n,e,t,s){const[o,a]=ze(s.increment,n,e,s.rx,s.ry,1,s.increment*$t(.1,$t(.4,1,t),t),t);let i=Bt(o,null,t);if(!t.disableMultiStroke&&t.roughness!==0){const[r]=ze(s.increment,n,e,s.rx,s.ry,1.5,0,t),l=Bt(r,null,t);i=i.concat(l)}return{estimatedPoints:a,opset:{type:"path",ops:i}}}function Ce(n,e,t,s,o,a,i,r,l){const h=n,c=e;let p=Math.abs(t/2),f=Math.abs(s/2);p+=b(.01*p,l),f+=b(.01*f,l);let u=o,d=a;for(;u<0;)u+=2*Math.PI,d+=2*Math.PI;d-u>2*Math.PI&&(u=0,d=2*Math.PI);const g=2*Math.PI/l.curveStepCount,m=Math.min(g/2,(d-u)/2),k=We(m,h,c,p,f,u,d,1,l);if(!l.disableMultiStroke){const M=We(m,h,c,p,f,u,d,1.5,l);k.push(...M)}return i&&(r?k.push(...U(h,c,h+p*Math.cos(u),c+f*Math.sin(u),l),...U(h,c,h+p*Math.cos(d),c+f*Math.sin(d),l)):k.push({op:"lineTo",data:[h,c]},{op:"lineTo",data:[h+p*Math.cos(u),c+f*Math.sin(u)]})),{type:"path",ops:k}}function It(n,e){const t=[];for(const s of n)if(s.length){const o=e.maxRandomnessOffset||0,a=s.length;if(a>2){t.push({op:"move",data:[s[0][0]+b(o,e),s[0][1]+b(o,e)]});for(let i=1;i<a;i++)t.push({op:"lineTo",data:[s[i][0]+b(o,e),s[i][1]+b(o,e)]})}}return{type:"fillPath",ops:t}}function dt(n,e){return function(t,s){let o=t.fillStyle||"hachure";if(!F[o])switch(o){case"zigzag":F[o]||(F[o]=new bs(s));break;case"cross-hatch":F[o]||(F[o]=new ws(s));break;case"dots":F[o]||(F[o]=new Ms(s));break;case"dashed":F[o]||(F[o]=new vs(s));break;case"zigzag-line":F[o]||(F[o]=new Ps(s));break;case"hachure":default:o="hachure",F[o]||(F[o]=new pe(s))}return F[o]}(e,Ls).fillPolygons(n,e)}function Ve(n){return n.randomizer||(n.randomizer=new xs(n.seed||0)),n.randomizer.next()}function $t(n,e,t,s=1){return t.roughness*s*(Ve(t)*(e-n)+n)}function b(n,e,t=1){return $t(-n,n,e,t)}function U(n,e,t,s,o,a=!1){const i=a?o.disableMultiStrokeFill:o.disableMultiStroke,r=Ie(n,e,t,s,o,!0,!1);if(i)return r;const l=Ie(n,e,t,s,o,!0,!0);return r.concat(l)}function Ie(n,e,t,s,o,a,i){const r=Math.pow(n-t,2)+Math.pow(e-s,2),l=Math.sqrt(r);let h=1;h=l<200?1:l>500?.4:-.0016668*l+1.233334;let c=o.maxRandomnessOffset||0;c*c*100>r&&(c=l/10);const p=c/2,f=.2+.2*Ve(o);let u=o.bowing*o.maxRandomnessOffset*(s-e)/200,d=o.bowing*o.maxRandomnessOffset*(n-t)/200;u=b(u,o,h),d=b(d,o,h);const g=[],m=()=>b(p,o,h),k=()=>b(c,o,h),M=o.preserveVertices;return a&&(i?g.push({op:"move",data:[n+(M?0:m()),e+(M?0:m())]}):g.push({op:"move",data:[n+(M?0:b(c,o,h)),e+(M?0:b(c,o,h))]})),i?g.push({op:"bcurveTo",data:[u+n+(t-n)*f+m(),d+e+(s-e)*f+m(),u+n+2*(t-n)*f+m(),d+e+2*(s-e)*f+m(),t+(M?0:m()),s+(M?0:m())]}):g.push({op:"bcurveTo",data:[u+n+(t-n)*f+k(),d+e+(s-e)*f+k(),u+n+2*(t-n)*f+k(),d+e+2*(s-e)*f+k(),t+(M?0:k()),s+(M?0:k())]}),g}function Te(n,e,t){const s=[];s.push([n[0][0]+b(e,t),n[0][1]+b(e,t)]),s.push([n[0][0]+b(e,t),n[0][1]+b(e,t)]);for(let o=1;o<n.length;o++)s.push([n[o][0]+b(e,t),n[o][1]+b(e,t)]),o===n.length-1&&s.push([n[o][0]+b(e,t),n[o][1]+b(e,t)]);return Bt(s,null,t)}function Bt(n,e,t){const s=n.length,o=[];if(s>3){const a=[],i=1-t.curveTightness;o.push({op:"move",data:[n[1][0],n[1][1]]});for(let r=1;r+2<s;r++){const l=n[r];a[0]=[l[0],l[1]],a[1]=[l[0]+(i*n[r+1][0]-i*n[r-1][0])/6,l[1]+(i*n[r+1][1]-i*n[r-1][1])/6],a[2]=[n[r+1][0]+(i*n[r][0]-i*n[r+2][0])/6,n[r+1][1]+(i*n[r][1]-i*n[r+2][1])/6],a[3]=[n[r+1][0],n[r+1][1]],o.push({op:"bcurveTo",data:[a[1][0],a[1][1],a[2][0],a[2][1],a[3][0],a[3][1]]})}if(e&&e.length===2){const r=t.maxRandomnessOffset;o.push({op:"lineTo",data:[e[0]+b(r,t),e[1]+b(r,t)]})}}else s===3?(o.push({op:"move",data:[n[1][0],n[1][1]]}),o.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):s===2&&o.push(...U(n[0][0],n[0][1],n[1][0],n[1][1],t));return o}function ze(n,e,t,s,o,a,i,r){const l=[],h=[];if(r.roughness===0){n/=4,h.push([e+s*Math.cos(-n),t+o*Math.sin(-n)]);for(let c=0;c<=2*Math.PI;c+=n){const p=[e+s*Math.cos(c),t+o*Math.sin(c)];l.push(p),h.push(p)}h.push([e+s*Math.cos(0),t+o*Math.sin(0)]),h.push([e+s*Math.cos(n),t+o*Math.sin(n)])}else{const c=b(.5,r)-Math.PI/2;h.push([b(a,r)+e+.9*s*Math.cos(c-n),b(a,r)+t+.9*o*Math.sin(c-n)]);const p=2*Math.PI+c-.01;for(let f=c;f<p;f+=n){const u=[b(a,r)+e+s*Math.cos(f),b(a,r)+t+o*Math.sin(f)];l.push(u),h.push(u)}h.push([b(a,r)+e+s*Math.cos(c+2*Math.PI+.5*i),b(a,r)+t+o*Math.sin(c+2*Math.PI+.5*i)]),h.push([b(a,r)+e+.98*s*Math.cos(c+i),b(a,r)+t+.98*o*Math.sin(c+i)]),h.push([b(a,r)+e+.9*s*Math.cos(c+.5*i),b(a,r)+t+.9*o*Math.sin(c+.5*i)])}return[h,l]}function We(n,e,t,s,o,a,i,r,l){const h=a+b(.1,l),c=[];c.push([b(r,l)+e+.9*s*Math.cos(h-n),b(r,l)+t+.9*o*Math.sin(h-n)]);for(let p=h;p<=i;p+=n)c.push([b(r,l)+e+s*Math.cos(p),b(r,l)+t+o*Math.sin(p)]);return c.push([e+s*Math.cos(i),t+o*Math.sin(i)]),c.push([e+s*Math.cos(i),t+o*Math.sin(i)]),Bt(c,null,l)}function Os(n,e,t,s,o,a,i,r){const l=[],h=[r.maxRandomnessOffset||1,(r.maxRandomnessOffset||1)+.3];let c=[0,0];const p=r.disableMultiStroke?1:2,f=r.preserveVertices;for(let u=0;u<p;u++)u===0?l.push({op:"move",data:[i[0],i[1]]}):l.push({op:"move",data:[i[0]+(f?0:b(h[0],r)),i[1]+(f?0:b(h[0],r))]}),c=f?[o,a]:[o+b(h[u],r),a+b(h[u],r)],l.push({op:"bcurveTo",data:[n+b(h[u],r),e+b(h[u],r),t+b(h[u],r),s+b(h[u],r),c[0],c[1]]});return l}function wt(n){return[...n]}function jt(n,e){return Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)}function Cs(n,e,t){const s=jt(e,t);if(s===0)return jt(n,e);let o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/s;return o=Math.max(0,Math.min(1,o)),jt(n,it(e,t,o))}function it(n,e,t){return[n[0]+(e[0]-n[0])*t,n[1]+(e[1]-n[1])*t]}function re(n,e,t,s){const o=s||[];if(function(r,l){const h=r[l+0],c=r[l+1],p=r[l+2],f=r[l+3];let u=3*c[0]-2*h[0]-f[0];u*=u;let d=3*c[1]-2*h[1]-f[1];d*=d;let g=3*p[0]-2*f[0]-h[0];g*=g;let m=3*p[1]-2*f[1]-h[1];return m*=m,u<g&&(u=g),d<m&&(d=m),u+d}(n,e)<t){const r=n[e+0];o.length?(a=o[o.length-1],i=r,Math.sqrt(jt(a,i))>1&&o.push(r)):o.push(r),o.push(n[e+3])}else{const l=n[e+0],h=n[e+1],c=n[e+2],p=n[e+3],f=it(l,h,.5),u=it(h,c,.5),d=it(c,p,.5),g=it(f,u,.5),m=it(u,d,.5),k=it(g,m,.5);re([l,f,g,k],0,t,o),re([k,m,d,p],0,t,o)}var a,i;return o}function Is(n,e){return Yt(n,0,n.length,e)}function Yt(n,e,t,s,o){const a=o||[],i=n[e],r=n[t-1];let l=0,h=1;for(let c=e+1;c<t-1;++c){const p=Cs(n[c],i,r);p>l&&(l=p,h=c)}return Math.sqrt(l)>s?(Yt(n,e,h+1,s,a),Yt(n,h,t,s,a)):(a.length||a.push(i),a.push(r)),a}function Ne(n,e=.15,t){const s=[],o=(n.length-1)/3;for(let a=0;a<o;a++)re(n,3*a,e,s);return t&&t>0?Yt(s,0,s.length,t):s}const R="none";class Xt{constructor(e){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=e||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(e){return e?Object.assign({},this.defaultOptions,e):this.defaultOptions}_d(e,t,s){return{shape:e,sets:t||[],options:s||this.defaultOptions}}line(e,t,s,o,a){const i=this._o(a);return this._d("line",[Re(e,t,s,o,i)],i)}rectangle(e,t,s,o,a){const i=this._o(a),r=[],l=Ss(e,t,s,o,i);if(i.fill){const h=[[e,t],[e+s,t],[e+s,t+o],[e,t+o]];i.fillStyle==="solid"?r.push(It([h],i)):r.push(dt([h],i))}return i.stroke!==R&&r.push(l),this._d("rectangle",r,i)}ellipse(e,t,s,o,a){const i=this._o(a),r=[],l=He(s,o,i),h=ie(e,t,i,l);if(i.fill)if(i.fillStyle==="solid"){const c=ie(e,t,i,l).opset;c.type="fillPath",r.push(c)}else r.push(dt([h.estimatedPoints],i));return i.stroke!==R&&r.push(h.opset),this._d("ellipse",r,i)}circle(e,t,s,o){const a=this.ellipse(e,t,s,s,o);return a.shape="circle",a}linearPath(e,t){const s=this._o(t);return this._d("linearPath",[At(e,!1,s)],s)}arc(e,t,s,o,a,i,r=!1,l){const h=this._o(l),c=[],p=Ce(e,t,s,o,a,i,r,!0,h);if(r&&h.fill)if(h.fillStyle==="solid"){const f=Object.assign({},h);f.disableMultiStroke=!0;const u=Ce(e,t,s,o,a,i,!0,!1,f);u.type="fillPath",c.push(u)}else c.push(function(f,u,d,g,m,k,M){const C=f,W=u;let v=Math.abs(d/2),I=Math.abs(g/2);v+=b(.01*v,M),I+=b(.01*I,M);let j=m,B=k;for(;j<0;)j+=2*Math.PI,B+=2*Math.PI;B-j>2*Math.PI&&(j=0,B=2*Math.PI);const V=(B-j)/M.curveStepCount,N=[];for(let D=j;D<=B;D+=V)N.push([C+v*Math.cos(D),W+I*Math.sin(D)]);return N.push([C+v*Math.cos(B),W+I*Math.sin(B)]),N.push([C,W]),dt([N],M)}(e,t,s,o,a,i,h));return h.stroke!==R&&c.push(p),this._d("arc",c,h)}curve(e,t){const s=this._o(t),o=[],a=Es(e,s);if(s.fill&&s.fill!==R&&e.length>=3){const i=Ne(function(r,l=0){const h=r.length;if(h<3)throw new Error("A curve must have at least three points.");const c=[];if(h===3)c.push(wt(r[0]),wt(r[1]),wt(r[2]),wt(r[2]));else{const p=[];p.push(r[0],r[0]);for(let d=1;d<r.length;d++)p.push(r[d]),d===r.length-1&&p.push(r[d]);const f=[],u=1-l;c.push(wt(p[0]));for(let d=1;d+2<p.length;d++){const g=p[d];f[0]=[g[0],g[1]],f[1]=[g[0]+(u*p[d+1][0]-u*p[d-1][0])/6,g[1]+(u*p[d+1][1]-u*p[d-1][1])/6],f[2]=[p[d+1][0]+(u*p[d][0]-u*p[d+2][0])/6,p[d+1][1]+(u*p[d][1]-u*p[d+2][1])/6],f[3]=[p[d+1][0],p[d+1][1]],c.push(f[1],f[2],f[3])}}return c}(e),10,(1+s.roughness)/2);s.fillStyle==="solid"?o.push(It([i],s)):o.push(dt([i],s))}return s.stroke!==R&&o.push(a),this._d("curve",o,s)}polygon(e,t){const s=this._o(t),o=[],a=At(e,!0,s);return s.fill&&(s.fillStyle==="solid"?o.push(It([e],s)):o.push(dt([e],s))),s.stroke!==R&&o.push(a),this._d("polygon",o,s)}path(e,t){const s=this._o(t),o=[];if(!e)return this._d("path",o,s);e=(e||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const a=s.fill&&s.fill!=="transparent"&&s.fill!==R,i=s.stroke!==R,r=!!(s.simplification&&s.simplification<1),l=function(h,c,p){const f=Oe(Ee(oe(h))),u=[];let d=[],g=[0,0],m=[];const k=()=>{m.length>=4&&d.push(...Ne(m,c)),m=[]},M=()=>{k(),d.length&&(u.push(d),d=[])};for(const{key:W,data:v}of f)switch(W){case"M":M(),g=[v[0],v[1]],d.push(g);break;case"L":k(),d.push([v[0],v[1]]);break;case"C":if(!m.length){const I=d.length?d[d.length-1]:g;m.push([I[0],I[1]])}m.push([v[0],v[1]]),m.push([v[2],v[3]]),m.push([v[4],v[5]]);break;case"Z":k(),d.push([g[0],g[1]])}if(M(),!p)return u;const C=[];for(const W of u){const v=Is(W,p);v.length&&C.push(v)}return C}(e,1,r?4-4*s.simplification:(1+s.roughness)/2);return a&&(s.fillStyle==="solid"?o.push(It(l,s)):o.push(dt(l,s))),i&&(r?l.forEach(h=>{o.push(At(h,!1,s))}):o.push(function(h,c){const p=Oe(Ee(oe(h))),f=[];let u=[0,0],d=[0,0];for(const{key:g,data:m}of p)switch(g){case"M":{const k=1*(c.maxRandomnessOffset||0),M=c.preserveVertices;f.push({op:"move",data:m.map(C=>C+(M?0:b(k,c)))}),d=[m[0],m[1]],u=[m[0],m[1]];break}case"L":f.push(...U(d[0],d[1],m[0],m[1],c)),d=[m[0],m[1]];break;case"C":{const[k,M,C,W,v,I]=m;f.push(...Os(k,M,C,W,v,I,d,c)),d=[v,I];break}case"Z":f.push(...U(d[0],d[1],u[0],u[1],c)),d=[u[0],u[1]]}return{type:"path",ops:f}}(e,s))),this._d("path",o,s)}opsToPath(e,t){let s="";for(const o of e.ops){const a=typeof t=="number"&&t>=0?o.data.map(i=>+i.toFixed(t)):o.data;switch(o.op){case"move":s+=`M${a[0]} ${a[1]} `;break;case"bcurveTo":s+=`C${a[0]} ${a[1]}, ${a[2]} ${a[3]}, ${a[4]} ${a[5]} `;break;case"lineTo":s+=`L${a[0]} ${a[1]} `}}return s.trim()}toPaths(e){const t=e.sets||[],s=e.options||this.defaultOptions,o=[];for(const a of t){let i=null;switch(a.type){case"path":i={d:this.opsToPath(a),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:R};break;case"fillPath":i={d:this.opsToPath(a),stroke:R,strokeWidth:0,fill:s.fill||R};break;case"fillSketch":i=this.fillSketch(a,s)}i&&o.push(i)}return o}fillSketch(e,t){let s=t.fillWeight;return s<0&&(s=t.strokeWidth/2),{d:this.opsToPath(e),stroke:t.fill||R,strokeWidth:s,fill:R}}}class Ts{constructor(e,t){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.gen=new Xt(t)}draw(e){const t=e.sets||[],s=e.options||this.getDefaultOptions(),o=this.ctx,a=e.options.fixedDecimalPlaceDigits;for(const i of t)switch(i.type){case"path":o.save(),o.strokeStyle=s.stroke==="none"?"transparent":s.stroke,o.lineWidth=s.strokeWidth,s.strokeLineDash&&o.setLineDash(s.strokeLineDash),s.strokeLineDashOffset&&(o.lineDashOffset=s.strokeLineDashOffset),this._drawToContext(o,i,a),o.restore();break;case"fillPath":{o.save(),o.fillStyle=s.fill||"";const r=e.shape==="curve"||e.shape==="polygon"||e.shape==="path"?"evenodd":"nonzero";this._drawToContext(o,i,a,r),o.restore();break}case"fillSketch":this.fillSketch(o,i,s)}}fillSketch(e,t,s){let o=s.fillWeight;o<0&&(o=s.strokeWidth/2),e.save(),s.fillLineDash&&e.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(e.lineDashOffset=s.fillLineDashOffset),e.strokeStyle=s.fill||"",e.lineWidth=o,this._drawToContext(e,t,s.fixedDecimalPlaceDigits),e.restore()}_drawToContext(e,t,s,o="nonzero"){e.beginPath();for(const a of t.ops){const i=typeof s=="number"&&s>=0?a.data.map(r=>+r.toFixed(s)):a.data;switch(a.op){case"move":e.moveTo(i[0],i[1]);break;case"bcurveTo":e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);break;case"lineTo":e.lineTo(i[0],i[1])}}t.type==="fillPath"?e.fill(o):e.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(e,t,s,o,a){const i=this.gen.line(e,t,s,o,a);return this.draw(i),i}rectangle(e,t,s,o,a){const i=this.gen.rectangle(e,t,s,o,a);return this.draw(i),i}ellipse(e,t,s,o,a){const i=this.gen.ellipse(e,t,s,o,a);return this.draw(i),i}circle(e,t,s,o){const a=this.gen.circle(e,t,s,o);return this.draw(a),a}linearPath(e,t){const s=this.gen.linearPath(e,t);return this.draw(s),s}polygon(e,t){const s=this.gen.polygon(e,t);return this.draw(s),s}arc(e,t,s,o,a,i,r=!1,l){const h=this.gen.arc(e,t,s,o,a,i,r,l);return this.draw(h),h}curve(e,t){const s=this.gen.curve(e,t);return this.draw(s),s}path(e,t){const s=this.gen.path(e,t);return this.draw(s),s}}const Tt="http://www.w3.org/2000/svg";class zs{constructor(e,t){this.svg=e,this.gen=new Xt(t)}draw(e){const t=e.sets||[],s=e.options||this.getDefaultOptions(),o=this.svg.ownerDocument||window.document,a=o.createElementNS(Tt,"g"),i=e.options.fixedDecimalPlaceDigits;for(const r of t){let l=null;switch(r.type){case"path":l=o.createElementNS(Tt,"path"),l.setAttribute("d",this.opsToPath(r,i)),l.setAttribute("stroke",s.stroke),l.setAttribute("stroke-width",s.strokeWidth+""),l.setAttribute("fill","none"),s.strokeLineDash&&l.setAttribute("stroke-dasharray",s.strokeLineDash.join(" ").trim()),s.strokeLineDashOffset&&l.setAttribute("stroke-dashoffset",`${s.strokeLineDashOffset}`);break;case"fillPath":l=o.createElementNS(Tt,"path"),l.setAttribute("d",this.opsToPath(r,i)),l.setAttribute("stroke","none"),l.setAttribute("stroke-width","0"),l.setAttribute("fill",s.fill||""),e.shape!=="curve"&&e.shape!=="polygon"||l.setAttribute("fill-rule","evenodd");break;case"fillSketch":l=this.fillSketch(o,r,s)}l&&a.appendChild(l)}return a}fillSketch(e,t,s){let o=s.fillWeight;o<0&&(o=s.strokeWidth/2);const a=e.createElementNS(Tt,"path");return a.setAttribute("d",this.opsToPath(t,s.fixedDecimalPlaceDigits)),a.setAttribute("stroke",s.fill||""),a.setAttribute("stroke-width",o+""),a.setAttribute("fill","none"),s.fillLineDash&&a.setAttribute("stroke-dasharray",s.fillLineDash.join(" ").trim()),s.fillLineDashOffset&&a.setAttribute("stroke-dashoffset",`${s.fillLineDashOffset}`),a}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(e,t){return this.gen.opsToPath(e,t)}line(e,t,s,o,a){const i=this.gen.line(e,t,s,o,a);return this.draw(i)}rectangle(e,t,s,o,a){const i=this.gen.rectangle(e,t,s,o,a);return this.draw(i)}ellipse(e,t,s,o,a){const i=this.gen.ellipse(e,t,s,o,a);return this.draw(i)}circle(e,t,s,o){const a=this.gen.circle(e,t,s,o);return this.draw(a)}linearPath(e,t){const s=this.gen.linearPath(e,t);return this.draw(s)}polygon(e,t){const s=this.gen.polygon(e,t);return this.draw(s)}arc(e,t,s,o,a,i,r=!1,l){const h=this.gen.arc(e,t,s,o,a,i,r,l);return this.draw(h)}curve(e,t){const s=this.gen.curve(e,t);return this.draw(s)}path(e,t){const s=this.gen.path(e,t);return this.draw(s)}}var Ws={canvas:(n,e)=>new Ts(n,e),svg:(n,e)=>new zs(n,e),generator:n=>new Xt(n),newSeed:()=>Xt.newSeed()},Ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ge={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */(function(n){(function(e,t){n.exports?n.exports=t():e.Toastify=t()})(Ns,function(e){var t=function(i){return new t.lib.init(i)},s="1.12.0";t.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},t.lib=t.prototype={toastify:s,constructor:t,init:function(i){return i||(i={}),this.options={},this.toastElement=null,this.options.text=i.text||t.defaults.text,this.options.node=i.node||t.defaults.node,this.options.duration=i.duration===0?0:i.duration||t.defaults.duration,this.options.selector=i.selector||t.defaults.selector,this.options.callback=i.callback||t.defaults.callback,this.options.destination=i.destination||t.defaults.destination,this.options.newWindow=i.newWindow||t.defaults.newWindow,this.options.close=i.close||t.defaults.close,this.options.gravity=i.gravity==="bottom"?"toastify-bottom":t.defaults.gravity,this.options.positionLeft=i.positionLeft||t.defaults.positionLeft,this.options.position=i.position||t.defaults.position,this.options.backgroundColor=i.backgroundColor||t.defaults.backgroundColor,this.options.avatar=i.avatar||t.defaults.avatar,this.options.className=i.className||t.defaults.className,this.options.stopOnFocus=i.stopOnFocus===void 0?t.defaults.stopOnFocus:i.stopOnFocus,this.options.onClick=i.onClick||t.defaults.onClick,this.options.offset=i.offset||t.defaults.offset,this.options.escapeMarkup=i.escapeMarkup!==void 0?i.escapeMarkup:t.defaults.escapeMarkup,this.options.ariaLive=i.ariaLive||t.defaults.ariaLive,this.options.style=i.style||t.defaults.style,i.backgroundColor&&(this.options.style.background=i.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var i=document.createElement("div");i.className="toastify on "+this.options.className,this.options.position?i.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(i.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):i.className+=" toastify-right",i.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var r in this.options.style)i.style[r]=this.options.style[r];if(this.options.ariaLive&&i.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)i.appendChild(this.options.node);else if(this.options.escapeMarkup?i.innerText=this.options.text:i.innerHTML=this.options.text,this.options.avatar!==""){var l=document.createElement("img");l.src=this.options.avatar,l.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?i.appendChild(l):i.insertAdjacentElement("afterbegin",l)}if(this.options.close===!0){var h=document.createElement("button");h.type="button",h.setAttribute("aria-label","Close"),h.className="toast-close",h.innerHTML="&#10006;",h.addEventListener("click",function(m){m.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var c=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&c>360?i.insertAdjacentElement("afterbegin",h):i.appendChild(h)}if(this.options.stopOnFocus&&this.options.duration>0){var p=this;i.addEventListener("mouseover",function(m){window.clearTimeout(i.timeOutValue)}),i.addEventListener("mouseleave",function(){i.timeOutValue=window.setTimeout(function(){p.removeElement(i)},p.options.duration)})}if(typeof this.options.destination<"u"&&i.addEventListener("click",function(m){m.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&i.addEventListener("click",function(m){m.stopPropagation(),this.options.onClick()}.bind(this)),typeof this.options.offset=="object"){var f=o("x",this.options),u=o("y",this.options),d=this.options.position=="left"?f:"-"+f,g=this.options.gravity=="toastify-top"?u:"-"+u;i.style.transform="translate("+d+","+g+")"}return i},showToast:function(){this.toastElement=this.buildToast();var i;if(typeof this.options.selector=="string"?i=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?i=this.options.selector:i=document.body,!i)throw"Root element is not defined";var r=t.defaults.oldestFirst?i.firstChild:i.lastChild;return i.insertBefore(this.toastElement,r),t.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(i){i.className=i.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),i.parentNode&&i.parentNode.removeChild(i),this.options.callback.call(i),t.reposition()}.bind(this),400)}},t.reposition=function(){for(var i={top:15,bottom:15},r={top:15,bottom:15},l={top:15,bottom:15},h=document.getElementsByClassName("toastify"),c,p=0;p<h.length;p++){a(h[p],"toastify-top")===!0?c="toastify-top":c="toastify-bottom";var f=h[p].offsetHeight;c=c.substr(9,c.length-1);var u=15,d=window.innerWidth>0?window.innerWidth:screen.width;d<=360?(h[p].style[c]=l[c]+"px",l[c]+=f+u):a(h[p],"toastify-left")===!0?(h[p].style[c]=i[c]+"px",i[c]+=f+u):(h[p].style[c]=r[c]+"px",r[c]+=f+u)}return this};function o(i,r){return r.offset[i]?isNaN(r.offset[i])?r.offset[i]:r.offset[i]+"px":"0px"}function a(i,r){return!i||typeof r!="string"?!1:!!(i.className&&i.className.trim().split(/\s+/gi).indexOf(r)>-1)}return t.lib.init.prototype=t.lib,t})})(Ge);const ae=Ge.exports;let z=[],x=0,L=0,Ze=0,Ke=0,As=1,le=0,ft=[],y=1,Ft=!1,qt=!1,ce=!1,me=!1;const rt=document.getElementById("me"),Q=qe(20);let pt="rgb(95, 61, 196)",St="pointer",vt="hachure";const Pt=document.getElementById("zoom-current"),ge=document.querySelector(".confirm-wrapper"),et=document.querySelector(".options-wrapper"),zt=document.getElementById("options-color-border"),Wt=document.querySelector(".fill-style-options"),js=document.querySelector(".settings-show-btn"),Dt=document.querySelector(".settings-container"),Qe=localStorage.getItem("theme")||"lightTheme",Ds=document.getElementById(Qe);Ds.checked=!0;document.documentElement.className=Qe;const $s=document.querySelectorAll('input[type="radio"]');js.addEventListener("click",()=>{Dt.style.display==="none"?Dt.style.display="flex":Dt.style.display="none"});$s.forEach(n=>{n.addEventListener("click",()=>{document.documentElement.className=n.id,localStorage.setItem("theme",n.id)})});const _=document.getElementById("canvas");_.height=document.documentElement.clientHeight;_.width=document.documentElement.clientWidth;const w=_.getContext("2d");w.lineWidth=12;w.fillStyle="rgb(54, 79, 199)";rt.style.backgroundColor="rgb(54, 79, 199)";let te=0,ee=0;const at=Ws.canvas(_),Ae=document.querySelectorAll(".fill-style-btn");Ae.forEach(n=>{n.addEventListener("click",e=>{if(e.target===null)return;const t=e.target;Ae.forEach(s=>{s!==t&&s.classList.remove("active-fill-style")}),t.classList.add("active-fill-style"),vt=t.dataset.fillOption})});const _t=document.querySelectorAll(".top-btn");_t.forEach(n=>{n.addEventListener("click",e=>{if(e.target===null)return;const t=e.target;t.id==="save-btn"||t.id==="clear-btn"||(_t.forEach(s=>{s!==t&&s.classList.remove("active-shape")}),t.classList.add("active-shape"),St=t.dataset.shapeOption,J(t.id))})});let q,xt="";const Rt=window.location;Rt.protocol==="https:"?xt="wss:":xt="ws:";xt+="/"+Rt.host;xt+=Rt.pathname+"/ws"+Rt.search;q=new WebSocket(xt);Bs(q);function Bs(n){n.onmessage=Ys,n.onclose=Xs}function Ys(n){try{const t=n.data.split(":::"),s=t[0];if(s==="move"){const o=w.lineWidth,a=w.strokeStyle;_.getContext("2d"),w.beginPath(),w.moveTo(t[1],t[2]),w.lineTo(t[3],t[4]),w.lineWidth=t[5],w.strokeStyle=t[6],w.stroke(),w.strokeStyle=a,w.lineWidth=o}if(s==="clear"&&(z=[],w.clearRect(0,0,_.width,_.height)),s==="cur"){const o=t[1];let a;if(a=document.getElementById(o),a===null){a=document.createElement("div"),a.id=o,a.className="trailer",document.body.appendChild(a);return}const i={transform:`translate(${+t[2]*y+x}px, ${+t[3]*y+L}px)`};a.animate(i,{fill:"forwards"})}if(s==="disconnect"){ae({text:"User disconnected",duration:2e3,newWindow:!0,close:!0,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(90deg, rgba(255,244,0,1) 0%, rgba(255,162,0,1) 48%, rgba(255,0,0,1) 100%)"},onClick:function(){}}).showToast();let o=document.getElementsByClassName("trailer");if(o.length===0)return;for(var e=0;e<o.length;e++)o[e].id!=="me"&&(document.body.removeChild(o[e]),e--)}if(s==="message"&&ae({text:t[1],duration:6e3,newWindow:!0,close:!0,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(90deg, rgba(0,255,141,1) 0%, rgba(0,206,255,1) 100%)"},onClick:function(){}}).showToast(),s==="drawObj"){let o=ps(t[1],at,w);o.zoom=y,z.push(o),o.draw(x,L)}if(s==="delete"){let o=t[1];z=z.filter(a=>a.objId!==JSON.parse(o).objId),Y()}}catch(t){console.error(t)}}function Xs(){ae({text:"Lost connection. Click here",duration:0,newWindow:!0,close:!1,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(90deg, rgba(255,244,0,1) 0%, rgba(255,162,0,1) 48%, rgba(255,0,0,1) 100%)"},onClick:function(){location.reload()}}).showToast()}window.addEventListener("keydown",n=>{n.code==="Space"&&(me=!0,_.style.cursor="grabbing")});window.addEventListener("keyup",n=>{n.code==="Space"&&(me=!1,_.style.cursor="default")});let lt=0,ct=0;window.addEventListener("mousedown",n=>{if(n.stopPropagation(),n.button===1||me&&n.button===0){qt=!0,Ze=n.clientX-x,Ke=n.clientY-L,_.style.cursor="grabbing";return}if(n.button===0){const e=n.target;if(e.id!=="canvas"){ce=!1;return}if(e===null)return;Ft=!0,ce=!0,le=0,ft=[],lt=n.clientX,ct=n.clientY}});window.addEventListener("mouseup",n=>{if(n.button===1&&(_.style.cursor="default"),n.button===2)return;if(qt){qt=!1;return}if(Ft=!1,n.target.id!=="canvas"||ce===!1)return;switch(St){case"pointer":break;case"pen":{let o=[];for(let i=0;i<ft.length;i++){const r=ft[i];o.push([r[0]*y,r[1]*y])}let a=new he(ft,w.fillStyle,+w.lineWidth,w,Q);a.zoom=y,z.push(a),Y();break}case"line":{Y();let o=new ue(w.fillStyle,+w.lineWidth,[(lt-x)/y,(ct-L)/y],[(n.clientX-x)/y,(n.clientY-L)/y],at,Q);o.zoom=y,z.push(o),Y();break}case"rectangle":{Y();let o=new de(w.fillStyle,+w.lineWidth,[(lt-x)/y,(ct-L)/y],[(n.clientX-x)/y,(n.clientY-L)/y],vt,at,pt,w.lineWidth,Q);o.zoom=y,o.draw(x,L),z.push(o);break}case"ellipse":Y();let s=new fe(w.fillStyle,+w.lineWidth,[(lt-x)/y,(ct-L)/y],[(n.clientX-x)/y,(n.clientY-L)/y],vt,at,pt,w.lineWidth,!1,Q);s.zoom=y,s.draw(x,L),z.push(s);break}let t="drawObj:::"+JSON.stringify(z[z.length-1])+":::";q.send(t.length),q.send(t)});function Nt(n){let t="delete:::"+JSON.stringify(n);q.send(t.length),q.send(t)}window.addEventListener("mousemove",n=>{if(n.button!==0)return;const e=n.target,t=n.clientX-rt.offsetWidth/2,s=n.clientY-rt.offsetHeight/2;if(e.id==="canvas"){ms(t,s,rt);let i="cur:::"+Q+":::"+ +(n.clientX/y-x/y)+":::"+ +(n.clientY/y-L/y)+":::";q.send(i.length),q.send(i)}if(qt){x=n.clientX-Ze,L=n.clientY-Ke,Y();return}if(!Ft)return;const o=n.clientX,a=n.clientY;switch(St){case"eraser":{let p=z.length;z=z.filter(f=>{if(f.typeName==="curve"){if(f.isCloseToPoints(n.clientX/y-x/y,n.clientY/y-L/y,10))return Nt(f),!1}else if(f.typeName==="rectangle"){if(f.isOverlay(-n.clientX+x,-n.clientY+L,1,1))return Nt(f),!1}else if(f.typeName==="line"){if(f.isCloseToPoints(n.clientX/y-x/y,n.clientY/y-L/y,25))return Nt(f),!1}else if(f.typeName==="ellipse"&&f.closeToCentre(n.clientX/y-x/y,n.clientY/y-L/y))return Nt(f),!1;return!0}),p!==z.length&&Y();break}case"pointer":break;case"pen":if(te==null||ee==null||!Ft){te=n.clientX,ee=n.clientY;return}let i=n.clientX,r=n.clientY;if(le++,le%As===0){ft.push([(i-x)/y,(r-L)/y]),Y();let p=new he(ft,w.fillStyle,w.lineWidth,w,Q);p.zoom=y,p.draw(x,L)}te=i,ee=r;break;case"line":Y();let l=new ue(w.fillStyle,+w.lineWidth,[(lt-x)/y,(ct-L)/y],[(o-x)/y,(a-L)/y],at,Q);l.zoom=y,l.draw(x,L);break;case"ellipse":Y();let h=new fe(w.fillStyle,+w.lineWidth,[(lt-x)/y,(ct-L)/y],[(o-x)/y,(a-L)/y],vt,at,pt,w.lineWidth,!1,Q);h.zoom=y,h.draw(x,L);break;case"rectangle":Y();let c=new de(w.fillStyle,+w.lineWidth,[(lt-x)/y,(ct-L)/y],[(o-x)/y,(a-L)/y],vt,at,pt,w.lineWidth,Q);c.zoom=y,c.draw(x,L);break}});window.addEventListener("resize",()=>{Y()});window.addEventListener("wheel",n=>{let e=document.documentElement.clientWidth/2,t=document.documentElement.clientHeight/2,s=(x+(y-1)*e)/y,o=(L+(y-1)*t)/y;y+=n.deltaY<0?.05:-.1,y<=.1?y=.1:y>=5&&(y=5),n.deltaY<0,x=s+(y-1)*(s-e),L=o+(y-1)*(o-t),Gt(),Y(),Pt.innerHTML=`${Math.floor(y*100)}%`});let se=[];document.addEventListener("keydown",function(n){const e=n.key.toLowerCase(),t=n.code;if(n.ctrlKey&&t==="KeyZ"){if(n.shiftKey){if(se.length===0)return;let l=se.pop();z.push(l),l.draw(x,L);let h="drawObj:::"+JSON.stringify(l)+":::";q.send(h.length),q.send(h);return}let o=z.filter(l=>l.userId===Q);if(o.length===0)return;let a=o[o.length-1];z=z.filter(l=>l!==a);let i=JSON.stringify(a);se.push(a),Y();let r="delete:::"+i;q.send(r.length),q.send(r)}if(e==="1"||t==="KeyF"){const o="pointer-btn";st(o),J(o)}if(e==="2"||t==="KeyE"){const o="eraser-btn";st(o),J(o)}if(e==="3"||t==="KeyP"){const o="pen-btn";st(o),J(o)}if(e==="4"||t==="KeyR"){const o="rectangle-btn";st(o),J(o)}if(e==="5"||t==="KeyV"){const o="line-btn";st(o),J(o)}if(e==="6"||t==="KeyC"){const o="ellipse-btn";st(o),J(o)}if(e==="7"||t==="KeyT"){const o="text-btn";st(o),J(o)}if(e==="8"||t==="KeyI"){const o="image-btn";st(o),J(o)}});function st(n){const e=document.getElementById(n);_t.forEach(t=>{t!==e&&t.classList.remove("active-shape")}),e.classList.add("active-shape"),St=e.dataset.shapeOption}const Fs=document.getElementById("save-btn");Fs.addEventListener("click",()=>{let n=_.toDataURL("imag/png"),e=document.createElement("a");e.href=n,e.download="sketch.png",e.click()});const qs=document.getElementById("clear-btn");qs.addEventListener("click",()=>{ge.style.display="flex"});const _s=document.getElementById("confirm-agree"),Rs=document.getElementById("confirm-cancel");Rs.addEventListener("click",()=>{ge.style.display="none"});_s.addEventListener("click",()=>{var n;z=[],w.clearRect(0,0,_.width,_.height),q.send(8),q.send("clear:::"),Dt.style.display="none",St="pointer",_t.forEach(e=>{e.classList.remove("active-shape")}),(n=document.getElementById("pointer-btn"))==null||n.classList.add("active-shape"),ge.style.display="none"});const ye=document.querySelector(".color-picker"),nt=document.getElementById("color-list"),je=document.querySelectorAll("#color-item"),Hs=document.getElementById("color-picker-input"),ke=document.getElementById("stroke-color-picker"),ot=document.getElementById("stroke-color-list"),De=document.querySelectorAll("#stroke-color-item"),Vs=document.getElementById("stroke-color-picker-input");ye.addEventListener("click",n=>{ot.style.display="none",n.stopPropagation(),nt.style.display==="grid"?nt.style.display="none":nt.style.display="grid"});for(let n=0;n<je.length;n++)je[n].addEventListener("click",t=>{const s=t.target;if(s===null)return;const o=s.style.backgroundColor;ye.style.backgroundColor=o,Ye(o,w,rt,+Mt.value),nt.style.display="none",rt.style.backgroundColor=s.style.backgroundColor});Hs.addEventListener("input",n=>{const e=n.target;if(e===null)return;const t="#"+e.value;t.length>1&&(ye.style.backgroundColor=t,Ye(t,w,rt,+Mt.value))});document.documentElement.addEventListener("click",n=>{nt.style.display==="grid"&&n.target!==nt&&(nt.style.display="none")});ke.addEventListener("click",n=>{nt.style.display="none",n.stopPropagation(),ot.style.display==="grid"?ot.style.display="none":ot.style.display="grid"});for(let n=0;n<De.length;n++)De[n].addEventListener("click",t=>{const s=t.target;if(s===null)return;const o=s.style.backgroundColor;ke.style.backgroundColor=o,pt=o,ot.style.display="none"});Vs.addEventListener("input",n=>{const e=n.target;if(e===null)return;const t="#"+e.value;t.length>1&&(ke.style.backgroundColor=t,pt=t)});document.documentElement.addEventListener("click",n=>{ot.style.display==="grid"&&n.target!==ot&&(ot.style.display="none")});const $e=document.querySelectorAll(".width-btn");$e.forEach(n=>{n.addEventListener("click",e=>{if(e.target===null)return;const t=e.target;w.lineWidth=parseInt(t.dataset.lineWidth),n.classList.add("active-width"),$e.forEach(s=>{s!==t&&s.classList.remove("active-width")})})});const Mt=document.getElementById("input-opacity");Mt.addEventListener("change",()=>{const n=w.fillStyle.startsWith("#")?Xe(w.fillStyle,Mt.value):Fe(w.fillStyle,+Mt.value);w.fillStyle=n});const Gs=document.getElementById("zoom-decrease"),Zs=document.getElementById("zoom-increase");Gs.addEventListener("click",()=>{y-=.1,y<=.1&&(y=.1),Gt(),Y(),Pt.innerHTML=`${Math.floor(y*100)}%`});Zs.addEventListener("click",()=>{y+=.1,y>=5&&(y=5),Gt(),Y(),Pt.innerHTML=`${Math.floor(y*100)}%`});Pt.addEventListener("click",n=>{n.stopPropagation(),y=1,Gt(),Y(),Pt.innerHTML="100%"});function Y(){ys(w),ks(z,x,L,document.documentElement.clientWidth,document.documentElement.clientHeight)}function Gt(){for(let n=0;n<z.length;n++){const e=z[n];e.zoom=y}}function J(n){switch(n.split("-")[0]){case"pointer":et.style.display="none";break;case"eraser":et.style.display="none";break;case"pen":et.style.display="flex",zt.style.display="none",Wt.style.display="none";break;case"rectangle":et.style.display="flex",zt.style.display="flex",Wt.style.display="flex";break;case"line":et.style.display="flex",zt.style.display="none",Wt.style.display="none";break;case"ellipse":et.style.display="flex",zt.style.display="flex",Wt.style.display="flex";break;case"text":et.style.display="none";break;case"image":et.style.display="none";break}}
