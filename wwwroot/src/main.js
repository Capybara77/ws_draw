var Ge=Object.defineProperty;var Ze=(n,e,t)=>e in n?Ge(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var S=(n,e,t)=>(Ze(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();function me(n,e,t,s=o=>o){return n*s(.5-e*(.5-t))}function Ke(n){return[-n[0],-n[1]]}function Z(n,e){return[n[0]+e[0],n[1]+e[1]]}function R(n,e){return[n[0]-e[0],n[1]-e[1]]}function G(n,e){return[n[0]*e,n[1]*e]}function Qe(n,e){return[n[0]/e,n[1]/e]}function ft(n){return[n[1],-n[0]]}function ge(n,e){return n[0]*e[0]+n[1]*e[1]}function Je(n,e){return n[0]===e[0]&&n[1]===e[1]}function Ue(n){return Math.hypot(n[0],n[1])}function ts(n){return n[0]*n[0]+n[1]*n[1]}function ye(n,e){return ts(R(n,e))}function Ie(n){return Qe(n,Ue(n))}function es(n,e){return Math.hypot(n[1]-e[1],n[0]-e[0])}function pt(n,e,t){let s=Math.sin(t),o=Math.cos(t),a=n[0]-e[0],i=n[1]-e[1],r=a*o-i*s,l=a*s+i*o;return[r+e[0],l+e[1]]}function Ut(n,e,t){return Z(n,G(R(e,n),t))}function ke(n,e,t){return Z(n,G(e,t))}var{min:at,PI:ss}=Math,be=.275,mt=ss+1e-4;function ns(n,e={}){let{size:t=16,smoothing:s=.5,thinning:o=.5,simulatePressure:a=!0,easing:i=P=>P,start:r={},end:l={},last:h=!1}=e,{cap:c=!0,easing:f=P=>P*(2-P)}=r,{cap:p=!0,easing:u=P=>--P*P*P+1}=l;if(n.length===0||t<=0)return[];let d=n[n.length-1].runningLength,g=r.taper===!1?0:r.taper===!0?Math.max(t,d):r.taper,m=l.taper===!1?0:l.taper===!0?Math.max(t,d):l.taper,k=Math.pow(t*s,2),w=[],C=[],W=n.slice(0,10).reduce((P,$)=>{let E=$.pressure;if(a){let z=at(1,$.distance/t),Rt=at(1,1-z);E=at(1,P+(Rt-P)*(z*be))}return(P+E)/2},n[0].pressure),M=me(t,o,n[n.length-1].pressure,i),T,D=n[0].vector,Y=n[0].point,H=Y,N=Y,j=H,rt=!1;for(let P=0;P<n.length;P++){let{pressure:$}=n[P],{point:E,vector:z,distance:Rt,runningLength:dt}=n[P];if(P<n.length-1&&d-dt<3)continue;if(o){if(a){let U=at(1,Rt/t),Ht=at(1,1-U);$=at(1,W+(Ht-W)*(U*be))}M=me(t,o,$,i)}else M=t/2;T===void 0&&(T=M);let qe=dt<g?f(dt/g):1,He=d-dt<m?u((d-dt)/m):1;M=Math.max(.01,M*Math.min(qe,He));let de=(P<n.length-1?n[P+1]:n[P]).vector,qt=P<n.length-1?ge(z,de):1,Ve=ge(z,D)<0&&!rt,fe=qt!==null&&qt<0;if(Ve||fe){let U=G(ft(D),M);for(let Ht=1/13,Lt=0;Lt<=1;Lt+=Ht)N=pt(R(E,U),E,mt*Lt),w.push(N),j=pt(Z(E,U),E,mt*-Lt),C.push(j);Y=N,H=j,fe&&(rt=!0);continue}if(rt=!1,P===n.length-1){let U=G(ft(z),M);w.push(R(E,U)),C.push(Z(E,U));continue}let pe=G(ft(Ut(de,z,qt)),M);N=R(E,pe),(P<=1||ye(Y,N)>k)&&(w.push(N),Y=N),j=Z(E,pe),(P<=1||ye(H,j)>k)&&(C.push(j),H=j),W=$,D=z}let A=n[0].point.slice(0,2),O=n.length>1?n[n.length-1].point.slice(0,2):Z(n[0].point,[1,1]),F=[],V=[];if(n.length===1){if(!(g||m)||h){let P=ke(A,Ie(ft(R(A,O))),-(T||M)),$=[];for(let E=1/13,z=E;z<=1;z+=E)$.push(pt(P,A,mt*2*z));return $}}else{if(!(g||m&&n.length===1))if(c)for(let $=1/13,E=$;E<=1;E+=$){let z=pt(C[0],A,mt*E);F.push(z)}else{let $=R(w[0],C[0]),E=G($,.5),z=G($,.51);F.push(R(A,E),R(A,z),Z(A,z),Z(A,E))}let P=ft(Ke(n[n.length-1].vector));if(m||g&&n.length===1)V.push(O);else if(p){let $=ke(O,P,M);for(let E=1/29,z=E;z<1;z+=E)V.push(pt($,O,mt*3*z))}else V.push(Z(O,G(P,M)),Z(O,G(P,M*.99)),R(O,G(P,M*.99)),R(O,G(P,M)))}return w.concat(V,C.reverse(),F)}function os(n,e={}){var t;let{streamline:s=.5,size:o=16,last:a=!1}=e;if(n.length===0)return[];let i=.15+(1-s)*.85,r=Array.isArray(n[0])?n:n.map(({x:u,y:d,pressure:g=.5})=>[u,d,g]);if(r.length===2){let u=r[1];r=r.slice(0,-1);for(let d=1;d<5;d++)r.push(Ut(r[0],u,d/4))}r.length===1&&(r=[...r,[...Z(r[0],[1,1]),...r[0].slice(2)]]);let l=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],h=!1,c=0,f=l[0],p=r.length-1;for(let u=1;u<r.length;u++){let d=a&&u===p?r[u].slice(0,2):Ut(f.point,r[u],i);if(Je(f.point,d))continue;let g=es(d,f.point);if(c+=g,u<p&&!h){if(c<o)continue;h=!0}f={point:d,pressure:r[u][2]>=0?r[u][2]:.5,vector:Ie(R(f.point,d)),distance:g,runningLength:c},l.push(f)}return l[0].vector=((t=l[1])==null?void 0:t.vector)||[0,0],l}function is(n,e={}){return ns(os(n,e),e)}var rs=is;function as(n,e,t){let s=JSON.parse(n);switch(s.typeName){case"rectangle":let{color:a,width:i,startPoint:r,endPoint:l,fillStyle:h,stroke:c,strokeWidth:f,userId:p,zoom:u,objId:d}=s,g=new ae(a,i,r,l,h,e,c,f,p);return g.objId=d,g.zoom=u,g;case"ellipse":{let{color:m,width:k,startPoint:w,endPoint:C,fillStyle:W,stroke:M,strokeWidth:T,isCircle:D,userId:Y,zoom:H,objId:N}=s,j=new le(m,k,w,C,W,e,M,T,D,Y);return j.objId=N,j.zoom=H,j}case"line":{let{color:m,width:k,startPoint:w,endPoint:C,userId:W,zoom:M,objId:T}=s,D=new re(m,k,w,C,e,W);return D.zoom=M,D.objId=T,D}case"curve":{let{pointsList:m,color:k,width:w,userId:C,zoom:W,objId:M}=s,T=new ie(m,k,w,t,C);return T.objId=M,T.zoom=W,T}default:return null}}function ls(n,e,t){const s={transform:`translate(${n}px, ${e}px)`};t.animate(s,{fill:"forwards"})}function We(n,e,t,s){e.fillStyle=Ae(n,s),t.style.backgroundColor=n;const o=document.getElementsByClassName("trailer");for(let a=0;a<o.length;a++){const i=o[a];i.style.backgroundColor=n}}function St(n,e){return(n+e)/2}function cs(n,e=!0){const t=n.length;if(t<4)return"";let s=n[0],o=n[1];const a=n[2];let i=`M${s[0].toFixed(2)},${s[1].toFixed(2)} Q${o[0].toFixed(2)},${o[1].toFixed(2)} ${St(o[0],a[0]).toFixed(2)},${St(o[1],a[1]).toFixed(2)} T`;for(let r=2,l=t-1;r<l;r++)s=n[r],o=n[r+1],i+=`${St(s[0],o[0]).toFixed(2)},${St(s[1],o[1]).toFixed(2)} `;return e&&(i+="Z"),i}function Ne(n,e="1"){let t,s;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(n))return t=n.substring(1).split(""),t.length==3&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),s=+("0x"+t.join("")),"rgba("+[s>>16&255,s>>8&255,s&255].join(",")+","+e+")";throw new Error("Bad Hex")}function Ae(n,e){let t=n.slice(n.indexOf("(")+1,n.indexOf(")")).split(", ");return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function De(n){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s=t.length;for(let o=0;o<n;o++)e+=t.charAt(Math.floor(Math.random()*s));return e}function hs(n){n.clearRect(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight)}function us(n,e,t,s,o){let a=0;for(let i=0;i<n.length;i++){const r=n[i];r.isOverlay(e,t,s,o)&&(r.draw(e,t),a++)}console.log(n.length+"  "+a)}class Ft{constructor(e,t,s){S(this,"color");S(this,"width");S(this,"userId");S(this,"typeName","");S(this,"tempObj",!1);S(this,"zoom",1);S(this,"objId",De(5));this.color=e,this.width=t,this.userId=s}draw(e,t){console.log("offset:",e,t)}isOverlay(e,t,s,o){return!0}}class ie extends Ft{constructor(t,s,o,a,i){super(s,o,i);S(this,"pointsList");S(this,"ctx");S(this,"typeName","curve");this.pointsList=t,this.ctx=a,this.userId=i}draw(t,s){let o=[];for(let h=0;h<this.pointsList.length;h++){let c=this.pointsList[h];o.push([c[0]*this.zoom+t,c[1]*this.zoom+s])}const a=rs(o,{size:this.width*this.zoom,thinning:.7}),i=cs(a),r=new Path2D(i);let l=this.ctx.fillStyle;this.ctx.fillStyle=this.color.startsWith("#")?Ne(this.color):this.color,this.ctx.fill(r),this.ctx.fillStyle=l}isCloseToPoints(t,s,o){if(this.pointsList.length===0)return!1;for(let a=0;a<this.pointsList.length;a++){const i=this.pointsList[a];if(Math.sqrt(Math.pow(t-i[0],2)+Math.pow(s-i[1],2))<o)return!0}return!1}isOverlay(t,s,o,a){if(t*=-1,s*=-1,this.pointsList.length===0)return!1;let i=this.pointsList[0][0],r=this.pointsList[0][0],l=this.pointsList[0][1],h=this.pointsList[0][1];for(let d=0;d<this.pointsList.length;d++){const g=this.pointsList[d];i=i>g[0]?g[0]:i,r=r<g[0]?g[0]:r,l=l>g[1]?g[1]:l,h=h<g[1]?g[1]:h}i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=s,p=t+o,u=s+a;return(i>=c&&i<=p||r>=c&&r<=p)&&(l>=f&&l<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=l&&f<=h||u>=l&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=l&&f<=h||u>=l&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(l>=f&&l<=u||h>=f&&h<=u)}}class re extends Ft{constructor(t,s,o,a,i,r){super(t,s,r);S(this,"startPoint");S(this,"endPoint");S(this,"roughCanvas");S(this,"typeName","line");this.startPoint=o,this.endPoint=a,this.roughCanvas=i,this.userId=r}draw(t,s){this.roughCanvas.line(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+s,this.endPoint[0]*this.zoom+t,this.endPoint[1]*this.zoom+s,{strokeWidth:this.width*this.zoom,stroke:this.color,seed:1})}isOverlay(t,s,o,a){t*=-1,s*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),l=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=s,p=t+o,u=s+a;return(i>=c&&i<=p||r>=c&&r<=p)&&(l>=f&&l<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=l&&f<=h||u>=l&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=l&&f<=h||u>=l&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(l>=f&&l<=u||h>=f&&h<=u)}isCloseToPoints(t,s,o){return Math.sqrt(Math.pow(t-this.startPoint[0],2)+Math.pow(s-this.startPoint[1],2))<o||Math.sqrt(Math.pow(t-this.endPoint[0],2)+Math.pow(s-this.endPoint[1],2))<o}}class ae extends Ft{constructor(t,s,o,a,i,r,l,h,c){super(t,s,c);S(this,"startPoint");S(this,"endPoint");S(this,"roughCanvas");S(this,"fillStyle");S(this,"typeName","rectangle");S(this,"stroke");S(this,"strokeWidth");S(this,"drawableObj",null);this.startPoint=o,this.endPoint=a,this.roughCanvas=r,this.fillStyle=i,this.stroke=l,this.strokeWidth=h,this.userId=c}draw(t,s){let o=(this.endPoint[0]-this.startPoint[0])*this.zoom,a=(this.endPoint[1]-this.startPoint[1])*this.zoom;this.roughCanvas.rectangle(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+s,o,a,{strokeWidth:this.width*this.zoom,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}isOverlay(t,s,o,a){t*=-1,s*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),l=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=s,p=t+o,u=s+a;return(i>=c&&i<=p||r>=c&&r<=p)&&(l>=f&&l<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=l&&f<=h||u>=l&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=l&&f<=h||u>=l&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(l>=f&&l<=u||h>=f&&h<=u)}}class le extends Ft{constructor(t,s,o,a,i,r,l,h,c,f){super(t,s,f);S(this,"startPoint");S(this,"endPoint");S(this,"roughCanvas");S(this,"fillStyle");S(this,"typeName","ellipse");S(this,"stroke");S(this,"strokeWidth");S(this,"drawableObj",null);S(this,"isCircle");this.startPoint=o,this.endPoint=a,this.roughCanvas=r,this.fillStyle=i,this.stroke=l,this.strokeWidth=h,this.isCircle=c,this.userId=this.userId}draw(t,s){let o=(this.endPoint[0]-this.startPoint[0])*this.zoom,a=(this.endPoint[1]-this.startPoint[1])*this.zoom;this.roughCanvas.ellipse(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+s,o*2,a*2,{strokeWidth:this.width*this.zoom,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}isOverlay(t,s,o,a){t*=-1,s*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),l=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,l*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=s,p=t+o,u=s+a;return(i>=c&&i<=p||r>=c&&r<=p)&&(l>=f&&l<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=l&&f<=h||u>=l&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=l&&f<=h||u>=l&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(l>=f&&l<=u||h>=f&&h<=u)}closeToCentre(t,s){return Math.sqrt(Math.pow(t-this.startPoint[0],2)+Math.pow(s-this.startPoint[1],2))<Math.max(Math.min(Math.abs(Math.abs(this.startPoint[0])-Math.abs(this.endPoint[0])),Math.abs(Math.abs(this.startPoint[1])-Math.abs(this.endPoint[1]))),10)}}function Vt(n,e,t){if(n&&n.length){const[s,o]=e,a=Math.PI/180*t,i=Math.cos(a),r=Math.sin(a);n.forEach(l=>{const[h,c]=l;l[0]=(h-s)*i-(c-o)*r+s,l[1]=(h-s)*r+(c-o)*i+o})}}function Bt(n){const e=n[0],t=n[1];return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Pt(n,e){const t=e.hachureAngle+90;let s=e.hachureGap;s<0&&(s=4*e.strokeWidth),s=Math.max(s,.1);const o=[0,0];if(t)for(const i of n)Vt(i,o,t);const a=function(i,r){const l=[];for(const u of i){const d=[...u];d[0].join(",")!==d[d.length-1].join(",")&&d.push([d[0][0],d[0][1]]),d.length>2&&l.push(d)}const h=[];r=Math.max(r,.1);const c=[];for(const u of l)for(let d=0;d<u.length-1;d++){const g=u[d],m=u[d+1];if(g[1]!==m[1]){const k=Math.min(g[1],m[1]);c.push({ymin:k,ymax:Math.max(g[1],m[1]),x:k===g[1]?g[0]:m[0],islope:(m[0]-g[0])/(m[1]-g[1])})}}if(c.sort((u,d)=>u.ymin<d.ymin?-1:u.ymin>d.ymin?1:u.x<d.x?-1:u.x>d.x?1:u.ymax===d.ymax?0:(u.ymax-d.ymax)/Math.abs(u.ymax-d.ymax)),!c.length)return h;let f=[],p=c[0].ymin;for(;f.length||c.length;){if(c.length){let u=-1;for(let d=0;d<c.length&&!(c[d].ymin>p);d++)u=d;c.splice(0,u+1).forEach(d=>{f.push({s:p,edge:d})})}if(f=f.filter(u=>!(u.edge.ymax<=p)),f.sort((u,d)=>u.edge.x===d.edge.x?0:(u.edge.x-d.edge.x)/Math.abs(u.edge.x-d.edge.x)),f.length>1)for(let u=0;u<f.length;u+=2){const d=u+1;if(d>=f.length)break;const g=f[u].edge,m=f[d].edge;h.push([[Math.round(g.x),p],[Math.round(m.x),p]])}p+=r,f.forEach(u=>{u.edge.x=u.edge.x+r*u.edge.islope})}return h}(n,s);if(t){for(const i of n)Vt(i,o,-t);(function(i,r,l){const h=[];i.forEach(c=>h.push(...c)),Vt(h,r,l)})(a,o,-t)}return a}class ce{constructor(e){this.helper=e}fillPolygons(e,t){return this._fillPolygons(e,t)}_fillPolygons(e,t){const s=Pt(e,t);return{type:"fillSketch",ops:this.renderLines(s,t)}}renderLines(e,t){const s=[];for(const o of e)s.push(...this.helper.doubleLineOps(o[0][0],o[0][1],o[1][0],o[1][1],t));return s}}class ds extends ce{fillPolygons(e,t){let s=t.hachureGap;s<0&&(s=4*t.strokeWidth),s=Math.max(s,.1);const o=Pt(e,Object.assign({},t,{hachureGap:s})),a=Math.PI/180*t.hachureAngle,i=[],r=.5*s*Math.cos(a),l=.5*s*Math.sin(a);for(const[h,c]of o)Bt([h,c])&&i.push([[h[0]-r,h[1]+l],[...c]],[[h[0]+r,h[1]-l],[...c]]);return{type:"fillSketch",ops:this.renderLines(i,t)}}}class fs extends ce{fillPolygons(e,t){const s=this._fillPolygons(e,t),o=Object.assign({},t,{hachureAngle:t.hachureAngle+90}),a=this._fillPolygons(e,o);return s.ops=s.ops.concat(a.ops),s}}class ps{constructor(e){this.helper=e}fillPolygons(e,t){const s=Pt(e,t=Object.assign({},t,{hachureAngle:0}));return this.dotsOnLines(s,t)}dotsOnLines(e,t){const s=[];let o=t.hachureGap;o<0&&(o=4*t.strokeWidth),o=Math.max(o,.1);let a=t.fillWeight;a<0&&(a=t.strokeWidth/2);const i=o/4;for(const r of e){const l=Bt(r),h=l/o,c=Math.ceil(h)-1,f=l-c*o,p=(r[0][0]+r[1][0])/2-o/4,u=Math.min(r[0][1],r[1][1]);for(let d=0;d<c;d++){const g=u+f+d*o,m=p-i+2*Math.random()*i,k=g-i+2*Math.random()*i,w=this.helper.ellipse(m,k,a,a,t);s.push(...w.ops)}}return{type:"fillSketch",ops:s}}}class ms{constructor(e){this.helper=e}fillPolygons(e,t){const s=Pt(e,t);return{type:"fillSketch",ops:this.dashedLine(s,t)}}dashedLine(e,t){const s=t.dashOffset<0?t.hachureGap<0?4*t.strokeWidth:t.hachureGap:t.dashOffset,o=t.dashGap<0?t.hachureGap<0?4*t.strokeWidth:t.hachureGap:t.dashGap,a=[];return e.forEach(i=>{const r=Bt(i),l=Math.floor(r/(s+o)),h=(r+o-l*(s+o))/2;let c=i[0],f=i[1];c[0]>f[0]&&(c=i[1],f=i[0]);const p=Math.atan((f[1]-c[1])/(f[0]-c[0]));for(let u=0;u<l;u++){const d=u*(s+o),g=d+s,m=[c[0]+d*Math.cos(p)+h*Math.cos(p),c[1]+d*Math.sin(p)+h*Math.sin(p)],k=[c[0]+g*Math.cos(p)+h*Math.cos(p),c[1]+g*Math.sin(p)+h*Math.sin(p)];a.push(...this.helper.doubleLineOps(m[0],m[1],k[0],k[1],t))}}),a}}class gs{constructor(e){this.helper=e}fillPolygons(e,t){const s=t.hachureGap<0?4*t.strokeWidth:t.hachureGap,o=t.zigzagOffset<0?s:t.zigzagOffset,a=Pt(e,t=Object.assign({},t,{hachureGap:s+o}));return{type:"fillSketch",ops:this.zigzagLines(a,o,t)}}zigzagLines(e,t,s){const o=[];return e.forEach(a=>{const i=Bt(a),r=Math.round(i/(2*t));let l=a[0],h=a[1];l[0]>h[0]&&(l=a[1],h=a[0]);const c=Math.atan((h[1]-l[1])/(h[0]-l[0]));for(let f=0;f<r;f++){const p=2*f*t,u=2*(f+1)*t,d=Math.sqrt(2*Math.pow(t,2)),g=[l[0]+p*Math.cos(c),l[1]+p*Math.sin(c)],m=[l[0]+u*Math.cos(c),l[1]+u*Math.sin(c)],k=[g[0]+d*Math.cos(c+Math.PI/4),g[1]+d*Math.sin(c+Math.PI/4)];o.push(...this.helper.doubleLineOps(g[0],g[1],k[0],k[1],s),...this.helper.doubleLineOps(k[0],k[1],m[0],m[1],s))}}),o}}const B={};class ys{constructor(e){this.seed=e}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const Ot={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Gt(n,e){return n.type===e}function te(n){const e=[],t=function(i){const r=new Array;for(;i!=="";)if(i.match(/^([ \t\r\n,]+)/))i=i.substr(RegExp.$1.length);else if(i.match(/^([aAcChHlLmMqQsStTvVzZ])/))r[r.length]={type:0,text:RegExp.$1},i=i.substr(RegExp.$1.length);else{if(!i.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];r[r.length]={type:1,text:`${parseFloat(RegExp.$1)}`},i=i.substr(RegExp.$1.length)}return r[r.length]={type:2,text:""},r}(n);let s="BOD",o=0,a=t[o];for(;!Gt(a,2);){let i=0;const r=[];if(s==="BOD"){if(a.text!=="M"&&a.text!=="m")return te("M0,0"+n);o++,i=Ot[a.text],s=a.text}else Gt(a,1)?i=Ot[s]:(o++,i=Ot[a.text],s=a.text);if(!(o+i<t.length))throw new Error("Path data ended short");for(let l=o;l<o+i;l++){const h=t[l];if(!Gt(h,1))throw new Error("Param not a number: "+s+","+h.text);r[r.length]=+h.text}if(typeof Ot[s]!="number")throw new Error("Bad segment: "+s);{const l={key:s,data:r};e.push(l),o+=i,a=t[o],s==="M"&&(s="L"),s==="m"&&(s="l")}}return e}function we(n){let e=0,t=0,s=0,o=0;const a=[];for(const{key:i,data:r}of n)switch(i){case"M":a.push({key:"M",data:[...r]}),[e,t]=r,[s,o]=r;break;case"m":e+=r[0],t+=r[1],a.push({key:"M",data:[e,t]}),s=e,o=t;break;case"L":a.push({key:"L",data:[...r]}),[e,t]=r;break;case"l":e+=r[0],t+=r[1],a.push({key:"L",data:[e,t]});break;case"C":a.push({key:"C",data:[...r]}),e=r[4],t=r[5];break;case"c":{const l=r.map((h,c)=>c%2?h+t:h+e);a.push({key:"C",data:l}),e=l[4],t=l[5];break}case"Q":a.push({key:"Q",data:[...r]}),e=r[2],t=r[3];break;case"q":{const l=r.map((h,c)=>c%2?h+t:h+e);a.push({key:"Q",data:l}),e=l[2],t=l[3];break}case"A":a.push({key:"A",data:[...r]}),e=r[5],t=r[6];break;case"a":e+=r[5],t+=r[6],a.push({key:"A",data:[r[0],r[1],r[2],r[3],r[4],e,t]});break;case"H":a.push({key:"H",data:[...r]}),e=r[0];break;case"h":e+=r[0],a.push({key:"H",data:[e]});break;case"V":a.push({key:"V",data:[...r]}),t=r[0];break;case"v":t+=r[0],a.push({key:"V",data:[t]});break;case"S":a.push({key:"S",data:[...r]}),e=r[2],t=r[3];break;case"s":{const l=r.map((h,c)=>c%2?h+t:h+e);a.push({key:"S",data:l}),e=l[2],t=l[3];break}case"T":a.push({key:"T",data:[...r]}),e=r[0],t=r[1];break;case"t":e+=r[0],t+=r[1],a.push({key:"T",data:[e,t]});break;case"Z":case"z":a.push({key:"Z",data:[]}),e=s,t=o}return a}function Me(n){const e=[];let t="",s=0,o=0,a=0,i=0,r=0,l=0;for(const{key:h,data:c}of n){switch(h){case"M":e.push({key:"M",data:[...c]}),[s,o]=c,[a,i]=c;break;case"C":e.push({key:"C",data:[...c]}),s=c[4],o=c[5],r=c[2],l=c[3];break;case"L":e.push({key:"L",data:[...c]}),[s,o]=c;break;case"H":s=c[0],e.push({key:"L",data:[s,o]});break;case"V":o=c[0],e.push({key:"L",data:[s,o]});break;case"S":{let f=0,p=0;t==="C"||t==="S"?(f=s+(s-r),p=o+(o-l)):(f=s,p=o),e.push({key:"C",data:[f,p,...c]}),r=c[0],l=c[1],s=c[2],o=c[3];break}case"T":{const[f,p]=c;let u=0,d=0;t==="Q"||t==="T"?(u=s+(s-r),d=o+(o-l)):(u=s,d=o);const g=s+2*(u-s)/3,m=o+2*(d-o)/3,k=f+2*(u-f)/3,w=p+2*(d-p)/3;e.push({key:"C",data:[g,m,k,w,f,p]}),r=u,l=d,s=f,o=p;break}case"Q":{const[f,p,u,d]=c,g=s+2*(f-s)/3,m=o+2*(p-o)/3,k=u+2*(f-u)/3,w=d+2*(p-d)/3;e.push({key:"C",data:[g,m,k,w,u,d]}),r=f,l=p,s=u,o=d;break}case"A":{const f=Math.abs(c[0]),p=Math.abs(c[1]),u=c[2],d=c[3],g=c[4],m=c[5],k=c[6];f===0||p===0?(e.push({key:"C",data:[s,o,m,k,m,k]}),s=m,o=k):(s!==m||o!==k)&&(je(s,o,m,k,f,p,u,d,g).forEach(function(w){e.push({key:"C",data:w})}),s=m,o=k);break}case"Z":e.push({key:"Z",data:[]}),s=a,o=i}t=h}return e}function gt(n,e,t){return[n*Math.cos(t)-e*Math.sin(t),n*Math.sin(t)+e*Math.cos(t)]}function je(n,e,t,s,o,a,i,r,l,h){const c=(f=i,Math.PI*f/180);var f;let p=[],u=0,d=0,g=0,m=0;if(h)[u,d,g,m]=h;else{[n,e]=gt(n,e,-c),[t,s]=gt(t,s,-c);const A=(n-t)/2,O=(e-s)/2;let F=A*A/(o*o)+O*O/(a*a);F>1&&(F=Math.sqrt(F),o*=F,a*=F);const V=o*o,P=a*a,$=V*P-V*O*O-P*A*A,E=V*O*O+P*A*A,z=(r===l?-1:1)*Math.sqrt(Math.abs($/E));g=z*o*O/a+(n+t)/2,m=z*-a*A/o+(e+s)/2,u=Math.asin(parseFloat(((e-m)/a).toFixed(9))),d=Math.asin(parseFloat(((s-m)/a).toFixed(9))),n<g&&(u=Math.PI-u),t<g&&(d=Math.PI-d),u<0&&(u=2*Math.PI+u),d<0&&(d=2*Math.PI+d),l&&u>d&&(u-=2*Math.PI),!l&&d>u&&(d-=2*Math.PI)}let k=d-u;if(Math.abs(k)>120*Math.PI/180){const A=d,O=t,F=s;d=l&&d>u?u+120*Math.PI/180*1:u+120*Math.PI/180*-1,p=je(t=g+o*Math.cos(d),s=m+a*Math.sin(d),O,F,o,a,i,0,l,[d,A,g,m])}k=d-u;const w=Math.cos(u),C=Math.sin(u),W=Math.cos(d),M=Math.sin(d),T=Math.tan(k/4),D=4/3*o*T,Y=4/3*a*T,H=[n,e],N=[n+D*C,e-Y*w],j=[t+D*M,s-Y*W],rt=[t,s];if(N[0]=2*H[0]-N[0],N[1]=2*H[1]-N[1],h)return[N,j,rt].concat(p);{p=[N,j,rt].concat(p);const A=[];for(let O=0;O<p.length;O+=3){const F=gt(p[O][0],p[O][1],c),V=gt(p[O+1][0],p[O+1][1],c),P=gt(p[O+2][0],p[O+2][1],c);A.push([F[0],F[1],V[0],V[1],P[0],P[1]])}return A}}const ks={randOffset:function(n,e){return b(n,e)},randOffsetWithRange:function(n,e,t){return Wt(n,e,t)},ellipse:function(n,e,t,s,o){const a=Ye(t,s,o);return ee(n,e,o,a).opset},doubleLineOps:function(n,e,t,s,o){return J(n,e,t,s,o,!0)}};function $e(n,e,t,s,o){return{type:"path",ops:J(n,e,t,s,o)}}function Tt(n,e,t){const s=(n||[]).length;if(s>2){const o=[];for(let a=0;a<s-1;a++)o.push(...J(n[a][0],n[a][1],n[a+1][0],n[a+1][1],t));return e&&o.push(...J(n[s-1][0],n[s-1][1],n[0][0],n[0][1],t)),{type:"path",ops:o}}return s===2?$e(n[0][0],n[0][1],n[1][0],n[1][1],t):{type:"path",ops:[]}}function bs(n,e,t,s,o){return function(a,i){return Tt(a,!0,i)}([[n,e],[n+t,e],[n+t,e+s],[n,e+s]],o)}function ws(n,e){let t=xe(n,1*(1+.2*e.roughness),e);if(!e.disableMultiStroke){const s=xe(n,1.5*(1+.22*e.roughness),function(o){const a=Object.assign({},o);return a.randomizer=void 0,o.seed&&(a.seed=o.seed+1),a}(e));t=t.concat(s)}return{type:"path",ops:t}}function Ye(n,e,t){const s=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(n/2,2)+Math.pow(e/2,2))/2)),o=Math.ceil(Math.max(t.curveStepCount,t.curveStepCount/Math.sqrt(200)*s)),a=2*Math.PI/o;let i=Math.abs(n/2),r=Math.abs(e/2);const l=1-t.curveFitting;return i+=b(i*l,t),r+=b(r*l,t),{increment:a,rx:i,ry:r}}function ee(n,e,t,s){const[o,a]=Le(s.increment,n,e,s.rx,s.ry,1,s.increment*Wt(.1,Wt(.4,1,t),t),t);let i=Nt(o,null,t);if(!t.disableMultiStroke&&t.roughness!==0){const[r]=Le(s.increment,n,e,s.rx,s.ry,1.5,0,t),l=Nt(r,null,t);i=i.concat(l)}return{estimatedPoints:a,opset:{type:"path",ops:i}}}function ve(n,e,t,s,o,a,i,r,l){const h=n,c=e;let f=Math.abs(t/2),p=Math.abs(s/2);f+=b(.01*f,l),p+=b(.01*p,l);let u=o,d=a;for(;u<0;)u+=2*Math.PI,d+=2*Math.PI;d-u>2*Math.PI&&(u=0,d=2*Math.PI);const g=2*Math.PI/l.curveStepCount,m=Math.min(g/2,(d-u)/2),k=Se(m,h,c,f,p,u,d,1,l);if(!l.disableMultiStroke){const w=Se(m,h,c,f,p,u,d,1.5,l);k.push(...w)}return i&&(r?k.push(...J(h,c,h+f*Math.cos(u),c+p*Math.sin(u),l),...J(h,c,h+f*Math.cos(d),c+p*Math.sin(d),l)):k.push({op:"lineTo",data:[h,c]},{op:"lineTo",data:[h+f*Math.cos(u),c+p*Math.sin(u)]})),{type:"path",ops:k}}function Et(n,e){const t=[];for(const s of n)if(s.length){const o=e.maxRandomnessOffset||0,a=s.length;if(a>2){t.push({op:"move",data:[s[0][0]+b(o,e),s[0][1]+b(o,e)]});for(let i=1;i<a;i++)t.push({op:"lineTo",data:[s[i][0]+b(o,e),s[i][1]+b(o,e)]})}}return{type:"fillPath",ops:t}}function lt(n,e){return function(t,s){let o=t.fillStyle||"hachure";if(!B[o])switch(o){case"zigzag":B[o]||(B[o]=new ds(s));break;case"cross-hatch":B[o]||(B[o]=new fs(s));break;case"dots":B[o]||(B[o]=new ps(s));break;case"dashed":B[o]||(B[o]=new ms(s));break;case"zigzag-line":B[o]||(B[o]=new gs(s));break;case"hachure":default:o="hachure",B[o]||(B[o]=new ce(s))}return B[o]}(e,ks).fillPolygons(n,e)}function Xe(n){return n.randomizer||(n.randomizer=new ys(n.seed||0)),n.randomizer.next()}function Wt(n,e,t,s=1){return t.roughness*s*(Xe(t)*(e-n)+n)}function b(n,e,t=1){return Wt(-n,n,e,t)}function J(n,e,t,s,o,a=!1){const i=a?o.disableMultiStrokeFill:o.disableMultiStroke,r=Pe(n,e,t,s,o,!0,!1);if(i)return r;const l=Pe(n,e,t,s,o,!0,!0);return r.concat(l)}function Pe(n,e,t,s,o,a,i){const r=Math.pow(n-t,2)+Math.pow(e-s,2),l=Math.sqrt(r);let h=1;h=l<200?1:l>500?.4:-.0016668*l+1.233334;let c=o.maxRandomnessOffset||0;c*c*100>r&&(c=l/10);const f=c/2,p=.2+.2*Xe(o);let u=o.bowing*o.maxRandomnessOffset*(s-e)/200,d=o.bowing*o.maxRandomnessOffset*(n-t)/200;u=b(u,o,h),d=b(d,o,h);const g=[],m=()=>b(f,o,h),k=()=>b(c,o,h),w=o.preserveVertices;return a&&(i?g.push({op:"move",data:[n+(w?0:m()),e+(w?0:m())]}):g.push({op:"move",data:[n+(w?0:b(c,o,h)),e+(w?0:b(c,o,h))]})),i?g.push({op:"bcurveTo",data:[u+n+(t-n)*p+m(),d+e+(s-e)*p+m(),u+n+2*(t-n)*p+m(),d+e+2*(s-e)*p+m(),t+(w?0:m()),s+(w?0:m())]}):g.push({op:"bcurveTo",data:[u+n+(t-n)*p+k(),d+e+(s-e)*p+k(),u+n+2*(t-n)*p+k(),d+e+2*(s-e)*p+k(),t+(w?0:k()),s+(w?0:k())]}),g}function xe(n,e,t){const s=[];s.push([n[0][0]+b(e,t),n[0][1]+b(e,t)]),s.push([n[0][0]+b(e,t),n[0][1]+b(e,t)]);for(let o=1;o<n.length;o++)s.push([n[o][0]+b(e,t),n[o][1]+b(e,t)]),o===n.length-1&&s.push([n[o][0]+b(e,t),n[o][1]+b(e,t)]);return Nt(s,null,t)}function Nt(n,e,t){const s=n.length,o=[];if(s>3){const a=[],i=1-t.curveTightness;o.push({op:"move",data:[n[1][0],n[1][1]]});for(let r=1;r+2<s;r++){const l=n[r];a[0]=[l[0],l[1]],a[1]=[l[0]+(i*n[r+1][0]-i*n[r-1][0])/6,l[1]+(i*n[r+1][1]-i*n[r-1][1])/6],a[2]=[n[r+1][0]+(i*n[r][0]-i*n[r+2][0])/6,n[r+1][1]+(i*n[r][1]-i*n[r+2][1])/6],a[3]=[n[r+1][0],n[r+1][1]],o.push({op:"bcurveTo",data:[a[1][0],a[1][1],a[2][0],a[2][1],a[3][0],a[3][1]]})}if(e&&e.length===2){const r=t.maxRandomnessOffset;o.push({op:"lineTo",data:[e[0]+b(r,t),e[1]+b(r,t)]})}}else s===3?(o.push({op:"move",data:[n[1][0],n[1][1]]}),o.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):s===2&&o.push(...J(n[0][0],n[0][1],n[1][0],n[1][1],t));return o}function Le(n,e,t,s,o,a,i,r){const l=[],h=[];if(r.roughness===0){n/=4,h.push([e+s*Math.cos(-n),t+o*Math.sin(-n)]);for(let c=0;c<=2*Math.PI;c+=n){const f=[e+s*Math.cos(c),t+o*Math.sin(c)];l.push(f),h.push(f)}h.push([e+s*Math.cos(0),t+o*Math.sin(0)]),h.push([e+s*Math.cos(n),t+o*Math.sin(n)])}else{const c=b(.5,r)-Math.PI/2;h.push([b(a,r)+e+.9*s*Math.cos(c-n),b(a,r)+t+.9*o*Math.sin(c-n)]);const f=2*Math.PI+c-.01;for(let p=c;p<f;p+=n){const u=[b(a,r)+e+s*Math.cos(p),b(a,r)+t+o*Math.sin(p)];l.push(u),h.push(u)}h.push([b(a,r)+e+s*Math.cos(c+2*Math.PI+.5*i),b(a,r)+t+o*Math.sin(c+2*Math.PI+.5*i)]),h.push([b(a,r)+e+.98*s*Math.cos(c+i),b(a,r)+t+.98*o*Math.sin(c+i)]),h.push([b(a,r)+e+.9*s*Math.cos(c+.5*i),b(a,r)+t+.9*o*Math.sin(c+.5*i)])}return[h,l]}function Se(n,e,t,s,o,a,i,r,l){const h=a+b(.1,l),c=[];c.push([b(r,l)+e+.9*s*Math.cos(h-n),b(r,l)+t+.9*o*Math.sin(h-n)]);for(let f=h;f<=i;f+=n)c.push([b(r,l)+e+s*Math.cos(f),b(r,l)+t+o*Math.sin(f)]);return c.push([e+s*Math.cos(i),t+o*Math.sin(i)]),c.push([e+s*Math.cos(i),t+o*Math.sin(i)]),Nt(c,null,l)}function Ms(n,e,t,s,o,a,i,r){const l=[],h=[r.maxRandomnessOffset||1,(r.maxRandomnessOffset||1)+.3];let c=[0,0];const f=r.disableMultiStroke?1:2,p=r.preserveVertices;for(let u=0;u<f;u++)u===0?l.push({op:"move",data:[i[0],i[1]]}):l.push({op:"move",data:[i[0]+(p?0:b(h[0],r)),i[1]+(p?0:b(h[0],r))]}),c=p?[o,a]:[o+b(h[u],r),a+b(h[u],r)],l.push({op:"bcurveTo",data:[n+b(h[u],r),e+b(h[u],r),t+b(h[u],r),s+b(h[u],r),c[0],c[1]]});return l}function yt(n){return[...n]}function zt(n,e){return Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)}function vs(n,e,t){const s=zt(e,t);if(s===0)return zt(n,e);let o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/s;return o=Math.max(0,Math.min(1,o)),zt(n,st(e,t,o))}function st(n,e,t){return[n[0]+(e[0]-n[0])*t,n[1]+(e[1]-n[1])*t]}function se(n,e,t,s){const o=s||[];if(function(r,l){const h=r[l+0],c=r[l+1],f=r[l+2],p=r[l+3];let u=3*c[0]-2*h[0]-p[0];u*=u;let d=3*c[1]-2*h[1]-p[1];d*=d;let g=3*f[0]-2*p[0]-h[0];g*=g;let m=3*f[1]-2*p[1]-h[1];return m*=m,u<g&&(u=g),d<m&&(d=m),u+d}(n,e)<t){const r=n[e+0];o.length?(a=o[o.length-1],i=r,Math.sqrt(zt(a,i))>1&&o.push(r)):o.push(r),o.push(n[e+3])}else{const l=n[e+0],h=n[e+1],c=n[e+2],f=n[e+3],p=st(l,h,.5),u=st(h,c,.5),d=st(c,f,.5),g=st(p,u,.5),m=st(u,d,.5),k=st(g,m,.5);se([l,p,g,k],0,t,o),se([k,m,d,f],0,t,o)}var a,i;return o}function Ps(n,e){return At(n,0,n.length,e)}function At(n,e,t,s,o){const a=o||[],i=n[e],r=n[t-1];let l=0,h=1;for(let c=e+1;c<t-1;++c){const f=vs(n[c],i,r);f>l&&(l=f,h=c)}return Math.sqrt(l)>s?(At(n,e,h+1,s,a),At(n,h,t,s,a)):(a.length||a.push(i),a.push(r)),a}function Oe(n,e=.15,t){const s=[],o=(n.length-1)/3;for(let a=0;a<o;a++)se(n,3*a,e,s);return t&&t>0?At(s,0,s.length,t):s}const _="none";class Dt{constructor(e){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=e||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(e){return e?Object.assign({},this.defaultOptions,e):this.defaultOptions}_d(e,t,s){return{shape:e,sets:t||[],options:s||this.defaultOptions}}line(e,t,s,o,a){const i=this._o(a);return this._d("line",[$e(e,t,s,o,i)],i)}rectangle(e,t,s,o,a){const i=this._o(a),r=[],l=bs(e,t,s,o,i);if(i.fill){const h=[[e,t],[e+s,t],[e+s,t+o],[e,t+o]];i.fillStyle==="solid"?r.push(Et([h],i)):r.push(lt([h],i))}return i.stroke!==_&&r.push(l),this._d("rectangle",r,i)}ellipse(e,t,s,o,a){const i=this._o(a),r=[],l=Ye(s,o,i),h=ee(e,t,i,l);if(i.fill)if(i.fillStyle==="solid"){const c=ee(e,t,i,l).opset;c.type="fillPath",r.push(c)}else r.push(lt([h.estimatedPoints],i));return i.stroke!==_&&r.push(h.opset),this._d("ellipse",r,i)}circle(e,t,s,o){const a=this.ellipse(e,t,s,s,o);return a.shape="circle",a}linearPath(e,t){const s=this._o(t);return this._d("linearPath",[Tt(e,!1,s)],s)}arc(e,t,s,o,a,i,r=!1,l){const h=this._o(l),c=[],f=ve(e,t,s,o,a,i,r,!0,h);if(r&&h.fill)if(h.fillStyle==="solid"){const p=Object.assign({},h);p.disableMultiStroke=!0;const u=ve(e,t,s,o,a,i,!0,!1,p);u.type="fillPath",c.push(u)}else c.push(function(p,u,d,g,m,k,w){const C=p,W=u;let M=Math.abs(d/2),T=Math.abs(g/2);M+=b(.01*M,w),T+=b(.01*T,w);let D=m,Y=k;for(;D<0;)D+=2*Math.PI,Y+=2*Math.PI;Y-D>2*Math.PI&&(D=0,Y=2*Math.PI);const H=(Y-D)/w.curveStepCount,N=[];for(let j=D;j<=Y;j+=H)N.push([C+M*Math.cos(j),W+T*Math.sin(j)]);return N.push([C+M*Math.cos(Y),W+T*Math.sin(Y)]),N.push([C,W]),lt([N],w)}(e,t,s,o,a,i,h));return h.stroke!==_&&c.push(f),this._d("arc",c,h)}curve(e,t){const s=this._o(t),o=[],a=ws(e,s);if(s.fill&&s.fill!==_&&e.length>=3){const i=Oe(function(r,l=0){const h=r.length;if(h<3)throw new Error("A curve must have at least three points.");const c=[];if(h===3)c.push(yt(r[0]),yt(r[1]),yt(r[2]),yt(r[2]));else{const f=[];f.push(r[0],r[0]);for(let d=1;d<r.length;d++)f.push(r[d]),d===r.length-1&&f.push(r[d]);const p=[],u=1-l;c.push(yt(f[0]));for(let d=1;d+2<f.length;d++){const g=f[d];p[0]=[g[0],g[1]],p[1]=[g[0]+(u*f[d+1][0]-u*f[d-1][0])/6,g[1]+(u*f[d+1][1]-u*f[d-1][1])/6],p[2]=[f[d+1][0]+(u*f[d][0]-u*f[d+2][0])/6,f[d+1][1]+(u*f[d][1]-u*f[d+2][1])/6],p[3]=[f[d+1][0],f[d+1][1]],c.push(p[1],p[2],p[3])}}return c}(e),10,(1+s.roughness)/2);s.fillStyle==="solid"?o.push(Et([i],s)):o.push(lt([i],s))}return s.stroke!==_&&o.push(a),this._d("curve",o,s)}polygon(e,t){const s=this._o(t),o=[],a=Tt(e,!0,s);return s.fill&&(s.fillStyle==="solid"?o.push(Et([e],s)):o.push(lt([e],s))),s.stroke!==_&&o.push(a),this._d("polygon",o,s)}path(e,t){const s=this._o(t),o=[];if(!e)return this._d("path",o,s);e=(e||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const a=s.fill&&s.fill!=="transparent"&&s.fill!==_,i=s.stroke!==_,r=!!(s.simplification&&s.simplification<1),l=function(h,c,f){const p=Me(we(te(h))),u=[];let d=[],g=[0,0],m=[];const k=()=>{m.length>=4&&d.push(...Oe(m,c)),m=[]},w=()=>{k(),d.length&&(u.push(d),d=[])};for(const{key:W,data:M}of p)switch(W){case"M":w(),g=[M[0],M[1]],d.push(g);break;case"L":k(),d.push([M[0],M[1]]);break;case"C":if(!m.length){const T=d.length?d[d.length-1]:g;m.push([T[0],T[1]])}m.push([M[0],M[1]]),m.push([M[2],M[3]]),m.push([M[4],M[5]]);break;case"Z":k(),d.push([g[0],g[1]])}if(w(),!f)return u;const C=[];for(const W of u){const M=Ps(W,f);M.length&&C.push(M)}return C}(e,1,r?4-4*s.simplification:(1+s.roughness)/2);return a&&(s.fillStyle==="solid"?o.push(Et(l,s)):o.push(lt(l,s))),i&&(r?l.forEach(h=>{o.push(Tt(h,!1,s))}):o.push(function(h,c){const f=Me(we(te(h))),p=[];let u=[0,0],d=[0,0];for(const{key:g,data:m}of f)switch(g){case"M":{const k=1*(c.maxRandomnessOffset||0),w=c.preserveVertices;p.push({op:"move",data:m.map(C=>C+(w?0:b(k,c)))}),d=[m[0],m[1]],u=[m[0],m[1]];break}case"L":p.push(...J(d[0],d[1],m[0],m[1],c)),d=[m[0],m[1]];break;case"C":{const[k,w,C,W,M,T]=m;p.push(...Ms(k,w,C,W,M,T,d,c)),d=[M,T];break}case"Z":p.push(...J(d[0],d[1],u[0],u[1],c)),d=[u[0],u[1]]}return{type:"path",ops:p}}(e,s))),this._d("path",o,s)}opsToPath(e,t){let s="";for(const o of e.ops){const a=typeof t=="number"&&t>=0?o.data.map(i=>+i.toFixed(t)):o.data;switch(o.op){case"move":s+=`M${a[0]} ${a[1]} `;break;case"bcurveTo":s+=`C${a[0]} ${a[1]}, ${a[2]} ${a[3]}, ${a[4]} ${a[5]} `;break;case"lineTo":s+=`L${a[0]} ${a[1]} `}}return s.trim()}toPaths(e){const t=e.sets||[],s=e.options||this.defaultOptions,o=[];for(const a of t){let i=null;switch(a.type){case"path":i={d:this.opsToPath(a),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:_};break;case"fillPath":i={d:this.opsToPath(a),stroke:_,strokeWidth:0,fill:s.fill||_};break;case"fillSketch":i=this.fillSketch(a,s)}i&&o.push(i)}return o}fillSketch(e,t){let s=t.fillWeight;return s<0&&(s=t.strokeWidth/2),{d:this.opsToPath(e),stroke:t.fill||_,strokeWidth:s,fill:_}}}class xs{constructor(e,t){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.gen=new Dt(t)}draw(e){const t=e.sets||[],s=e.options||this.getDefaultOptions(),o=this.ctx,a=e.options.fixedDecimalPlaceDigits;for(const i of t)switch(i.type){case"path":o.save(),o.strokeStyle=s.stroke==="none"?"transparent":s.stroke,o.lineWidth=s.strokeWidth,s.strokeLineDash&&o.setLineDash(s.strokeLineDash),s.strokeLineDashOffset&&(o.lineDashOffset=s.strokeLineDashOffset),this._drawToContext(o,i,a),o.restore();break;case"fillPath":{o.save(),o.fillStyle=s.fill||"";const r=e.shape==="curve"||e.shape==="polygon"||e.shape==="path"?"evenodd":"nonzero";this._drawToContext(o,i,a,r),o.restore();break}case"fillSketch":this.fillSketch(o,i,s)}}fillSketch(e,t,s){let o=s.fillWeight;o<0&&(o=s.strokeWidth/2),e.save(),s.fillLineDash&&e.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(e.lineDashOffset=s.fillLineDashOffset),e.strokeStyle=s.fill||"",e.lineWidth=o,this._drawToContext(e,t,s.fixedDecimalPlaceDigits),e.restore()}_drawToContext(e,t,s,o="nonzero"){e.beginPath();for(const a of t.ops){const i=typeof s=="number"&&s>=0?a.data.map(r=>+r.toFixed(s)):a.data;switch(a.op){case"move":e.moveTo(i[0],i[1]);break;case"bcurveTo":e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);break;case"lineTo":e.lineTo(i[0],i[1])}}t.type==="fillPath"?e.fill(o):e.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(e,t,s,o,a){const i=this.gen.line(e,t,s,o,a);return this.draw(i),i}rectangle(e,t,s,o,a){const i=this.gen.rectangle(e,t,s,o,a);return this.draw(i),i}ellipse(e,t,s,o,a){const i=this.gen.ellipse(e,t,s,o,a);return this.draw(i),i}circle(e,t,s,o){const a=this.gen.circle(e,t,s,o);return this.draw(a),a}linearPath(e,t){const s=this.gen.linearPath(e,t);return this.draw(s),s}polygon(e,t){const s=this.gen.polygon(e,t);return this.draw(s),s}arc(e,t,s,o,a,i,r=!1,l){const h=this.gen.arc(e,t,s,o,a,i,r,l);return this.draw(h),h}curve(e,t){const s=this.gen.curve(e,t);return this.draw(s),s}path(e,t){const s=this.gen.path(e,t);return this.draw(s),s}}const Ct="http://www.w3.org/2000/svg";class Ls{constructor(e,t){this.svg=e,this.gen=new Dt(t)}draw(e){const t=e.sets||[],s=e.options||this.getDefaultOptions(),o=this.svg.ownerDocument||window.document,a=o.createElementNS(Ct,"g"),i=e.options.fixedDecimalPlaceDigits;for(const r of t){let l=null;switch(r.type){case"path":l=o.createElementNS(Ct,"path"),l.setAttribute("d",this.opsToPath(r,i)),l.setAttribute("stroke",s.stroke),l.setAttribute("stroke-width",s.strokeWidth+""),l.setAttribute("fill","none"),s.strokeLineDash&&l.setAttribute("stroke-dasharray",s.strokeLineDash.join(" ").trim()),s.strokeLineDashOffset&&l.setAttribute("stroke-dashoffset",`${s.strokeLineDashOffset}`);break;case"fillPath":l=o.createElementNS(Ct,"path"),l.setAttribute("d",this.opsToPath(r,i)),l.setAttribute("stroke","none"),l.setAttribute("stroke-width","0"),l.setAttribute("fill",s.fill||""),e.shape!=="curve"&&e.shape!=="polygon"||l.setAttribute("fill-rule","evenodd");break;case"fillSketch":l=this.fillSketch(o,r,s)}l&&a.appendChild(l)}return a}fillSketch(e,t,s){let o=s.fillWeight;o<0&&(o=s.strokeWidth/2);const a=e.createElementNS(Ct,"path");return a.setAttribute("d",this.opsToPath(t,s.fixedDecimalPlaceDigits)),a.setAttribute("stroke",s.fill||""),a.setAttribute("stroke-width",o+""),a.setAttribute("fill","none"),s.fillLineDash&&a.setAttribute("stroke-dasharray",s.fillLineDash.join(" ").trim()),s.fillLineDashOffset&&a.setAttribute("stroke-dashoffset",`${s.fillLineDashOffset}`),a}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(e,t){return this.gen.opsToPath(e,t)}line(e,t,s,o,a){const i=this.gen.line(e,t,s,o,a);return this.draw(i)}rectangle(e,t,s,o,a){const i=this.gen.rectangle(e,t,s,o,a);return this.draw(i)}ellipse(e,t,s,o,a){const i=this.gen.ellipse(e,t,s,o,a);return this.draw(i)}circle(e,t,s,o){const a=this.gen.circle(e,t,s,o);return this.draw(a)}linearPath(e,t){const s=this.gen.linearPath(e,t);return this.draw(s)}polygon(e,t){const s=this.gen.polygon(e,t);return this.draw(s)}arc(e,t,s,o,a,i,r=!1,l){const h=this.gen.arc(e,t,s,o,a,i,r,l);return this.draw(h)}curve(e,t){const s=this.gen.curve(e,t);return this.draw(s)}path(e,t){const s=this.gen.path(e,t);return this.draw(s)}}var Ss={canvas:(n,e)=>new xs(n,e),svg:(n,e)=>new Ls(n,e),generator:n=>new Dt(n),newSeed:()=>Dt.newSeed()},Os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fe={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */(function(n){(function(e,t){n.exports?n.exports=t():e.Toastify=t()})(Os,function(e){var t=function(i){return new t.lib.init(i)},s="1.12.0";t.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},t.lib=t.prototype={toastify:s,constructor:t,init:function(i){return i||(i={}),this.options={},this.toastElement=null,this.options.text=i.text||t.defaults.text,this.options.node=i.node||t.defaults.node,this.options.duration=i.duration===0?0:i.duration||t.defaults.duration,this.options.selector=i.selector||t.defaults.selector,this.options.callback=i.callback||t.defaults.callback,this.options.destination=i.destination||t.defaults.destination,this.options.newWindow=i.newWindow||t.defaults.newWindow,this.options.close=i.close||t.defaults.close,this.options.gravity=i.gravity==="bottom"?"toastify-bottom":t.defaults.gravity,this.options.positionLeft=i.positionLeft||t.defaults.positionLeft,this.options.position=i.position||t.defaults.position,this.options.backgroundColor=i.backgroundColor||t.defaults.backgroundColor,this.options.avatar=i.avatar||t.defaults.avatar,this.options.className=i.className||t.defaults.className,this.options.stopOnFocus=i.stopOnFocus===void 0?t.defaults.stopOnFocus:i.stopOnFocus,this.options.onClick=i.onClick||t.defaults.onClick,this.options.offset=i.offset||t.defaults.offset,this.options.escapeMarkup=i.escapeMarkup!==void 0?i.escapeMarkup:t.defaults.escapeMarkup,this.options.ariaLive=i.ariaLive||t.defaults.ariaLive,this.options.style=i.style||t.defaults.style,i.backgroundColor&&(this.options.style.background=i.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var i=document.createElement("div");i.className="toastify on "+this.options.className,this.options.position?i.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(i.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):i.className+=" toastify-right",i.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var r in this.options.style)i.style[r]=this.options.style[r];if(this.options.ariaLive&&i.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)i.appendChild(this.options.node);else if(this.options.escapeMarkup?i.innerText=this.options.text:i.innerHTML=this.options.text,this.options.avatar!==""){var l=document.createElement("img");l.src=this.options.avatar,l.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?i.appendChild(l):i.insertAdjacentElement("afterbegin",l)}if(this.options.close===!0){var h=document.createElement("button");h.type="button",h.setAttribute("aria-label","Close"),h.className="toast-close",h.innerHTML="&#10006;",h.addEventListener("click",function(m){m.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var c=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&c>360?i.insertAdjacentElement("afterbegin",h):i.appendChild(h)}if(this.options.stopOnFocus&&this.options.duration>0){var f=this;i.addEventListener("mouseover",function(m){window.clearTimeout(i.timeOutValue)}),i.addEventListener("mouseleave",function(){i.timeOutValue=window.setTimeout(function(){f.removeElement(i)},f.options.duration)})}if(typeof this.options.destination<"u"&&i.addEventListener("click",function(m){m.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&i.addEventListener("click",function(m){m.stopPropagation(),this.options.onClick()}.bind(this)),typeof this.options.offset=="object"){var p=o("x",this.options),u=o("y",this.options),d=this.options.position=="left"?p:"-"+p,g=this.options.gravity=="toastify-top"?u:"-"+u;i.style.transform="translate("+d+","+g+")"}return i},showToast:function(){this.toastElement=this.buildToast();var i;if(typeof this.options.selector=="string"?i=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?i=this.options.selector:i=document.body,!i)throw"Root element is not defined";var r=t.defaults.oldestFirst?i.firstChild:i.lastChild;return i.insertBefore(this.toastElement,r),t.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(i){i.className=i.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),i.parentNode&&i.parentNode.removeChild(i),this.options.callback.call(i),t.reposition()}.bind(this),400)}},t.reposition=function(){for(var i={top:15,bottom:15},r={top:15,bottom:15},l={top:15,bottom:15},h=document.getElementsByClassName("toastify"),c,f=0;f<h.length;f++){a(h[f],"toastify-top")===!0?c="toastify-top":c="toastify-bottom";var p=h[f].offsetHeight;c=c.substr(9,c.length-1);var u=15,d=window.innerWidth>0?window.innerWidth:screen.width;d<=360?(h[f].style[c]=l[c]+"px",l[c]+=p+u):a(h[f],"toastify-left")===!0?(h[f].style[c]=i[c]+"px",i[c]+=p+u):(h[f].style[c]=r[c]+"px",r[c]+=p+u)}return this};function o(i,r){return r.offset[i]?isNaN(r.offset[i])?r.offset[i]:r.offset[i]+"px":"0px"}function a(i,r){return!i||typeof r!="string"?!1:!!(i.className&&i.className.trim().split(/\s+/gi).indexOf(r)>-1)}return t.lib.init.prototype=t.lib,t})})(Fe);const ne=Fe.exports;let I=[],x=0,L=0,Be=0,_e=0,Es=1,oe=0,ht=[],y=1,jt=!1,$t=!1;const kt=document.getElementById("me"),K=De(20);let ut="rgb(95, 61, 196)",xt="pointer",wt="hachure";const Mt=document.getElementById("zoom-current"),Zt=document.querySelector(".settings-show-btn"),It=document.querySelector(".settings-container"),Re=localStorage.getItem("theme")||"lightTheme",Cs=document.getElementById(Re);Cs.checked=!0;document.documentElement.className=Re;const Ts=document.querySelectorAll('input[type="radio"]');Zt==null||Zt.addEventListener("click",()=>{It.style.display==="none"?It.style.display="flex":It.style.display="none"});Ts.forEach(n=>{n.addEventListener("click",()=>{document.documentElement.className=n.id,localStorage.setItem("theme",n.id)})});function X(){hs(v),us(I,x,L,document.documentElement.clientWidth,document.documentElement.clientHeight)}function _t(){for(let n=0;n<I.length;n++){const e=I[n];e.zoom=y}}const Q=document.getElementById("canvas");Q.height=document.documentElement.clientHeight;Q.width=document.documentElement.clientWidth;const v=Q.getContext("2d");v.lineWidth=12;let Kt=0,Qt=0;const nt=Ss.canvas(Q),Ee=document.querySelectorAll(".fill-style-btn");Ee.forEach(n=>{n.addEventListener("click",e=>{if(e.target===null)return;const t=e.target;Ee.forEach(s=>{s!==t&&s.classList.remove("active-fill-style")}),t.classList.add("active-fill-style"),wt=t.dataset.fillOption})});const Yt=document.querySelectorAll(".top-btn");Yt.forEach(n=>{n.addEventListener("click",e=>{if(e.target===null)return;const t=e.target;t.id==="save-btn"||t.id==="clear-btn"||(Yt.forEach(s=>{s!==t&&s.classList.remove("active-shape")}),t.classList.add("active-shape"),xt=t.dataset.shapeOption)})});let q,vt="";const Xt=window.location;Xt.protocol==="https:"?vt="wss:":vt="ws:";vt+="/"+Xt.host;vt+=Xt.pathname+"/ws"+Xt.search;q=new WebSocket(vt);zs(q);function zs(n){n.onmessage=Is,n.onclose=Ws}function Is(n){try{const t=n.data.split(":::"),s=t[0];if(s==="move"){const o=v.lineWidth,a=v.strokeStyle;Q.getContext("2d"),v.beginPath(),v.moveTo(t[1],t[2]),v.lineTo(t[3],t[4]),v.lineWidth=t[5],v.strokeStyle=t[6],v.stroke(),v.strokeStyle=a,v.lineWidth=o}if(s==="clear"&&(I=[],v.clearRect(0,0,Q.width,Q.height)),s==="cur"){const o=t[1];let a;if(a=document.getElementById(o),a===null){a=document.createElement("div"),a.id=o,a.className="trailer",document.body.appendChild(a);return}const i={transform:`translate(${+t[2]*y+x}px, ${+t[3]*y+L}px)`};a.animate(i,{fill:"forwards"})}if(s==="disconnect"){ne({text:"User disconnected",duration:2e3,newWindow:!0,close:!0,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(90deg, rgba(255,244,0,1) 0%, rgba(255,162,0,1) 48%, rgba(255,0,0,1) 100%)"},onClick:function(){}}).showToast();let o=document.getElementsByClassName("trailer");if(o.length===0)return;for(var e=0;e<o.length;e++)o[e].id!=="me"&&(document.body.removeChild(o[e]),e--)}if(s==="message"&&ne({text:t[1],duration:6e3,newWindow:!0,close:!0,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(90deg, rgba(0,255,141,1) 0%, rgba(0,206,255,1) 100%)"},onClick:function(){}}).showToast(),s==="drawObj"){let o=as(t[1],nt,v);o.zoom=y,I.push(o),o.draw(x,L)}if(s==="delete"){let o=t[1];I=I.filter(a=>a.objId!==JSON.parse(o).objId),X()}}catch(t){console.error(t)}}function Ws(){ne({text:"Lost connection. Click here",duration:0,newWindow:!0,close:!1,gravity:"bottom",position:"right",stopOnFocus:!0,style:{background:"linear-gradient(90deg, rgba(255,244,0,1) 0%, rgba(255,162,0,1) 48%, rgba(255,0,0,1) 100%)"},onClick:function(){location.reload()}}).showToast()}let ot=0,it=0;window.addEventListener("mousedown",n=>{if(n.which===2){$t=!0,Be=n.clientX-x,_e=n.clientY-L;return}if(n.button!==0)return;n.stopPropagation();const e=n.target;e.id==="canvas"&&e!==null&&(jt=!0,oe=0,ht=[],ot=n.clientX,it=n.clientY)});window.addEventListener("mouseup",n=>{if($t){$t=!1;return}if(jt=!1,n.target.id!=="canvas")return;switch(xt){case"pointer":break;case"pen":{let o=[];for(let i=0;i<ht.length;i++){const r=ht[i];o.push([r[0]*y,r[1]*y])}let a=new ie(ht,v.fillStyle,+v.lineWidth,v,K);a.zoom=y,I.push(a),X();break}case"line":{X();let o=new re(v.fillStyle,+v.lineWidth,[(ot-x)/y,(it-L)/y],[(n.clientX-x)/y,(n.clientY-L)/y],nt,K);o.zoom=y,I.push(o),X();break}case"rectangle":{X();let o=new ae(v.fillStyle,+v.lineWidth,[(ot-x)/y,(it-L)/y],[(n.clientX-x)/y,(n.clientY-L)/y],wt,nt,ut,v.lineWidth,K);o.zoom=y,o.draw(x,L),I.push(o);break}case"ellipse":X();let s=new le(v.fillStyle,+v.lineWidth,[(ot-x)/y,(it-L)/y],[(n.clientX-x)/y,(n.clientY-L)/y],wt,nt,ut,v.lineWidth,!1,K);s.zoom=y,s.draw(x,L),I.push(s);break}let t="drawObj:::"+JSON.stringify(I[I.length-1])+":::";q.send(t.length),q.send(t)});window.addEventListener("mousemove",n=>{if(n.button!==0)return;const e=n.target,t=n.clientX-kt.offsetWidth/2,s=n.clientY-kt.offsetHeight/2;if(e.id==="canvas"){ls(t,s,kt);let i="cur:::"+K+":::"+ +(n.clientX/y-x/y)+":::"+ +(n.clientY/y-L/y)+":::";q.send(i.length),q.send(i)}if($t){x=n.clientX-Be,L=n.clientY-_e,X();return}if(!jt)return;const o=n.clientX,a=n.clientY;switch(xt){case"eraser":{let f=I.length;I=I.filter(p=>{if(p.typeName==="curve"){if(p.isCloseToPoints(n.clientX/y-x/y,n.clientY/y-L/y,10))return!1}else if(p.typeName==="rectangle"){if(p.isOverlay(-n.clientX+x,-n.clientY+L,1,1))return!1}else if(p.typeName==="line"){if(p.isCloseToPoints(n.clientX/y-x/y,n.clientY/y-L/y,25))return!1}else if(p.typeName==="ellipse"&&p.closeToCentre(n.clientX/y-x/y,n.clientY/y-L/y))return!1;return!0}),f!==I.length&&X();break}case"pointer":break;case"pen":if(Kt==null||Qt==null||!jt){Kt=n.clientX,Qt=n.clientY;return}let i=n.clientX,r=n.clientY;if(oe++,oe%Es===0){ht.push([(i-x)/y,(r-L)/y]),X();let f=new ie(ht,v.fillStyle,v.lineWidth,v,K);f.zoom=y,f.draw(x,L)}Kt=i,Qt=r;break;case"line":X();let l=new re(v.fillStyle,+v.lineWidth,[(ot-x)/y,(it-L)/y],[(o-x)/y,(a-L)/y],nt,K);l.zoom=y,l.draw(x,L);break;case"ellipse":X();let h=new le(v.fillStyle,+v.lineWidth,[(ot-x)/y,(it-L)/y],[(o-x)/y,(a-L)/y],wt,nt,ut,v.lineWidth,!1,K);h.zoom=y,h.draw(x,L);break;case"rectangle":X();let c=new ae(v.fillStyle,+v.lineWidth,[(ot-x)/y,(it-L)/y],[(o-x)/y,(a-L)/y],wt,nt,ut,v.lineWidth,K);c.zoom=y,c.draw(x,L);break}});window.addEventListener("resize",()=>{X()});window.addEventListener("wheel",n=>{let e=document.documentElement.clientWidth/2,t=document.documentElement.clientHeight/2,s=(x+(y-1)*e)/y,o=(L+(y-1)*t)/y;y+=n.deltaY<0?.05:-.1,y<=.1?y=.1:y>=5&&(y=5),n.deltaY<0,x=s+(y-1)*(s-e),L=o+(y-1)*(o-t),_t(),X(),Mt.innerHTML=`${Math.floor(y*100)}%`});let Jt=[];document.addEventListener("keydown",function(n){const e=n.key.toLowerCase(),t=n.code;if(n.ctrlKey&&t==="KeyZ"){if(n.shiftKey){if(Jt.length===0)return;let r=Jt.pop();I.push(r),r.draw(x,L);let l="drawObj:::"+JSON.stringify(r)+":::";q.send(l.length),q.send(l);return}let s=I.filter(r=>r.userId===K);if(s.length===0)return;let o=s[s.length-1];I=I.filter(r=>r!==o);let a=JSON.stringify(o);Jt.push(o),X();let i="delete:::"+a;q.send(i.length),q.send(i)}(e==="1"||t==="KeyF")&&ct("pointer-btn"),(e==="2"||t==="KeyE")&&ct("eraser-btn"),(e==="3"||t==="KeyP")&&ct("pen-btn"),(e==="4"||t==="KeyR")&&ct("rectangle-btn"),(e==="5"||t==="KeyV")&&ct("line-btn"),(e==="6"||t==="KeyC")&&ct("ellipse-btn")});function ct(n){const e=document.getElementById(n);Yt.forEach(t=>{t!==e&&t.classList.remove("active-shape")}),e.classList.add("active-shape"),xt=e.dataset.shapeOption}let Ns=document.getElementById("save-btn");Ns.addEventListener("click",()=>{let n=Q.toDataURL("imag/png"),e=document.createElement("a");e.href=n,e.download="sketch.png",e.click()});let As=document.getElementById("clear-btn");As.addEventListener("click",()=>{var n;I=[],v.clearRect(0,0,Q.width,Q.height),q.send(8),q.send("clear:::"),It.style.display="none",xt="pointer",Yt.forEach(e=>{e.classList.remove("active-shape")}),(n=document.getElementById("pointer-btn"))==null||n.classList.add("active-shape")});const he=document.querySelector(".color-picker"),tt=document.getElementById("color-list"),Ce=document.querySelectorAll("#color-item"),Ds=document.getElementById("color-picker-input"),ue=document.getElementById("stroke-color-picker"),et=document.getElementById("stroke-color-list"),Te=document.querySelectorAll("#stroke-color-item"),js=document.getElementById("stroke-color-picker-input");he.addEventListener("click",n=>{et.style.display="none",n.stopPropagation(),tt.style.display==="grid"?tt.style.display="none":tt.style.display="grid"});for(let n=0;n<Ce.length;n++)Ce[n].addEventListener("click",t=>{const s=t.target;if(s===null)return;const o=s.style.backgroundColor;he.style.backgroundColor=o,We(o,v,kt,+bt.value),tt.style.display="none"});Ds.addEventListener("input",n=>{const e=n.target;if(e===null)return;const t="#"+e.value;t.length>1&&(he.style.backgroundColor=t,We(t,v,kt,+bt.value))});document.documentElement.addEventListener("click",n=>{tt.style.display==="grid"&&n.target!==tt&&(tt.style.display="none")});ue.addEventListener("click",n=>{tt.style.display="none",n.stopPropagation(),et.style.display==="grid"?et.style.display="none":et.style.display="grid"});for(let n=0;n<Te.length;n++)Te[n].addEventListener("click",t=>{const s=t.target;if(s===null)return;const o=s.style.backgroundColor;ue.style.backgroundColor=o,ut=o,et.style.display="none"});js.addEventListener("input",n=>{const e=n.target;if(e===null)return;const t="#"+e.value;t.length>1&&(ue.style.backgroundColor=t,ut=t)});document.documentElement.addEventListener("click",n=>{et.style.display==="grid"&&n.target!==et&&(et.style.display="none")});const ze=document.querySelectorAll(".width-btn");ze.forEach(n=>{n.addEventListener("click",e=>{if(e.target===null)return;const t=e.target;v.lineWidth=parseInt(t.dataset.lineWidth),n.classList.add("active-width"),ze.forEach(s=>{s!==t&&s.classList.remove("active-width")})})});const bt=document.getElementById("input-opacity");bt.addEventListener("change",()=>{const n=v.fillStyle.startsWith("#")?Ne(v.fillStyle,bt.value):Ae(v.fillStyle,+bt.value);v.fillStyle=n});const $s=document.getElementById("zoom-decrease"),Ys=document.getElementById("zoom-increase");$s.addEventListener("click",()=>{y-=.1,y<=.1&&(y=.1),_t(),X(),Mt.innerHTML=`${Math.floor(y*100)}%`});Ys.addEventListener("click",()=>{y+=.1,y>=5&&(y=5),_t(),X(),Mt.innerHTML=`${Math.floor(y*100)}%`});Mt.addEventListener("click",n=>{n.stopPropagation(),y=1,_t(),X(),Mt.innerHTML="100%"});
