var _e=Object.defineProperty;var Be=(s,t,e)=>t in s?_e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var x=(s,t,e)=>(Be(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();function ae(s,t,e,n=o=>o){return s*n(.5-t*(.5-e))}function Fe(s){return[-s[0],-s[1]]}function H(s,t){return[s[0]+t[0],s[1]+t[1]]}function G(s,t){return[s[0]-t[0],s[1]-t[1]]}function Y(s,t){return[s[0]*t,s[1]*t]}function Re(s,t){return[s[0]/t,s[1]/t]}function ct(s){return[s[1],-s[0]]}function he(s,t){return s[0]*t[0]+s[1]*t[1]}function qe(s,t){return s[0]===t[0]&&s[1]===t[1]}function Ne(s){return Math.hypot(s[0],s[1])}function Ge(s){return s[0]*s[0]+s[1]*s[1]}function ce(s,t){return Ge(G(s,t))}function xe(s){return Re(s,Ne(s))}function Xe(s,t){return Math.hypot(s[1]-t[1],s[0]-t[0])}function ut(s,t,e){let n=Math.sin(e),o=Math.cos(e),r=s[0]-t[0],l=s[1]-t[1],i=r*o-l*n,h=r*n+l*o;return[i+t[0],h+t[1]]}function Yt(s,t,e){return H(s,Y(G(t,s),e))}function ue(s,t,e){return H(s,Y(t,e))}var{min:it,PI:Ye}=Math,de=.275,dt=Ye+1e-4;function He(s,t={}){let{size:e=16,smoothing:n=.5,thinning:o=.5,simulatePressure:r=!0,easing:l=v=>v,start:i={},end:h={},last:d=!1}=t,{cap:c=!0,easing:f=v=>v*(2-v)}=i,{cap:p=!0,easing:u=v=>--v*v*v+1}=h;if(s.length===0||e<=0)return[];let a=s[s.length-1].runningLength,m=i.taper===!1?0:i.taper===!0?Math.max(e,a):i.taper,g=h.taper===!1?0:h.taper===!0?Math.max(e,a):h.taper,k=Math.pow(e*n,2),b=[],W=[],$=s.slice(0,10).reduce((v,D)=>{let O=D.pressure;if(r){let E=it(1,D.distance/e),jt=it(1,1-E);O=it(1,v+(jt-v)*(E*de))}return(v+O)/2},s[0].pressure),w=ae(e,o,s[s.length-1].pressure,l),z,q=s[0].vector,j=s[0].point,J=j,A=j,_=J,rt=!1;for(let v=0;v<s.length;v++){let{pressure:D}=s[v],{point:O,vector:E,distance:jt,runningLength:ht}=s[v];if(v<s.length-1&&a-ht<3)continue;if(o){if(r){let U=it(1,jt/e),Bt=it(1,1-U);D=it(1,$+(Bt-$)*(U*de))}w=ae(e,o,D,l)}else w=e/2;z===void 0&&(z=w);let $e=ht<m?f(ht/m):1,ze=a-ht<g?u((a-ht)/g):1;w=Math.max(.01,w*Math.min($e,ze));let re=(v<s.length-1?s[v+1]:s[v]).vector,_t=v<s.length-1?he(E,re):1,je=he(E,q)<0&&!rt,ie=_t!==null&&_t<0;if(je||ie){let U=Y(ct(q),w);for(let Bt=1/13,yt=0;yt<=1;yt+=Bt)A=ut(G(O,U),O,dt*yt),b.push(A),_=ut(H(O,U),O,dt*-yt),W.push(_);j=A,J=_,ie&&(rt=!0);continue}if(rt=!1,v===s.length-1){let U=Y(ct(E),w);b.push(G(O,U)),W.push(H(O,U));continue}let le=Y(ct(Yt(re,E,_t)),w);A=G(O,le),(v<=1||ce(j,A)>k)&&(b.push(A),j=A),_=H(O,le),(v<=1||ce(J,_)>k)&&(W.push(_),J=_),$=D,q=E}let I=s[0].point.slice(0,2),L=s.length>1?s[s.length-1].point.slice(0,2):H(s[0].point,[1,1]),B=[],X=[];if(s.length===1){if(!(m||g)||d){let v=ue(I,xe(ct(G(I,L))),-(z||w)),D=[];for(let O=1/13,E=O;E<=1;E+=O)D.push(ut(v,I,dt*2*E));return D}}else{if(!(m||g&&s.length===1))if(c)for(let D=1/13,O=D;O<=1;O+=D){let E=ut(W[0],I,dt*O);B.push(E)}else{let D=G(b[0],W[0]),O=Y(D,.5),E=Y(D,.51);B.push(G(I,O),G(I,E),H(I,E),H(I,O))}let v=ct(Fe(s[s.length-1].vector));if(g||m&&s.length===1)X.push(L);else if(p){let D=ue(L,v,w);for(let O=1/29,E=O;E<1;E+=O)X.push(ut(D,L,dt*3*E))}else X.push(H(L,Y(v,w)),H(L,Y(v,w*.99)),G(L,Y(v,w*.99)),G(L,Y(v,w)))}return b.concat(X,W.reverse(),B)}function Ve(s,t={}){var e;let{streamline:n=.5,size:o=16,last:r=!1}=t;if(s.length===0)return[];let l=.15+(1-n)*.85,i=Array.isArray(s[0])?s:s.map(({x:u,y:a,pressure:m=.5})=>[u,a,m]);if(i.length===2){let u=i[1];i=i.slice(0,-1);for(let a=1;a<5;a++)i.push(Yt(i[0],u,a/4))}i.length===1&&(i=[...i,[...H(i[0],[1,1]),...i[0].slice(2)]]);let h=[{point:[i[0][0],i[0][1]],pressure:i[0][2]>=0?i[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],d=!1,c=0,f=h[0],p=i.length-1;for(let u=1;u<i.length;u++){let a=r&&u===p?i[u].slice(0,2):Yt(f.point,i[u],l);if(qe(f.point,a))continue;let m=Xe(a,f.point);if(c+=m,u<p&&!d){if(c<o)continue;d=!0}f={point:a,pressure:i[u][2]>=0?i[u][2]:.5,vector:xe(G(f.point,a)),distance:m,runningLength:c},h.push(f)}return h[0].vector=((e=h[1])==null?void 0:e.vector)||[0,0],h}function Ze(s,t={}){return He(Ve(s,t),t)}var Qe=Ze;function Je(s,t,e){let n=JSON.parse(s);switch(n.typeName){case"rectangle":let{color:r,width:l,startPoint:i,endPoint:h,fillStyle:d,stroke:c,strokeWidth:f,userId:p}=n;return new Ut(r,l,i,h,d,t,c,f,p);case"ellipse":{let{color:u,width:a,startPoint:m,endPoint:g,fillStyle:k,stroke:b,strokeWidth:W,isCircle:$,userId:w}=n;return new te(u,a,m,g,k,t,b,W,$,w)}case"line":{let{color:u,width:a,startPoint:m,endPoint:g}=n;return new Kt(u,a,m,g,t,p)}case"curve":{let{pointsList:u,color:a,width:m,userId:g}=n;return new Jt(u,a,m,e,g)}default:return null}}function Ke(s,t,e){const n={transform:`translate(${s}px, ${t}px)`};e.animate(n,{fill:"forwards"})}function Le(s,t,e){t.fillStyle=s,e.style.backgroundColor=s;const n=document.getElementsByClassName("trailer");for(let o=0;o<n.length;o++){const r=n[o];r.style.backgroundColor=s}}function Mt(s,t){return(s+t)/2}function Ue(s,t=!0){const e=s.length;if(e<4)return"";let n=s[0],o=s[1];const r=s[2];let l=`M${n[0].toFixed(2)},${n[1].toFixed(2)} Q${o[0].toFixed(2)},${o[1].toFixed(2)} ${Mt(o[0],r[0]).toFixed(2)},${Mt(o[1],r[1]).toFixed(2)} T`;for(let i=2,h=e-1;i<h;i++)n=s[i],o=s[i+1],l+=`${Mt(n[0],o[0]).toFixed(2)},${Mt(n[1],o[1]).toFixed(2)} `;return t&&(l+="Z"),l}function Oe(s,t="1"){let e,n;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(s))return e=s.substring(1).split(""),e.length==3&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),n=+("0x"+e.join("")),"rgba("+[n>>16&255,n>>8&255,n&255].join(",")+","+t+")";throw new Error("Bad Hex")}function tn(s,t){let e=s.slice(s.indexOf("(")+1,s.indexOf(")")).split(", ");return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t+")"}function en(s){let t="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e.length;for(let o=0;o<s;o++)t+=e.charAt(Math.floor(Math.random()*n));return t}function V(s,t){let e=t.fillStyle,n=t.lineWidth;s.width+=1,s.width=document.documentElement.clientWidth,s.height=document.documentElement.clientHeight,t.fillStyle=e,t.lineWidth=n}function Z(s,t,e){for(let n=0;n<s.length;n++)s[n].draw(t,e)}class $t{constructor(t,e,n){x(this,"color");x(this,"width");x(this,"userId");x(this,"typeName","");this.color=t,this.width=e,this.userId=n}draw(t,e){console.log("offset:",t,e)}log(){console.log("yo")}}class Jt extends $t{constructor(e,n,o,r,l){super(n,o,l);x(this,"pointsList");x(this,"ctx");x(this,"typeName","curve");this.pointsList=e,this.ctx=r,this.userId=l}draw(e,n){let o=[];for(let d=0;d<this.pointsList.length;d++){let c=this.pointsList[d];o.push([c[0]+e,c[1]+n])}const r=Qe(o,{size:this.width,thinning:.7}),l=Ue(r),i=new Path2D(l);let h=this.ctx.fillStyle;this.ctx.fillStyle=this.color.startsWith("#")?Oe(this.color):this.color,this.ctx.fill(i),this.ctx.fillStyle=h}}class Kt extends $t{constructor(e,n,o,r,l,i){super(e,n,i);x(this,"startPoint");x(this,"endPoint");x(this,"roughCanvas");x(this,"typeName","line");this.startPoint=o,this.endPoint=r,this.roughCanvas=l,this.userId=i}draw(e,n){this.roughCanvas.line(this.startPoint[0]+e,this.startPoint[1]+n,this.endPoint[0]+e,this.endPoint[1]+n,{strokeWidth:this.width,stroke:this.color,seed:1})}}class Ut extends $t{constructor(e,n,o,r,l,i,h,d,c){super(e,n,c);x(this,"startPoint");x(this,"endPoint");x(this,"roughCanvas");x(this,"fillStyle");x(this,"typeName","rectangle");x(this,"stroke");x(this,"strokeWidth");x(this,"drawableObj",null);this.startPoint=o,this.endPoint=r,this.roughCanvas=i,this.fillStyle=l,this.stroke=h,this.strokeWidth=d,this.userId=c}draw(e,n){let o=this.endPoint[0]-this.startPoint[0],r=this.endPoint[1]-this.startPoint[1];this.roughCanvas.rectangle(this.startPoint[0]+e,this.startPoint[1]+n,o,r,{strokeWidth:this.width,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}}class te extends $t{constructor(e,n,o,r,l,i,h,d,c,f){super(e,n,f);x(this,"startPoint");x(this,"endPoint");x(this,"roughCanvas");x(this,"fillStyle");x(this,"typeName","ellipse");x(this,"stroke");x(this,"strokeWidth");x(this,"drawableObj",null);x(this,"isCircle");this.startPoint=o,this.endPoint=r,this.roughCanvas=i,this.fillStyle=l,this.stroke=h,this.strokeWidth=d,this.isCircle=c,this.userId=this.userId}draw(e,n){let o=this.endPoint[0]-this.startPoint[0],r=this.endPoint[1]-this.startPoint[1];this.roughCanvas.ellipse(this.startPoint[0]+e,this.startPoint[1]+n,o*2,r*2,{strokeWidth:this.width,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}}function Ft(s,t,e){if(s&&s.length){const[n,o]=t,r=Math.PI/180*e,l=Math.cos(r),i=Math.sin(r);s.forEach(h=>{const[d,c]=h;h[0]=(d-n)*l-(c-o)*i+n,h[1]=(d-n)*i+(c-o)*l+o})}}function zt(s){const t=s[0],e=s[1];return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function kt(s,t){const e=t.hachureAngle+90;let n=t.hachureGap;n<0&&(n=4*t.strokeWidth),n=Math.max(n,.1);const o=[0,0];if(e)for(const l of s)Ft(l,o,e);const r=function(l,i){const h=[];for(const u of l){const a=[...u];a[0].join(",")!==a[a.length-1].join(",")&&a.push([a[0][0],a[0][1]]),a.length>2&&h.push(a)}const d=[];i=Math.max(i,.1);const c=[];for(const u of h)for(let a=0;a<u.length-1;a++){const m=u[a],g=u[a+1];if(m[1]!==g[1]){const k=Math.min(m[1],g[1]);c.push({ymin:k,ymax:Math.max(m[1],g[1]),x:k===m[1]?m[0]:g[0],islope:(g[0]-m[0])/(g[1]-m[1])})}}if(c.sort((u,a)=>u.ymin<a.ymin?-1:u.ymin>a.ymin?1:u.x<a.x?-1:u.x>a.x?1:u.ymax===a.ymax?0:(u.ymax-a.ymax)/Math.abs(u.ymax-a.ymax)),!c.length)return d;let f=[],p=c[0].ymin;for(;f.length||c.length;){if(c.length){let u=-1;for(let a=0;a<c.length&&!(c[a].ymin>p);a++)u=a;c.splice(0,u+1).forEach(a=>{f.push({s:p,edge:a})})}if(f=f.filter(u=>!(u.edge.ymax<=p)),f.sort((u,a)=>u.edge.x===a.edge.x?0:(u.edge.x-a.edge.x)/Math.abs(u.edge.x-a.edge.x)),f.length>1)for(let u=0;u<f.length;u+=2){const a=u+1;if(a>=f.length)break;const m=f[u].edge,g=f[a].edge;d.push([[Math.round(m.x),p],[Math.round(g.x),p]])}p+=i,f.forEach(u=>{u.edge.x=u.edge.x+i*u.edge.islope})}return d}(s,n);if(e){for(const l of s)Ft(l,o,-e);(function(l,i,h){const d=[];l.forEach(c=>d.push(...c)),Ft(d,i,h)})(r,o,-e)}return r}class ee{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const n=kt(t,e);return{type:"fillSketch",ops:this.renderLines(n,e)}}renderLines(t,e){const n=[];for(const o of t)n.push(...this.helper.doubleLineOps(o[0][0],o[0][1],o[1][0],o[1][1],e));return n}}class nn extends ee{fillPolygons(t,e){let n=e.hachureGap;n<0&&(n=4*e.strokeWidth),n=Math.max(n,.1);const o=kt(t,Object.assign({},e,{hachureGap:n})),r=Math.PI/180*e.hachureAngle,l=[],i=.5*n*Math.cos(r),h=.5*n*Math.sin(r);for(const[d,c]of o)zt([d,c])&&l.push([[d[0]-i,d[1]+h],[...c]],[[d[0]+i,d[1]-h],[...c]]);return{type:"fillSketch",ops:this.renderLines(l,e)}}}class sn extends ee{fillPolygons(t,e){const n=this._fillPolygons(t,e),o=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),r=this._fillPolygons(t,o);return n.ops=n.ops.concat(r.ops),n}}class on{constructor(t){this.helper=t}fillPolygons(t,e){const n=kt(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(n,e)}dotsOnLines(t,e){const n=[];let o=e.hachureGap;o<0&&(o=4*e.strokeWidth),o=Math.max(o,.1);let r=e.fillWeight;r<0&&(r=e.strokeWidth/2);const l=o/4;for(const i of t){const h=zt(i),d=h/o,c=Math.ceil(d)-1,f=h-c*o,p=(i[0][0]+i[1][0])/2-o/4,u=Math.min(i[0][1],i[1][1]);for(let a=0;a<c;a++){const m=u+f+a*o,g=p-l+2*Math.random()*l,k=m-l+2*Math.random()*l,b=this.helper.ellipse(g,k,r,r,e);n.push(...b.ops)}}return{type:"fillSketch",ops:n}}}class rn{constructor(t){this.helper=t}fillPolygons(t,e){const n=kt(t,e);return{type:"fillSketch",ops:this.dashedLine(n,e)}}dashedLine(t,e){const n=e.dashOffset<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashOffset,o=e.dashGap<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashGap,r=[];return t.forEach(l=>{const i=zt(l),h=Math.floor(i/(n+o)),d=(i+o-h*(n+o))/2;let c=l[0],f=l[1];c[0]>f[0]&&(c=l[1],f=l[0]);const p=Math.atan((f[1]-c[1])/(f[0]-c[0]));for(let u=0;u<h;u++){const a=u*(n+o),m=a+n,g=[c[0]+a*Math.cos(p)+d*Math.cos(p),c[1]+a*Math.sin(p)+d*Math.sin(p)],k=[c[0]+m*Math.cos(p)+d*Math.cos(p),c[1]+m*Math.sin(p)+d*Math.sin(p)];r.push(...this.helper.doubleLineOps(g[0],g[1],k[0],k[1],e))}}),r}}class ln{constructor(t){this.helper=t}fillPolygons(t,e){const n=e.hachureGap<0?4*e.strokeWidth:e.hachureGap,o=e.zigzagOffset<0?n:e.zigzagOffset,r=kt(t,e=Object.assign({},e,{hachureGap:n+o}));return{type:"fillSketch",ops:this.zigzagLines(r,o,e)}}zigzagLines(t,e,n){const o=[];return t.forEach(r=>{const l=zt(r),i=Math.round(l/(2*e));let h=r[0],d=r[1];h[0]>d[0]&&(h=r[1],d=r[0]);const c=Math.atan((d[1]-h[1])/(d[0]-h[0]));for(let f=0;f<i;f++){const p=2*f*e,u=2*(f+1)*e,a=Math.sqrt(2*Math.pow(e,2)),m=[h[0]+p*Math.cos(c),h[1]+p*Math.sin(c)],g=[h[0]+u*Math.cos(c),h[1]+u*Math.sin(c)],k=[m[0]+a*Math.cos(c+Math.PI/4),m[1]+a*Math.sin(c+Math.PI/4)];o.push(...this.helper.doubleLineOps(m[0],m[1],k[0],k[1],n),...this.helper.doubleLineOps(k[0],k[1],g[0],g[1],n))}}),o}}const F={};class an{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const bt={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Rt(s,t){return s.type===t}function Ht(s){const t=[],e=function(l){const i=new Array;for(;l!=="";)if(l.match(/^([ \t\r\n,]+)/))l=l.substr(RegExp.$1.length);else if(l.match(/^([aAcChHlLmMqQsStTvVzZ])/))i[i.length]={type:0,text:RegExp.$1},l=l.substr(RegExp.$1.length);else{if(!l.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];i[i.length]={type:1,text:`${parseFloat(RegExp.$1)}`},l=l.substr(RegExp.$1.length)}return i[i.length]={type:2,text:""},i}(s);let n="BOD",o=0,r=e[o];for(;!Rt(r,2);){let l=0;const i=[];if(n==="BOD"){if(r.text!=="M"&&r.text!=="m")return Ht("M0,0"+s);o++,l=bt[r.text],n=r.text}else Rt(r,1)?l=bt[n]:(o++,l=bt[r.text],n=r.text);if(!(o+l<e.length))throw new Error("Path data ended short");for(let h=o;h<o+l;h++){const d=e[h];if(!Rt(d,1))throw new Error("Param not a number: "+n+","+d.text);i[i.length]=+d.text}if(typeof bt[n]!="number")throw new Error("Bad segment: "+n);{const h={key:n,data:i};t.push(h),o+=l,r=e[o],n==="M"&&(n="L"),n==="m"&&(n="l")}}return t}function fe(s){let t=0,e=0,n=0,o=0;const r=[];for(const{key:l,data:i}of s)switch(l){case"M":r.push({key:"M",data:[...i]}),[t,e]=i,[n,o]=i;break;case"m":t+=i[0],e+=i[1],r.push({key:"M",data:[t,e]}),n=t,o=e;break;case"L":r.push({key:"L",data:[...i]}),[t,e]=i;break;case"l":t+=i[0],e+=i[1],r.push({key:"L",data:[t,e]});break;case"C":r.push({key:"C",data:[...i]}),t=i[4],e=i[5];break;case"c":{const h=i.map((d,c)=>c%2?d+e:d+t);r.push({key:"C",data:h}),t=h[4],e=h[5];break}case"Q":r.push({key:"Q",data:[...i]}),t=i[2],e=i[3];break;case"q":{const h=i.map((d,c)=>c%2?d+e:d+t);r.push({key:"Q",data:h}),t=h[2],e=h[3];break}case"A":r.push({key:"A",data:[...i]}),t=i[5],e=i[6];break;case"a":t+=i[5],e+=i[6],r.push({key:"A",data:[i[0],i[1],i[2],i[3],i[4],t,e]});break;case"H":r.push({key:"H",data:[...i]}),t=i[0];break;case"h":t+=i[0],r.push({key:"H",data:[t]});break;case"V":r.push({key:"V",data:[...i]}),e=i[0];break;case"v":e+=i[0],r.push({key:"V",data:[e]});break;case"S":r.push({key:"S",data:[...i]}),t=i[2],e=i[3];break;case"s":{const h=i.map((d,c)=>c%2?d+e:d+t);r.push({key:"S",data:h}),t=h[2],e=h[3];break}case"T":r.push({key:"T",data:[...i]}),t=i[0],e=i[1];break;case"t":t+=i[0],e+=i[1],r.push({key:"T",data:[t,e]});break;case"Z":case"z":r.push({key:"Z",data:[]}),t=n,e=o}return r}function pe(s){const t=[];let e="",n=0,o=0,r=0,l=0,i=0,h=0;for(const{key:d,data:c}of s){switch(d){case"M":t.push({key:"M",data:[...c]}),[n,o]=c,[r,l]=c;break;case"C":t.push({key:"C",data:[...c]}),n=c[4],o=c[5],i=c[2],h=c[3];break;case"L":t.push({key:"L",data:[...c]}),[n,o]=c;break;case"H":n=c[0],t.push({key:"L",data:[n,o]});break;case"V":o=c[0],t.push({key:"L",data:[n,o]});break;case"S":{let f=0,p=0;e==="C"||e==="S"?(f=n+(n-i),p=o+(o-h)):(f=n,p=o),t.push({key:"C",data:[f,p,...c]}),i=c[0],h=c[1],n=c[2],o=c[3];break}case"T":{const[f,p]=c;let u=0,a=0;e==="Q"||e==="T"?(u=n+(n-i),a=o+(o-h)):(u=n,a=o);const m=n+2*(u-n)/3,g=o+2*(a-o)/3,k=f+2*(u-f)/3,b=p+2*(a-p)/3;t.push({key:"C",data:[m,g,k,b,f,p]}),i=u,h=a,n=f,o=p;break}case"Q":{const[f,p,u,a]=c,m=n+2*(f-n)/3,g=o+2*(p-o)/3,k=u+2*(f-u)/3,b=a+2*(p-a)/3;t.push({key:"C",data:[m,g,k,b,u,a]}),i=f,h=p,n=u,o=a;break}case"A":{const f=Math.abs(c[0]),p=Math.abs(c[1]),u=c[2],a=c[3],m=c[4],g=c[5],k=c[6];f===0||p===0?(t.push({key:"C",data:[n,o,g,k,g,k]}),n=g,o=k):(n!==g||o!==k)&&(Ce(n,o,g,k,f,p,u,a,m).forEach(function(b){t.push({key:"C",data:b})}),n=g,o=k);break}case"Z":t.push({key:"Z",data:[]}),n=r,o=l}e=d}return t}function ft(s,t,e){return[s*Math.cos(e)-t*Math.sin(e),s*Math.sin(e)+t*Math.cos(e)]}function Ce(s,t,e,n,o,r,l,i,h,d){const c=(f=l,Math.PI*f/180);var f;let p=[],u=0,a=0,m=0,g=0;if(d)[u,a,m,g]=d;else{[s,t]=ft(s,t,-c),[e,n]=ft(e,n,-c);const I=(s-e)/2,L=(t-n)/2;let B=I*I/(o*o)+L*L/(r*r);B>1&&(B=Math.sqrt(B),o*=B,r*=B);const X=o*o,v=r*r,D=X*v-X*L*L-v*I*I,O=X*L*L+v*I*I,E=(i===h?-1:1)*Math.sqrt(Math.abs(D/O));m=E*o*L/r+(s+e)/2,g=E*-r*I/o+(t+n)/2,u=Math.asin(parseFloat(((t-g)/r).toFixed(9))),a=Math.asin(parseFloat(((n-g)/r).toFixed(9))),s<m&&(u=Math.PI-u),e<m&&(a=Math.PI-a),u<0&&(u=2*Math.PI+u),a<0&&(a=2*Math.PI+a),h&&u>a&&(u-=2*Math.PI),!h&&a>u&&(a-=2*Math.PI)}let k=a-u;if(Math.abs(k)>120*Math.PI/180){const I=a,L=e,B=n;a=h&&a>u?u+120*Math.PI/180*1:u+120*Math.PI/180*-1,p=Ce(e=m+o*Math.cos(a),n=g+r*Math.sin(a),L,B,o,r,l,0,h,[a,I,m,g])}k=a-u;const b=Math.cos(u),W=Math.sin(u),$=Math.cos(a),w=Math.sin(a),z=Math.tan(k/4),q=4/3*o*z,j=4/3*r*z,J=[s,t],A=[s+q*W,t-j*b],_=[e+q*w,n-j*$],rt=[e,n];if(A[0]=2*J[0]-A[0],A[1]=2*J[1]-A[1],d)return[A,_,rt].concat(p);{p=[A,_,rt].concat(p);const I=[];for(let L=0;L<p.length;L+=3){const B=ft(p[L][0],p[L][1],c),X=ft(p[L+1][0],p[L+1][1],c),v=ft(p[L+2][0],p[L+2][1],c);I.push([B[0],B[1],X[0],X[1],v[0],v[1]])}return I}}const hn={randOffset:function(s,t){return M(s,t)},randOffsetWithRange:function(s,t,e){return Ot(s,t,e)},ellipse:function(s,t,e,n,o){const r=We(e,n,o);return Vt(s,t,o,r).opset},doubleLineOps:function(s,t,e,n,o){return K(s,t,e,n,o,!0)}};function Ee(s,t,e,n,o){return{type:"path",ops:K(s,t,e,n,o)}}function Pt(s,t,e){const n=(s||[]).length;if(n>2){const o=[];for(let r=0;r<n-1;r++)o.push(...K(s[r][0],s[r][1],s[r+1][0],s[r+1][1],e));return t&&o.push(...K(s[n-1][0],s[n-1][1],s[0][0],s[0][1],e)),{type:"path",ops:o}}return n===2?Ee(s[0][0],s[0][1],s[1][0],s[1][1],e):{type:"path",ops:[]}}function cn(s,t,e,n,o){return function(r,l){return Pt(r,!0,l)}([[s,t],[s+e,t],[s+e,t+n],[s,t+n]],o)}function un(s,t){let e=ke(s,1*(1+.2*t.roughness),t);if(!t.disableMultiStroke){const n=ke(s,1.5*(1+.22*t.roughness),function(o){const r=Object.assign({},o);return r.randomizer=void 0,o.seed&&(r.seed=o.seed+1),r}(t));e=e.concat(n)}return{type:"path",ops:e}}function We(s,t,e){const n=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(s/2,2)+Math.pow(t/2,2))/2)),o=Math.ceil(Math.max(e.curveStepCount,e.curveStepCount/Math.sqrt(200)*n)),r=2*Math.PI/o;let l=Math.abs(s/2),i=Math.abs(t/2);const h=1-e.curveFitting;return l+=M(l*h,e),i+=M(i*h,e),{increment:r,rx:l,ry:i}}function Vt(s,t,e,n){const[o,r]=ye(n.increment,s,t,n.rx,n.ry,1,n.increment*Ot(.1,Ot(.4,1,e),e),e);let l=Ct(o,null,e);if(!e.disableMultiStroke&&e.roughness!==0){const[i]=ye(n.increment,s,t,n.rx,n.ry,1.5,0,e),h=Ct(i,null,e);l=l.concat(h)}return{estimatedPoints:r,opset:{type:"path",ops:l}}}function ge(s,t,e,n,o,r,l,i,h){const d=s,c=t;let f=Math.abs(e/2),p=Math.abs(n/2);f+=M(.01*f,h),p+=M(.01*p,h);let u=o,a=r;for(;u<0;)u+=2*Math.PI,a+=2*Math.PI;a-u>2*Math.PI&&(u=0,a=2*Math.PI);const m=2*Math.PI/h.curveStepCount,g=Math.min(m/2,(a-u)/2),k=Me(g,d,c,f,p,u,a,1,h);if(!h.disableMultiStroke){const b=Me(g,d,c,f,p,u,a,1.5,h);k.push(...b)}return l&&(i?k.push(...K(d,c,d+f*Math.cos(u),c+p*Math.sin(u),h),...K(d,c,d+f*Math.cos(a),c+p*Math.sin(a),h)):k.push({op:"lineTo",data:[d,c]},{op:"lineTo",data:[d+f*Math.cos(u),c+p*Math.sin(u)]})),{type:"path",ops:k}}function wt(s,t){const e=[];for(const n of s)if(n.length){const o=t.maxRandomnessOffset||0,r=n.length;if(r>2){e.push({op:"move",data:[n[0][0]+M(o,t),n[0][1]+M(o,t)]});for(let l=1;l<r;l++)e.push({op:"lineTo",data:[n[l][0]+M(o,t),n[l][1]+M(o,t)]})}}return{type:"fillPath",ops:e}}function lt(s,t){return function(e,n){let o=e.fillStyle||"hachure";if(!F[o])switch(o){case"zigzag":F[o]||(F[o]=new nn(n));break;case"cross-hatch":F[o]||(F[o]=new sn(n));break;case"dots":F[o]||(F[o]=new on(n));break;case"dashed":F[o]||(F[o]=new rn(n));break;case"zigzag-line":F[o]||(F[o]=new ln(n));break;case"hachure":default:o="hachure",F[o]||(F[o]=new ee(n))}return F[o]}(t,hn).fillPolygons(s,t)}function Ie(s){return s.randomizer||(s.randomizer=new an(s.seed||0)),s.randomizer.next()}function Ot(s,t,e,n=1){return e.roughness*n*(Ie(e)*(t-s)+s)}function M(s,t,e=1){return Ot(-s,s,t,e)}function K(s,t,e,n,o,r=!1){const l=r?o.disableMultiStrokeFill:o.disableMultiStroke,i=me(s,t,e,n,o,!0,!1);if(l)return i;const h=me(s,t,e,n,o,!0,!0);return i.concat(h)}function me(s,t,e,n,o,r,l){const i=Math.pow(s-e,2)+Math.pow(t-n,2),h=Math.sqrt(i);let d=1;d=h<200?1:h>500?.4:-.0016668*h+1.233334;let c=o.maxRandomnessOffset||0;c*c*100>i&&(c=h/10);const f=c/2,p=.2+.2*Ie(o);let u=o.bowing*o.maxRandomnessOffset*(n-t)/200,a=o.bowing*o.maxRandomnessOffset*(s-e)/200;u=M(u,o,d),a=M(a,o,d);const m=[],g=()=>M(f,o,d),k=()=>M(c,o,d),b=o.preserveVertices;return r&&(l?m.push({op:"move",data:[s+(b?0:g()),t+(b?0:g())]}):m.push({op:"move",data:[s+(b?0:M(c,o,d)),t+(b?0:M(c,o,d))]})),l?m.push({op:"bcurveTo",data:[u+s+(e-s)*p+g(),a+t+(n-t)*p+g(),u+s+2*(e-s)*p+g(),a+t+2*(n-t)*p+g(),e+(b?0:g()),n+(b?0:g())]}):m.push({op:"bcurveTo",data:[u+s+(e-s)*p+k(),a+t+(n-t)*p+k(),u+s+2*(e-s)*p+k(),a+t+2*(n-t)*p+k(),e+(b?0:k()),n+(b?0:k())]}),m}function ke(s,t,e){const n=[];n.push([s[0][0]+M(t,e),s[0][1]+M(t,e)]),n.push([s[0][0]+M(t,e),s[0][1]+M(t,e)]);for(let o=1;o<s.length;o++)n.push([s[o][0]+M(t,e),s[o][1]+M(t,e)]),o===s.length-1&&n.push([s[o][0]+M(t,e),s[o][1]+M(t,e)]);return Ct(n,null,e)}function Ct(s,t,e){const n=s.length,o=[];if(n>3){const r=[],l=1-e.curveTightness;o.push({op:"move",data:[s[1][0],s[1][1]]});for(let i=1;i+2<n;i++){const h=s[i];r[0]=[h[0],h[1]],r[1]=[h[0]+(l*s[i+1][0]-l*s[i-1][0])/6,h[1]+(l*s[i+1][1]-l*s[i-1][1])/6],r[2]=[s[i+1][0]+(l*s[i][0]-l*s[i+2][0])/6,s[i+1][1]+(l*s[i][1]-l*s[i+2][1])/6],r[3]=[s[i+1][0],s[i+1][1]],o.push({op:"bcurveTo",data:[r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1]]})}if(t&&t.length===2){const i=e.maxRandomnessOffset;o.push({op:"lineTo",data:[t[0]+M(i,e),t[1]+M(i,e)]})}}else n===3?(o.push({op:"move",data:[s[1][0],s[1][1]]}),o.push({op:"bcurveTo",data:[s[1][0],s[1][1],s[2][0],s[2][1],s[2][0],s[2][1]]})):n===2&&o.push(...K(s[0][0],s[0][1],s[1][0],s[1][1],e));return o}function ye(s,t,e,n,o,r,l,i){const h=[],d=[];if(i.roughness===0){s/=4,d.push([t+n*Math.cos(-s),e+o*Math.sin(-s)]);for(let c=0;c<=2*Math.PI;c+=s){const f=[t+n*Math.cos(c),e+o*Math.sin(c)];h.push(f),d.push(f)}d.push([t+n*Math.cos(0),e+o*Math.sin(0)]),d.push([t+n*Math.cos(s),e+o*Math.sin(s)])}else{const c=M(.5,i)-Math.PI/2;d.push([M(r,i)+t+.9*n*Math.cos(c-s),M(r,i)+e+.9*o*Math.sin(c-s)]);const f=2*Math.PI+c-.01;for(let p=c;p<f;p+=s){const u=[M(r,i)+t+n*Math.cos(p),M(r,i)+e+o*Math.sin(p)];h.push(u),d.push(u)}d.push([M(r,i)+t+n*Math.cos(c+2*Math.PI+.5*l),M(r,i)+e+o*Math.sin(c+2*Math.PI+.5*l)]),d.push([M(r,i)+t+.98*n*Math.cos(c+l),M(r,i)+e+.98*o*Math.sin(c+l)]),d.push([M(r,i)+t+.9*n*Math.cos(c+.5*l),M(r,i)+e+.9*o*Math.sin(c+.5*l)])}return[d,h]}function Me(s,t,e,n,o,r,l,i,h){const d=r+M(.1,h),c=[];c.push([M(i,h)+t+.9*n*Math.cos(d-s),M(i,h)+e+.9*o*Math.sin(d-s)]);for(let f=d;f<=l;f+=s)c.push([M(i,h)+t+n*Math.cos(f),M(i,h)+e+o*Math.sin(f)]);return c.push([t+n*Math.cos(l),e+o*Math.sin(l)]),c.push([t+n*Math.cos(l),e+o*Math.sin(l)]),Ct(c,null,h)}function dn(s,t,e,n,o,r,l,i){const h=[],d=[i.maxRandomnessOffset||1,(i.maxRandomnessOffset||1)+.3];let c=[0,0];const f=i.disableMultiStroke?1:2,p=i.preserveVertices;for(let u=0;u<f;u++)u===0?h.push({op:"move",data:[l[0],l[1]]}):h.push({op:"move",data:[l[0]+(p?0:M(d[0],i)),l[1]+(p?0:M(d[0],i))]}),c=p?[o,r]:[o+M(d[u],i),r+M(d[u],i)],h.push({op:"bcurveTo",data:[s+M(d[u],i),t+M(d[u],i),e+M(d[u],i),n+M(d[u],i),c[0],c[1]]});return h}function pt(s){return[...s]}function St(s,t){return Math.pow(s[0]-t[0],2)+Math.pow(s[1]-t[1],2)}function fn(s,t,e){const n=St(t,e);if(n===0)return St(s,t);let o=((s[0]-t[0])*(e[0]-t[0])+(s[1]-t[1])*(e[1]-t[1]))/n;return o=Math.max(0,Math.min(1,o)),St(s,tt(t,e,o))}function tt(s,t,e){return[s[0]+(t[0]-s[0])*e,s[1]+(t[1]-s[1])*e]}function Zt(s,t,e,n){const o=n||[];if(function(i,h){const d=i[h+0],c=i[h+1],f=i[h+2],p=i[h+3];let u=3*c[0]-2*d[0]-p[0];u*=u;let a=3*c[1]-2*d[1]-p[1];a*=a;let m=3*f[0]-2*p[0]-d[0];m*=m;let g=3*f[1]-2*p[1]-d[1];return g*=g,u<m&&(u=m),a<g&&(a=g),u+a}(s,t)<e){const i=s[t+0];o.length?(r=o[o.length-1],l=i,Math.sqrt(St(r,l))>1&&o.push(i)):o.push(i),o.push(s[t+3])}else{const h=s[t+0],d=s[t+1],c=s[t+2],f=s[t+3],p=tt(h,d,.5),u=tt(d,c,.5),a=tt(c,f,.5),m=tt(p,u,.5),g=tt(u,a,.5),k=tt(m,g,.5);Zt([h,p,m,k],0,e,o),Zt([k,g,a,f],0,e,o)}var r,l;return o}function pn(s,t){return Et(s,0,s.length,t)}function Et(s,t,e,n,o){const r=o||[],l=s[t],i=s[e-1];let h=0,d=1;for(let c=t+1;c<e-1;++c){const f=fn(s[c],l,i);f>h&&(h=f,d=c)}return Math.sqrt(h)>n?(Et(s,t,d+1,n,r),Et(s,d,e,n,r)):(r.length||r.push(l),r.push(i)),r}function be(s,t=.15,e){const n=[],o=(s.length-1)/3;for(let r=0;r<o;r++)Zt(s,3*r,t,n);return e&&e>0?Et(n,0,n.length,e):n}const N="none";class Wt{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}}line(t,e,n,o,r){const l=this._o(r);return this._d("line",[Ee(t,e,n,o,l)],l)}rectangle(t,e,n,o,r){const l=this._o(r),i=[],h=cn(t,e,n,o,l);if(l.fill){const d=[[t,e],[t+n,e],[t+n,e+o],[t,e+o]];l.fillStyle==="solid"?i.push(wt([d],l)):i.push(lt([d],l))}return l.stroke!==N&&i.push(h),this._d("rectangle",i,l)}ellipse(t,e,n,o,r){const l=this._o(r),i=[],h=We(n,o,l),d=Vt(t,e,l,h);if(l.fill)if(l.fillStyle==="solid"){const c=Vt(t,e,l,h).opset;c.type="fillPath",i.push(c)}else i.push(lt([d.estimatedPoints],l));return l.stroke!==N&&i.push(d.opset),this._d("ellipse",i,l)}circle(t,e,n,o){const r=this.ellipse(t,e,n,n,o);return r.shape="circle",r}linearPath(t,e){const n=this._o(e);return this._d("linearPath",[Pt(t,!1,n)],n)}arc(t,e,n,o,r,l,i=!1,h){const d=this._o(h),c=[],f=ge(t,e,n,o,r,l,i,!0,d);if(i&&d.fill)if(d.fillStyle==="solid"){const p=Object.assign({},d);p.disableMultiStroke=!0;const u=ge(t,e,n,o,r,l,!0,!1,p);u.type="fillPath",c.push(u)}else c.push(function(p,u,a,m,g,k,b){const W=p,$=u;let w=Math.abs(a/2),z=Math.abs(m/2);w+=M(.01*w,b),z+=M(.01*z,b);let q=g,j=k;for(;q<0;)q+=2*Math.PI,j+=2*Math.PI;j-q>2*Math.PI&&(q=0,j=2*Math.PI);const J=(j-q)/b.curveStepCount,A=[];for(let _=q;_<=j;_+=J)A.push([W+w*Math.cos(_),$+z*Math.sin(_)]);return A.push([W+w*Math.cos(j),$+z*Math.sin(j)]),A.push([W,$]),lt([A],b)}(t,e,n,o,r,l,d));return d.stroke!==N&&c.push(f),this._d("arc",c,d)}curve(t,e){const n=this._o(e),o=[],r=un(t,n);if(n.fill&&n.fill!==N&&t.length>=3){const l=be(function(i,h=0){const d=i.length;if(d<3)throw new Error("A curve must have at least three points.");const c=[];if(d===3)c.push(pt(i[0]),pt(i[1]),pt(i[2]),pt(i[2]));else{const f=[];f.push(i[0],i[0]);for(let a=1;a<i.length;a++)f.push(i[a]),a===i.length-1&&f.push(i[a]);const p=[],u=1-h;c.push(pt(f[0]));for(let a=1;a+2<f.length;a++){const m=f[a];p[0]=[m[0],m[1]],p[1]=[m[0]+(u*f[a+1][0]-u*f[a-1][0])/6,m[1]+(u*f[a+1][1]-u*f[a-1][1])/6],p[2]=[f[a+1][0]+(u*f[a][0]-u*f[a+2][0])/6,f[a+1][1]+(u*f[a][1]-u*f[a+2][1])/6],p[3]=[f[a+1][0],f[a+1][1]],c.push(p[1],p[2],p[3])}}return c}(t),10,(1+n.roughness)/2);n.fillStyle==="solid"?o.push(wt([l],n)):o.push(lt([l],n))}return n.stroke!==N&&o.push(r),this._d("curve",o,n)}polygon(t,e){const n=this._o(e),o=[],r=Pt(t,!0,n);return n.fill&&(n.fillStyle==="solid"?o.push(wt([t],n)):o.push(lt([t],n))),n.stroke!==N&&o.push(r),this._d("polygon",o,n)}path(t,e){const n=this._o(e),o=[];if(!t)return this._d("path",o,n);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const r=n.fill&&n.fill!=="transparent"&&n.fill!==N,l=n.stroke!==N,i=!!(n.simplification&&n.simplification<1),h=function(d,c,f){const p=pe(fe(Ht(d))),u=[];let a=[],m=[0,0],g=[];const k=()=>{g.length>=4&&a.push(...be(g,c)),g=[]},b=()=>{k(),a.length&&(u.push(a),a=[])};for(const{key:$,data:w}of p)switch($){case"M":b(),m=[w[0],w[1]],a.push(m);break;case"L":k(),a.push([w[0],w[1]]);break;case"C":if(!g.length){const z=a.length?a[a.length-1]:m;g.push([z[0],z[1]])}g.push([w[0],w[1]]),g.push([w[2],w[3]]),g.push([w[4],w[5]]);break;case"Z":k(),a.push([m[0],m[1]])}if(b(),!f)return u;const W=[];for(const $ of u){const w=pn($,f);w.length&&W.push(w)}return W}(t,1,i?4-4*n.simplification:(1+n.roughness)/2);return r&&(n.fillStyle==="solid"?o.push(wt(h,n)):o.push(lt(h,n))),l&&(i?h.forEach(d=>{o.push(Pt(d,!1,n))}):o.push(function(d,c){const f=pe(fe(Ht(d))),p=[];let u=[0,0],a=[0,0];for(const{key:m,data:g}of f)switch(m){case"M":{const k=1*(c.maxRandomnessOffset||0),b=c.preserveVertices;p.push({op:"move",data:g.map(W=>W+(b?0:M(k,c)))}),a=[g[0],g[1]],u=[g[0],g[1]];break}case"L":p.push(...K(a[0],a[1],g[0],g[1],c)),a=[g[0],g[1]];break;case"C":{const[k,b,W,$,w,z]=g;p.push(...dn(k,b,W,$,w,z,a,c)),a=[w,z];break}case"Z":p.push(...K(a[0],a[1],u[0],u[1],c)),a=[u[0],u[1]]}return{type:"path",ops:p}}(t,n))),this._d("path",o,n)}opsToPath(t,e){let n="";for(const o of t.ops){const r=typeof e=="number"&&e>=0?o.data.map(l=>+l.toFixed(e)):o.data;switch(o.op){case"move":n+=`M${r[0]} ${r[1]} `;break;case"bcurveTo":n+=`C${r[0]} ${r[1]}, ${r[2]} ${r[3]}, ${r[4]} ${r[5]} `;break;case"lineTo":n+=`L${r[0]} ${r[1]} `}}return n.trim()}toPaths(t){const e=t.sets||[],n=t.options||this.defaultOptions,o=[];for(const r of e){let l=null;switch(r.type){case"path":l={d:this.opsToPath(r),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:N};break;case"fillPath":l={d:this.opsToPath(r),stroke:N,strokeWidth:0,fill:n.fill||N};break;case"fillSketch":l=this.fillSketch(r,n)}l&&o.push(l)}return o}fillSketch(t,e){let n=e.fillWeight;return n<0&&(n=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||N,strokeWidth:n,fill:N}}}class gn{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new Wt(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),o=this.ctx,r=t.options.fixedDecimalPlaceDigits;for(const l of e)switch(l.type){case"path":o.save(),o.strokeStyle=n.stroke==="none"?"transparent":n.stroke,o.lineWidth=n.strokeWidth,n.strokeLineDash&&o.setLineDash(n.strokeLineDash),n.strokeLineDashOffset&&(o.lineDashOffset=n.strokeLineDashOffset),this._drawToContext(o,l,r),o.restore();break;case"fillPath":{o.save(),o.fillStyle=n.fill||"";const i=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(o,l,r,i),o.restore();break}case"fillSketch":this.fillSketch(o,l,n)}}fillSketch(t,e,n){let o=n.fillWeight;o<0&&(o=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=o,this._drawToContext(t,e,n.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,n,o="nonzero"){t.beginPath();for(const r of e.ops){const l=typeof n=="number"&&n>=0?r.data.map(i=>+i.toFixed(n)):r.data;switch(r.op){case"move":t.moveTo(l[0],l[1]);break;case"bcurveTo":t.bezierCurveTo(l[0],l[1],l[2],l[3],l[4],l[5]);break;case"lineTo":t.lineTo(l[0],l[1])}}e.type==="fillPath"?t.fill(o):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,n,o,r){const l=this.gen.line(t,e,n,o,r);return this.draw(l),l}rectangle(t,e,n,o,r){const l=this.gen.rectangle(t,e,n,o,r);return this.draw(l),l}ellipse(t,e,n,o,r){const l=this.gen.ellipse(t,e,n,o,r);return this.draw(l),l}circle(t,e,n,o){const r=this.gen.circle(t,e,n,o);return this.draw(r),r}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n),n}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n),n}arc(t,e,n,o,r,l,i=!1,h){const d=this.gen.arc(t,e,n,o,r,l,i,h);return this.draw(d),d}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n),n}path(t,e){const n=this.gen.path(t,e);return this.draw(n),n}}const vt="http://www.w3.org/2000/svg";class mn{constructor(t,e){this.svg=t,this.gen=new Wt(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),o=this.svg.ownerDocument||window.document,r=o.createElementNS(vt,"g"),l=t.options.fixedDecimalPlaceDigits;for(const i of e){let h=null;switch(i.type){case"path":h=o.createElementNS(vt,"path"),h.setAttribute("d",this.opsToPath(i,l)),h.setAttribute("stroke",n.stroke),h.setAttribute("stroke-width",n.strokeWidth+""),h.setAttribute("fill","none"),n.strokeLineDash&&h.setAttribute("stroke-dasharray",n.strokeLineDash.join(" ").trim()),n.strokeLineDashOffset&&h.setAttribute("stroke-dashoffset",`${n.strokeLineDashOffset}`);break;case"fillPath":h=o.createElementNS(vt,"path"),h.setAttribute("d",this.opsToPath(i,l)),h.setAttribute("stroke","none"),h.setAttribute("stroke-width","0"),h.setAttribute("fill",n.fill||""),t.shape!=="curve"&&t.shape!=="polygon"||h.setAttribute("fill-rule","evenodd");break;case"fillSketch":h=this.fillSketch(o,i,n)}h&&r.appendChild(h)}return r}fillSketch(t,e,n){let o=n.fillWeight;o<0&&(o=n.strokeWidth/2);const r=t.createElementNS(vt,"path");return r.setAttribute("d",this.opsToPath(e,n.fixedDecimalPlaceDigits)),r.setAttribute("stroke",n.fill||""),r.setAttribute("stroke-width",o+""),r.setAttribute("fill","none"),n.fillLineDash&&r.setAttribute("stroke-dasharray",n.fillLineDash.join(" ").trim()),n.fillLineDashOffset&&r.setAttribute("stroke-dashoffset",`${n.fillLineDashOffset}`),r}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,n,o,r){const l=this.gen.line(t,e,n,o,r);return this.draw(l)}rectangle(t,e,n,o,r){const l=this.gen.rectangle(t,e,n,o,r);return this.draw(l)}ellipse(t,e,n,o,r){const l=this.gen.ellipse(t,e,n,o,r);return this.draw(l)}circle(t,e,n,o){const r=this.gen.circle(t,e,n,o);return this.draw(r)}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n)}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n)}arc(t,e,n,o,r,l,i=!1,h){const d=this.gen.arc(t,e,n,o,r,l,i,h);return this.draw(d)}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n)}path(t,e){const n=this.gen.path(t,e);return this.draw(n)}}var kn={canvas:(s,t)=>new gn(s,t),svg:(s,t)=>new mn(s,t),generator:s=>new Wt(s),newSeed:()=>Wt.newSeed()};let C=[],P=0,S=0,Te=0,Ae=0,yn=1,Qt=0,It=[],Tt=!1,At=!1;const gt=document.getElementById("me"),Q=en(20);let ot="rgb(95, 61, 196)",ne="pen",mt="hachure";const T=document.getElementById("canvas");T.height=document.documentElement.clientHeight;T.width=document.documentElement.clientWidth;const y=T.getContext("2d");y.lineWidth=12;let qt=0,Nt=0;const et=kn.canvas(T),we=document.querySelectorAll(".mode-btn");we.forEach(s=>{s.addEventListener("click",t=>{if(t.target===null)return;const e=t.target;we.forEach(n=>{n!==e&&n.classList.remove("active")}),e.classList.add("active"),mt=e.dataset.fillOption})});const Mn=document.querySelectorAll(".shape-btn");Mn.forEach(s=>{s.addEventListener("click",t=>{if(t.target===null)return;ne=t.target.dataset.shapeOption})});let R,at="";const Dt=window.location;Dt.protocol==="https:"?at="wss:":at="ws:";at+="/"+Dt.host;at+=Dt.pathname+"/ws"+Dt.search;R=new WebSocket(at);De(R);function De(s){s.onmessage=bn,s.onclose=wn}function bn(s){try{const e=s.data.split(":::"),n=e[0];if(n==="move"){const o=y.lineWidth,r=y.strokeStyle;T.getContext("2d"),y.beginPath(),y.moveTo(e[1],e[2]),y.lineTo(e[3],e[4]),y.lineWidth=e[5],y.strokeStyle=e[6],y.stroke(),y.strokeStyle=r,y.lineWidth=o}if(n==="clear"&&(C=[],y.clearRect(0,0,T.width,T.height)),n==="cur"){const o=e[1];let r;if(r=document.getElementById(o),r===null){r=document.createElement("div"),r.id=o,r.className="trailer",document.body.appendChild(r);return}const l={transform:`translate(${+e[2]+P}px, ${+e[3]+S}px)`};r.animate(l,{fill:"forwards"})}if(n==="disconnect"){let o=document.getElementsByClassName("trailer");if(o.length===0)return;for(var t=0;t<o.length;t++)o[t].id!=="me"&&(document.body.removeChild(o[t]),t--)}if(n==="drawObj"){let o=Je(e[1],et,y);C.push(o),o.draw(P,S)}if(n==="delete"){let o=e[1];C=C.filter(r=>JSON.stringify(r)!==o),V(T,y),Z(C,P,S)}}catch(e){console.error(e)}}function wn(){alert("lost connection"),R=new WebSocket(at),De(R)}let nt=0,st=0;window.addEventListener("mousedown",s=>{if(s.which===2){At=!0,Te=s.clientX-P,Ae=s.clientY-S;return}if(s.button!==0)return;s.stopPropagation();const t=s.target;t.id==="canvas"&&t!==null&&(Tt=!0,Qt=0,It=[],nt=s.clientX,st=s.clientY)});window.addEventListener("mouseup",s=>{if(At){At=!1;return}if(Tt=!1,s.target.id!=="canvas")return;switch(ne){case"pen":{let o=new Jt(It,y.fillStyle,+y.lineWidth,y,Q);C.push(o),V(T,y),Z(C,P,S);break}case"line":{V(T,y),Z(C,P,S);let o=new Kt(y.fillStyle,+y.lineWidth,[nt-P,st-S],[s.clientX-P,s.clientY-S],et,Q);o.draw(P,S),C.push(o);break}case"rectangle":{V(T,y),Z(C,P,S);let o=new Ut(y.fillStyle,+y.lineWidth,[nt-P,st-S],[s.clientX-P,s.clientY-S],mt,et,ot,y.lineWidth,Q);o.draw(P,S),C.push(o);break}case"ellipse":V(T,y),Z(C,P,S);let n=new te(y.fillStyle,+y.lineWidth,[nt-P,st-S],[s.clientX-P,s.clientY-S],mt,et,ot,y.lineWidth,!1,Q);n.draw(P,S),C.push(n);break}let e="drawObj:::"+JSON.stringify(C[C.length-1])+":::";R.send(e.length),R.send(e)});window.addEventListener("mousemove",s=>{if(s.button!==0)return;const t=s.target,e=s.clientX-gt.offsetWidth/2,n=s.clientY-gt.offsetHeight/2;if(t.id==="canvas"){Ke(e,n,gt);let l="cur:::"+Q+":::"+ +(e-P)+":::"+ +(n-S)+":::";R.send(l.length),R.send(l)}if(At){P=s.clientX-Te,S=s.clientY-Ae,V(T,y),Z(C,P,S);return}if(!Tt)return;const o=s.clientX,r=s.clientY;switch(ne){case"pen":if(qt==null||Nt==null||!Tt){qt=s.clientX,Nt=s.clientY;return}let l=s.clientX,i=s.clientY;Qt++,Qt%yn===0&&(It.push([l-P,i-S]),new Jt(It,y.fillStyle,y.lineWidth,y,Q).draw(P,S)),qt=l,Nt=i;break;case"line":V(T,y),Z(C,P,S),new Kt(y.fillStyle,+y.lineWidth,[nt-P,st-S],[o-P,r-S],et,Q).draw(P,S);break;case"ellipse":V(T,y),Z(C,P,S),new te(y.fillStyle,+y.lineWidth,[nt-P,st-S],[o-P,r-S],mt,et,ot,y.lineWidth,!1,Q).draw(P,S);break;case"rectangle":V(T,y),Z(C,P,S),new Ut(y.fillStyle,+y.lineWidth,[nt-P,st-S],[o-P,r-S],mt,et,ot,y.lineWidth,Q).draw(P,S);break}});window.addEventListener("resize",()=>{V(T,y),Z(C,P,S)});let Gt=[];document.addEventListener("keydown",function(s){if(s.ctrlKey&&s.key.toLocaleLowerCase()==="z"){if(s.shiftKey){if(Gt.length===0)return;let r=Gt.pop();C.push(r),r.draw(P,S);let l="drawObj:::"+JSON.stringify(r)+":::";R.send(l.length),R.send(l);return}let t=C.filter(r=>r.userId===Q);if(t.length===0)return;let e=t[t.length-1];C=C.filter(r=>r!==e);let n=JSON.stringify(e);Gt.push(e),V(T,y),Z(C,P,S);let o="delete:::"+n;R.send(o.length),R.send(o)}});let vn=document.getElementById("clear-btn");vn.addEventListener("click",()=>{C=[],y.clearRect(0,0,T.width,T.height),R.send(8),R.send("clear:::")});let Pn=document.getElementById("save-btn");Pn.addEventListener("click",()=>{let s=T.toDataURL("imag/png"),t=document.createElement("a");t.href=s,t.download="sketch.png",t.click()});const se=document.getElementById("stroke-color-picker"),xt=document.getElementById("stroke-color-list"),ve=document.querySelectorAll("#stroke-color-item"),Sn=document.getElementById("stroke-color-picker-input");se.addEventListener("click",s=>{s.stopPropagation(),xt.style.display==="grid"?xt.style.display="none":xt.style.display="grid"});for(let s=0;s<ve.length;s++)ve[s].addEventListener("click",e=>{const n=e.target;if(n===null)return;const o=n.style.backgroundColor;se.style.backgroundColor=o,ot=o,xt.style.display="none",console.log(ot)});Sn.addEventListener("input",s=>{const t=s.target;if(t===null)return;const e="#"+t.value;e.length>1&&(se.style.backgroundColor=e,ot=e)});const oe=document.querySelector(".color-picker"),Lt=document.getElementById("color-list"),Pe=document.querySelectorAll("#color-item"),xn=document.getElementById("color-picker-input");oe.addEventListener("click",s=>{s.stopPropagation(),Lt.style.display==="grid"?Lt.style.display="none":Lt.style.display="grid"});for(let s=0;s<Pe.length;s++)Pe[s].addEventListener("click",e=>{const n=e.target;if(n===null)return;const o=n.style.backgroundColor;oe.style.backgroundColor=o,Le(o,y,gt),Lt.style.display="none"});xn.addEventListener("input",s=>{const t=s.target;if(t===null)return;const e="#"+t.value;e.length>1&&(oe.style.backgroundColor=e,Le(e,y,gt))});const Se=document.querySelectorAll(".option-btn");Se.forEach(s=>{s.addEventListener("click",t=>{if(t.target===null)return;const e=t.target;y.lineWidth=parseInt(e.dataset.lineWidth),s.classList.add("current-width"),Se.forEach(n=>{n!==e&&n.classList.remove("current-width")})})});const Xt=document.getElementById("input-opacity");Xt.addEventListener("change",()=>{const s=y.fillStyle.startsWith("#")?Oe(y.fillStyle,Xt.value):tn(y.fillStyle,+Xt.value);y.fillStyle=s});
